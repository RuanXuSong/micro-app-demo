"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[396],{34950:function(e,n){Object.defineProperty(n,"__esModule",{value:!0});n.default={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M464 688a48 48 0 1096 0 48 48 0 10-96 0zm24-112h48c4.4 0 8-3.6 8-8V296c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8z"}}]},name:"exclamation-circle",theme:"outlined"}},3855:function(e,n,t){var a=t(95318),r=t(20862);n.Z=void 0;var i=r(t(67294)),l=a(t(34950)),o=a(t(92074)),s=function(e,n){return i.createElement(o.default,Object.assign({},e,{ref:n,icon:l.default}))};s.displayName="ExclamationCircleOutlined";var u=i.forwardRef(s);n.Z=u},77123:function(e,n,t){t.d(n,{Z:function(){return b}});var a=t(97857),r=t.n(a),i=t(19632),l=t.n(i),o=t(5574),s=t.n(o),u=t(13769),d=t.n(u),c=t(67294),f=t(9308),p=t(27601),h=t(96486),m=t(14955),g="disabled___mlAxB",v=t(85893),x=["value","onChange","disabled","rowKey","dataSource"],b=function(e){var n=e.value,t=void 0===n?[]:n,a=e.onChange,i=e.disabled,o=e.rowKey,u=e.dataSource,b=d()(e,x),y=(0,c.useRef)([]),Z=(0,c.useRef)([]),I=(0,c.useState)(!0),j=s()(I,2),C=j[0],w=j[1],S={selectedRowKeys:t,onChange:function(e,n){var t;if(!i){var r=l()(e),s=function(e,n){for(var t={add:[],del:[]},a={},r=0;r<e.length;r++)a[e[r]]=e[r];for(var i=0;i<n.length;i++)(0,p.Z)(a[n[i]])?t.add.push(n[i]):delete a[n[i]];for(var l in a)t.del.push(a[l]);return t}(y.current,e),d=s.add,c=void 0===d?[]:d,f=s.del,g=void 0===f?[]:f,v=n.filter((function(e){return c.includes(e[o])})),x=Z.current.filter((function(e){return g.includes(e[o])}));!function e(n){for(var t=0;t<n.length;t++){var a=(n[t]||{}).children;r.push(n[t][o]),(0,h.isEmpty)(a)||e(a)}}(v);!function e(n){for(var t=function(t){var a=(n[t]||{}).children;r=r.filter((function(e){return e!==n[t][o]})),(0,h.isEmpty)(a)||e(a)},a=0;a<n.length;a++)t(a)}(x);var b=l()(new Set(r));null==a||a(b),y.current=l()(b);var I=l()(u||[]);Z.current=null!==(t=(0,m.oO)(I).filter((function(e){return b.includes(e[o])})))&&void 0!==t?t:[]}}};return(0,c.useEffect)((function(){if(C&&!(0,h.isEmpty)(t)){var e,n;y.current=t;var a=l()(u||[]);Z.current=null!==(e=null===(n=(0,m.oO)(a))||void 0===n?void 0:n.filter((function(e){return t.includes(e[o])})))&&void 0!==e?e:[],w(!1)}}),[t]),(0,v.jsx)(f.ZP,r()({className:i?g:{},rowSelection:r()(r()({},S),{},{checkStrictly:!0,selections:!1}),rowKey:o,dataSource:u},b))}},61253:function(e,n,t){t.r(n),t.d(n,{default:function(){return ue}});var a=t(74348),r=t(12461),i=t(71577),l=t(9308),o=t(43758),s=t(24969),u=t(14955),d=t(62571),c=t(13769),f=t.n(c),p=t(97857),h=t.n(p),m=t(5574),g=t.n(m),v=t(67294),x=t(66490),b=t(13448),y=t(11382),Z=t(11486),I=t(45845),j=t(34041),C=t(27601),w=t(86317),S=t(59360),P=t(67723),T=t(82198),k=t(32615),O=t(3855),_="formWrap___il6fy",R="rowWrap___azZzl",D="description___m7c7r",M=t(75873),A=t(94184),B=t.n(A),E=t(30381),F=t.n(E),z=t(41712),q=t(84354),N=function(e){return e&&e<F()().endOf("day")},Q=t(27484),H=t.n(Q),L=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"YYYY-MM-DD HH:mm:ss";return e?H()(e).format(n):null},V=t(85893),K=["logo","validBefore"],U={labelCol:{span:8},wrapperCol:{span:14}},W={labelCol:{span:4},wrapperCol:{span:19}},Y=function(e){var n=e.visible,t=e.toggleVisible,i=e.formData,l=e.reload,s=x.Z.useForm(),d=g()(s,1)[0],c=(0,S.Z)(),p=c.tip,m=c.setTip,A=i.id,E=(0,q.useModel)("company").reloadCompanyData,Q=(0,w.QT)(API.platform.sysOrg.detail.fetch,{onSuccess:function(e){d.setFieldsValue(h()(h()({},e),{},{validBefore:e.validBefore?F()(e.validBefore):null,logo:null!=e&&e.logo?[{uid:"1",name:"logo",status:"done",url:null==e?void 0:e.logo,size:0}]:[]}))},manual:!0}),H=Q.run,Y=Q.loading;(0,v.useEffect)((function(){return n&&A&&H({id:A}),function(){d.resetFields()}}),[A,n]);var J=function(){d.resetFields(),t(),null==l||l(),E()},G=(0,w.QT)(API.platform.sysOrg.update.fetch,{onSuccess:function(){J(),r.ZP.success("保存成功")},manual:!0}),X=G.run,$=G.loading,ee=(0,w.QT)(API.platform.sysOrg.save.fetch,{onSuccess:function(e){J(),e&&b.Z.success({message:"租户新建成功",description:"密码为: ".concat(e),duration:null})},manual:!0}),ne=ee.run,te=ee.loading,ae=(0,w.QT)((function(e){e.logo;var n=e.validBefore,t=f()(e,K);m("数据保存中，请稍候...");var a=(0,z.HO)(h()(h()(h()({},i),t),{},{logo:e.logo.map((function(e){return e.url||e.response.data.url}))[0],validBefore:L(n)}));return A?X(a):ne(a)}),{manual:!0}),re=ae.run,ie=ae.loading,le=Y||ie||$||te;return(0,V.jsx)(a.Z,{centered:!0,visible:n,forceRender:!0,maskClosable:!1,title:"".concat((0,C.Z)(A)?"新建":"编辑","企业"),okButtonProps:{htmlType:"submit"},width:800,onOk:function(){return d.submit()},onCancel:function(){t(),d.resetFields()},confirmLoading:le,children:(0,V.jsx)(y.Z,{spinning:le,tip:p,children:(0,V.jsxs)(x.Z,h()(h()({form:d,onFinish:re},U),{},{className:_,children:[(0,V.jsx)(x.Z.Item,{label:"企业编码",name:"orgCode",tooltip:{icon:(0,V.jsx)(O.Z,{}),title:"企业编码将作为企业下所有账号后缀\n需要输入20位以内小写英文字母"},rules:[{whitespace:!0},{required:!0},{validator:M.T0}],children:(0,V.jsx)(Z.Z,{disabled:!!A,placeholder:"请输入"})}),(0,V.jsx)(x.Z.Item,{label:"企业名称",name:"orgName",rules:[{whitespace:!0},{required:!0}],children:(0,V.jsx)(Z.Z,{placeholder:"请输入"})}),(0,V.jsx)("div",{className:R,children:(0,V.jsx)(P.Z,{formItemProps:U,label:"企业logo",name:"logo",maxCount:1,accept:T.b1["图片"].join(","),uploadProps:{listType:"picture-card"},required:!0,requiredMessage:"请上传企业 logo",children:(0,V.jsx)(k.Z,{})})}),(0,V.jsx)("div",{className:R,children:(0,V.jsx)(x.Z.Item,{label:"企业代码",name:"enterpriseCode",rules:[{whitespace:!0}],children:(0,V.jsx)(Z.Z,{placeholder:"请输入"})})}),(0,V.jsx)(x.Z.Item,{label:"负责人",name:"director",rules:[{whitespace:!0},{required:!0}],children:(0,V.jsx)(Z.Z,{placeholder:"请输入"})}),(0,V.jsx)(x.Z.Item,{label:"负责人手机号",name:"phone",rules:[{whitespace:!0},{required:!0},{validator:M.tH}],children:(0,V.jsx)(Z.Z,{placeholder:"请输入"})}),!!A&&(0,V.jsx)(x.Z.Item,{label:"管理员账号",name:"directorUsername",rules:[{whitespace:!0}],children:(0,V.jsx)(Z.Z,{disabled:!0,placeholder:"请输入"})}),(0,V.jsx)(x.Z.Item,{label:"有效期",name:"validBefore",rules:[{required:!0}],children:(0,V.jsx)(I.Z,{disabledDate:N})}),!!A&&(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)(x.Z.Item,{label:"状态",name:"status",rules:[{required:!0}],children:(0,V.jsx)(j.Z,{options:(0,u.MM)(o.w6),placeholder:"请选择"})}),(0,V.jsx)(x.Z.Item,{label:"当前用户数",name:"userNum",children:(0,V.jsx)(Z.Z,{disabled:!0,placeholder:"请输入"})})]}),(0,V.jsx)("div",{className:B()(R,D),children:(0,V.jsx)(x.Z.Item,h()(h()({label:"描述",name:"description",rules:[{whitespace:!0},{required:!0}]},W),{},{children:(0,V.jsx)(Z.Z,{placeholder:"请输入"})}))})]}))})})},J=t(79697),G="formWrap___k9c3a",X=t(96486),$=t(77123),ee=t(62865),ne=["resourceIds"],te={labelCol:{span:6},wrapperCol:{span:16}},ae=function(e){var n=e.visible,t=e.toggleVisible,i=e.formData,l=e.loading,s=e.reload,u=x.Z.useForm(),d=g()(u,1)[0],c=(0,S.Z)(),p=c.tip,m=c.setTip,b=i.id,Z=i.directorRoleId,I=i.orgCode,j=(0,w.QT)(API.platform.sysUser.myResourceList.fetch,{manual:!0}),C=j.run,P=j.data,T=j.loading;(0,v.useEffect)((function(){n&&I&&C({orgCode:I})}),[n,I]);var k=(0,v.useMemo)((function(){return(0,ee.r)(P)}),[P]),O=(0,w.QT)((function(e){return API.platform.sysOrg.resourceList.fetch({id:e})}),{manual:!0,onSuccess:function(e){var n=[];!function e(t){t.forEach((function(t){var a=t.id,r=t.privilegeList,i=void 0===r?[]:r,l=t.children;n.push(a),(0,J.Z)(i)||i.forEach((function(e){n.push(e.id)})),(0,J.Z)(l)||e(l)}))}(e),d.setFieldsValue({resourceIds:n})}}),_=O.run;(0,v.useEffect)((function(){n&&_(b)}),[n]),(0,v.useEffect)((function(){return(0,J.Z)(i)||d.setFieldsValue(i),function(){d.resetFields()}}),[i]);var R=(0,w.QT)((function(e){var n=e.resourceIds,t=void 0===n?[]:n,a=f()(e,ne);m("数据保存中，请稍候...");var r=(0,z.HO)(h()(h()({},a),{},{clientKey:o.OW.clientId,id:Z,resourceIds:t.filter((function(e){return(0,X.isNumber)(e)}))}));return API.platform.sysRole.resourceSave.fetch(r)}),{manual:!0,onSuccess:function(){r.ZP.success("保存成功"),d.resetFields(),t(),null==s||s()}}),D=R.run,M=R.loading;return(0,V.jsx)(a.Z,{centered:!0,visible:n,forceRender:!0,maskClosable:!1,title:"企业授权",okButtonProps:{htmlType:"submit"},width:800,onOk:function(){return d.submit()},onCancel:function(){t(),d.resetFields()},confirmLoading:M,children:(0,V.jsx)(y.Z,{spinning:T||l&&M,tip:p,children:(0,V.jsx)(x.Z,h()(h()({form:d,onFinish:D},te),{},{className:G,children:(0,V.jsx)(x.Z.Item,{label:"权限列表",name:"resourceIds",noStyle:!0,children:(0,V.jsx)($.Z,{search:!1,rowKey:"id",columns:[{title:"资源名称",dataIndex:"description",align:"left",copyable:!1,valueType:"text"}],dataSource:k})})}))})})},re=t(15009),ie=t.n(re),le=t(99289),oe=t.n(le),se=t(60106),ue=function(){var e=function(){var e=(0,v.useRef)(),n=(0,se.x)({visible:!1,formData:{},loading:!1}),t=g()(n,2),a=t[0],i=t[1],l=(0,se.x)({visible:!1,formData:{},loading:!1}),s=g()(l,2),u=s[0],d=s[1],c=(e.current||{}).reload,f=(0,w.QT)(API.platform.sysOrg.resetPassword.fetch,{manual:!0,onSuccess:function(e){r.ZP.success("重置成功"),null==c||c(),e&&b.Z.success({message:"密码重置成功",description:"密码为: ".concat(e),duration:null})}}).run,p=(0,w.QT)(API.platform.sysOrg.updateStatus.fetch,{manual:!0,onSuccess:function(){r.ZP.success("操作成功"),null==c||c()}}).run,m=(0,w.QT)(API.authorization.resourceRole.resourceDelete.fetch,{manual:!0,onSuccess:function(){r.ZP.success("删除成功"),null==c||c()}}).run,x=function(){var e=oe()(ie()().mark((function e(n){var t,a,r,i;return ie()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,API.platform.sysOrg.pageList.fetch((0,z.HO)(h()(h()({},n),{},{page:(null==n?void 0:n.current)||o.ii.page,pageSize:(null==n?void 0:n.pageSize)||o.ii.pageSize})));case 2:return t=e.sent,a=t.list,r=t.page,i=t.total,e.abrupt("return",{data:a||[],page:r,success:!0,total:i});case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return{actionRef:e,reload:c,editModalConfig:a,setEditModalConfig:i,authModalConfig:u,setAuthModalConfig:d,handleDelete:m,fetchList:x,handleCompanyEdit:function(e){i((function(n){n.visible=!0,n.loading=!0,n.formData=e}))},handleUpdateStatus:p,handleResetPassword:f,handleCompanyAdd:function(){i((function(e){e.visible=!0,e.formData={}}))},handleAuthorize:function(e){d((function(n){n.visible=!0,n.loading=!0,n.formData=e}))},handleModalHide:function(e){({edit:i,auth:d})[e]((function(e){e.visible=!1,e.loading=!1,e.formData={}}))}}}(),n=e.actionRef,t=e.reload,c=e.editModalConfig,f=e.fetchList,p=e.handleResetPassword,m=e.handleUpdateStatus,x=e.handleCompanyAdd,y=e.handleCompanyEdit,Z=e.handleModalHide,I=e.authModalConfig,j=e.handleAuthorize,C=[{title:"企业编码",dataIndex:"orgCode",align:"left",copyable:!1,valueType:"text",hideInSearch:!1},{title:"企业名称",dataIndex:"orgName",align:"left",copyable:!1,valueType:"text",hideInSearch:!1},{title:"负责人",dataIndex:"director",align:"left",copyable:!1,valueType:"text",hideInSearch:!1},{title:"负责人手机号",dataIndex:"phone",align:"left",copyable:!1,valueType:"text",hideInSearch:!1},{title:"状态",dataIndex:"status",align:"left",copyable:!1,valueType:"text",hideInSearch:!1,valueEnum:(0,u.BJ)(o.w6)},{title:"有效期",dataIndex:"validBefore",align:"left",copyable:!1,valueType:"date",hideInSearch:!1,hideInTable:!0},{title:"有效期",dataIndex:"validBefore",align:"left",copyable:!1,valueType:"date",hideInSearch:!0},{title:"操作",dataIndex:"id",align:"left",copyable:!1,valueType:"text",hideInSearch:!0,render:function(e,n){return(0,V.jsx)(d.Z,{buttons:[{name:"编辑",key:"edit",onClick:function(){return y(n)}},{name:"授权",key:"authorize",onClick:function(){return j(n)}},{name:"禁用",key:"disable",onClick:function(){return a.Z.confirm({title:"确认禁用？",onOk:function(){return n.id&&m({status:o.w6["禁用"],id:"".concat(n.id)})}})},hidden:o.w6["禁用"]===+n.status},{name:"启用",key:"enable",onClick:function(){n.validBefore?null!=N&&N(F()(n.validBefore))?(r.ZP.warning("企业有效期已过期，请先重新编辑"),y(n)):n.id&&m({status:o.w6["正常"],id:"".concat(null==n?void 0:n.id)}):r.ZP.error("企业有效期缺失，无法启用")},hidden:o.w6["禁用"]!==+n.status},{name:"重置密码",key:"reset",onClick:function(){return a.Z.confirm({title:"确认重置密码？",onOk:function(){return n.id&&p({id:"".concat(n.id)})}})}}]})}}];return(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)(l.ZP,{style:{padding:"18px 22px"},actionRef:n,request:f,onRequestError:function(e){console.error(e.message),r.ZP.error("数据加载失败,".concat(e.message))},columns:C,bordered:!0,rowKey:"id",pagination:{size:"default"},dateFormatter:"string",headerTitle:"企业列表",tableAlertRender:!1,toolBarRender:function(){return[(0,V.jsxs)(i.Z,{onClick:x,type:"primary",children:[(0,V.jsx)(s.Z,{}),"新建"]},"add")]}}),(0,V.jsx)(Y,{visible:c.visible,formData:c.formData,toggleVisible:function(){return Z("edit")},reload:t}),(0,V.jsx)(ae,{visible:I.visible,formData:I.formData,loading:I.loading,toggleVisible:function(){return Z("auth")},reload:t})]})}}}]);