(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[840],{84664:function(j){j.exports={formWrap:"formWrap___276Lb",rowWrap:"rowWrap___1Q2qE",listWrap:"listWrap___2GzdK",userName:"userName___3K3PK"}},55632:function(j){j.exports={treeWrap:"treeWrap___LOi_-",cover:"cover___3a6dl"}},31567:function(j,T,e){"use strict";var X=e(19597),D=e(2291),Y=e(37482),s=e(3810),Q=e(44742),l=e(67294),t=e(48786);T.Z=function(v){var L=v.buttons,R=v.maxNumber,y=R===void 0?2:R,k=v.className,ge=v.style,_=L.filter(function(a){return!a.hidden}),Ee=_.length,me=function(S){var h=S,p=[];return S.length>y&&(h=S.slice(0,y-1),p=S.slice(y-1)),[h,p]},re=(0,l.useMemo)(function(){return me(_)},[_]),fe=(0,Q.Z)(re,2),se=fe[0],ue=fe[1];return l.createElement("div",{className:k,style:ge},se.map(function(a,S){var h=a.name,p=a.key,ie=a.onClick,de=a.path,ce=l.createElement("a",{style:{marginRight:18},key:p,onClick:de?function(){return t.m8.push(de)}:ie},h);return S!==Ee-1?l.createElement(l.Fragment,{key:p},ce):ce}),ue.length>0&&l.createElement(D.Z,{overlay:l.createElement(s.Z,null,ue.map(function(a){return l.createElement(s.Z.Item,{onClick:a.path?function(){return t.m8.push(a.path)}:function(){var S;return(S=a.onClick)===null||S===void 0?void 0:S.call(a)}},a.name)}))},l.createElement("a",null,"\u66F4\u591A")))}},57044:function(j,T,e){"use strict";var X=e(87753),D=e(98570),Y=e(67294);T.Z=function(s){var Q=s.value,l=s.onChange,t=s.treeData,v=t===void 0?[]:t,L=function(y){l==null||l(y)};return Y.createElement(D.Z,{checkable:!0,defaultExpandAll:!0,onCheck:function(y){return L(y)},checkedKeys:Q,treeData:v})}},31261:function(j,T,e){"use strict";e.d(T,{Z:function(){return Y}});var X=e(67294),D=e(48786);function Y(s){var Q=(0,D.tT)("@@initialState"),l=Q.initialState,t=l||{},v=t.privileges,L=v===void 0?[]:v,R=(0,X.useMemo)(function(){return L.some(function(y){return y.resourceKey===s})},[L,s]);return{showCompanySelect:R}}},84850:function(j,T,e){"use strict";e.d(T,{Z:function(){return Y}});var X=e(44742),D=e(67294);function Y(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,Q=(0,D.useState)(!1),l=(0,X.Z)(Q,2),t=l[0],v=l[1],L=(0,D.useState)(""),R=(0,X.Z)(L,2),y=R[0],k=R[1];return(0,D.useEffect)(function(){v(s)},[]),{spinning:t,setSpinning:v,tip:y,setTip:k}}},29840:function(j,T,e){"use strict";e.r(T),e.d(T,{default:function(){return $e}});var X=e(13753),D=e(48429),Y=e(14643),s=e(92909),Q=e(97140),l=e(93228),t=e(67294),v=e(21191),L=e(49101),R=e(31567),y=e(26780),k=e(46567),ge=e(58210),_=e(87240),Ee=e(37092),me=e(91911),re=e(13378),fe=e(68137),se=e(50532),ue=e(3911),a=e(56361),S=e(67604),h=e(66498),p=e(44742),ie=e(46368),de=e(46391),ce=e(47376),q=e(66827),pe=e(84850),Ce=e(48786),oe=e(66594),Se=e(57044),Ae=e(55632),Ie=e.n(Ae),ye=e(50189),Ze=function(u){var C=[];return u?(Object.keys(u).forEach(function(m){C.push.apply(C,(0,ye.Z)(u[m].map(function(n){return n.id})))}),C):[]},Me=e(27870),Oe={labelCol:{span:3},wrapperCol:{span:20}},Fe={labelCol:{span:3},wrapperCol:{span:10}},Pe=function(u){var C=u.visible,m=u.toggleVisible,n=u.formData,w=u.loading,O=u.reload,g=h.Z.useForm(),b=(0,p.Z)(g,1),d=b[0],E=(0,pe.Z)(),U=E.tip,H=E.setTip,z=n.id,N=(0,Ce.tT)("@@initialState"),I=N.initialState,F=I||{},Z=F.authResourceData,M=F.userInfo,G=M||{},c=G.orgCode,o=(0,t.useState)(!1),r=(0,p.Z)(o,2),i=r[0],P=r[1];(0,t.useEffect)(function(){if(!(0,ie.Z)(n)){var x=n||{},$=x.resourceMap,ne=$===void 0?{}:$,ae=Ze(ne);d.setFieldsValue((0,a.Z)((0,a.Z)({},n),{},{resourceIds:ae,modalResourceIds:ae}))}return function(){d.resetFields()}},[n]);var V=function(){m(),d.resetFields()},ee=function($){var ne=$.resourceIds,ae=ne===void 0?[]:ne,J=$.modalResourceIds,f=(0,ue.Z)($,["resourceIds","modalResourceIds"]);H("\u6570\u636E\u4FDD\u5B58\u4E2D\uFF0C\u8BF7\u7A0D\u5019...");var B=(0,Me.HO)((0,a.Z)((0,a.Z)({},f),{},{clientKey:oe.OW.clientId,id:z,businessValue:c,resourceIds:ae.filter(function(K){return(0,de.Z)(K)})}));return API.authorization.resourceRole.resourceSave.fetch(B)},le=(0,q.QT)(ee,{manual:!0,onSuccess:function(){s.default.success("\u4FDD\u5B58\u6210\u529F"),d.resetFields(),m(),O==null||O()}}),W=le.run,te=le.loading;return t.createElement(h.Z,(0,re.Z)({form:d,onFinish:W},Fe),t.createElement(k.Z,{centered:!0,visible:C,forceRender:!0,maskClosable:!1,title:"".concat((0,ce.Z)(z)?"\u65B0\u5EFA":"\u7F16\u8F91","\u89D2\u8272"),okButtonProps:{htmlType:"submit"},width:800,onOk:function(){return d.submit()},onCancel:V,confirmLoading:te},t.createElement(_.Z,{spinning:w&&te,tip:U},t.createElement(h.Z.Item,{label:"\u89D2\u8272\u540D\u79F0",name:"role",rules:[{whitespace:!0},{required:!0}]},t.createElement(se.Z,{placeholder:"\u8BF7\u8F93\u5165"})),t.createElement(h.Z.Item,(0,re.Z)({label:"\u89D2\u8272\u63CF\u8FF0",name:"comment"},Oe,{rules:[{whitespace:!0}]}),t.createElement(se.Z,{placeholder:"\u8BF7\u8F93\u5165"})),t.createElement("div",{className:Ie().treeWrap},t.createElement("div",{className:Ie().cover,onClick:function(){return P(!0)}}),t.createElement(h.Z.Item,{label:"\u62E5\u6709\u8D44\u6E90",name:"resourceIds",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u62E5\u6709\u8D44\u6E90"}]},t.createElement(me.Z,{treeData:Z,allowClear:!0,multiple:!0,placeholder:"\u8BF7\u9009\u62E9"}))))),t.createElement(k.Z,{centered:!0,visible:i,forceRender:!0,maskClosable:!1,title:"\u62E5\u6709\u8D44\u6E90",width:412,onOk:function(){d.setFieldsValue({resourceIds:d.getFieldValue("modalResourceIds")}),P(!1)},onCancel:function(){d.setFieldsValue({modalResourceIds:d.getFieldValue("resourceIds")}),P(!1)},confirmLoading:te},t.createElement(h.Z.Item,{label:"\u62E5\u6709\u8D44\u6E90",name:"modalResourceIds",noStyle:!0},t.createElement(Se.Z,{treeData:Z}))))},Te=Pe,Qe=e(66518),De=e(95322),He=e(44862),Le=e(42091),be=e(3855),We=e(84664),ve=e.n(We),he=e(89193),xe={page:1,pageSize:6},Be={labelCol:{span:6},wrapperCol:{span:16}},Ke=function(A){var u=A.visible,C=A.toggleVisible,m=A.formData,n=A.reload,w=h.Z.useForm(),O=(0,p.Z)(w,1),g=O[0],b=(0,pe.Z)(),d=b.tip,E=b.setTip,U=m.id,H=(0,t.useState)([]),z=(0,p.Z)(H,2),N=z[0],I=z[1],F=(0,he.x)(xe),Z=(0,p.Z)(F,2),M=Z[0],G=Z[1],c=(0,q.QT)(API.platform.sysUser.pageList.fetch,{manual:!0}),o=c.data,r=c.run,i=c.loading,P=(0,q.QT)(API.authorization.resourceRole.resourceRoleDetailUser.fetch,{manual:!0,onSuccess:function(f){var B=f.userIdList,K=B===void 0?[]:B;I(K)}}),V=P.run,ee=P.loading;(0,t.useEffect)(function(){u&&(r(M),V({clientKey:oe.OW.clientId,roleId:U}))},[u,M]),(0,t.useEffect)(function(){return(0,ie.Z)(m)||g.setFieldsValue((0,a.Z)({},m)),function(){g.resetFields()}},[m]);var le=function(){C(),g.resetFields()},W=function(){return E("\u6570\u636E\u4FDD\u5B58\u4E2D\uFF0C\u8BF7\u7A0D\u5019..."),API.authorization.resourceRole.resourceSaveAddUser.fetch({clientKey:oe.OW.clientId,id:U,userIds:N.map(function(f){return+f}),resourceIds:m.resourceIds,role:m.role})},te=(0,q.QT)(W,{manual:!0,onSuccess:function(){s.default.success("\u6388\u6743\u6210\u529F"),g.resetFields(),C(),n==null||n()}}),x=te.run,$=te.loading,ne=function(f,B){var K=(0,ye.Z)(N);f.target.checked?K.push(+B.userId):K=K.filter(function(je){return je!==B.userId}),I(K)},ae=function(f){return t.createElement(De.ZP.Item,null,t.createElement(Le.Z,{checked:N.includes(+f.userId),onChange:function(K){return ne(K,f)}},t.createElement("div",{className:ve().userName},f.userName,f.phone?"(".concat(f.phone.slice(-4),")"):"")))};return t.createElement(k.Z,{centered:!0,visible:u,forceRender:!0,maskClosable:!1,title:"\u7528\u6237\u6388\u6743",okButtonProps:{htmlType:"submit"},width:442,onOk:function(){return g.submit()},onCancel:le,confirmLoading:$,wrapClassName:"auth-modal"},t.createElement(_.Z,{spinning:i&&$&&ee,tip:d},t.createElement(h.Z,(0,re.Z)({form:g,onFinish:x},Be,{className:ve().formWrap}),t.createElement(h.Z.Item,{label:"\u4F01\u4E1A\u7F16\u7801",name:"account",tooltip:{icon:t.createElement(be.Z,null),title:"\u4F01\u4E1A\u7F16\u7801\u5C06\u4F5C\u4E3A\u4F01\u4E1A\u4E0B\u6240\u6709\u8D26\u53F7\u540E\u7F00"},noStyle:!0},t.createElement(De.ZP,{loading:i,className:ve().listWrap,size:"small",dataSource:o==null?void 0:o.list,pagination:(0,a.Z)((0,a.Z)({},M),{},{current:M.page,onChange:function(f){G(function(B){B.page=f})},showQuickJumper:!0}),renderItem:ae})))))},Ue=e(68699),ze=e(94043),Re=e.n(ze),Ne=function(){var A=(0,t.useRef)(),u=(0,he.x)({visible:!1,formData:{},loading:!1}),C=(0,p.Z)(u,2),m=C[0],n=C[1],w=(0,he.x)({visible:!1,formData:{}}),O=(0,p.Z)(w,2),g=O[0],b=O[1],d=A.current||{},E=d.reload,U=(0,q.QT)(API.authorization.role.update.fetch,{manual:!0,onSuccess:function(){s.default.success("\u64CD\u4F5C\u6210\u529F"),E==null||E()}}),H=U.run,z=(0,q.QT)(API.authorization.resourceRole.resourceDelete.fetch,{manual:!0,onSuccess:function(){s.default.success("\u5220\u9664\u6210\u529F"),E==null||E()}}),N=z.run,I=function(){var c=(0,Ue.Z)(Re().mark(function o(r){var i,P,V,ee;return Re().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:return W.next=2,API.platform.sysRole.pageList.fetch((0,Me.HO)((0,a.Z)((0,a.Z)({},r),{},{page:(r==null?void 0:r.current)||oe.ii.page,pageSize:(r==null?void 0:r.pageSize)||oe.ii.pageSize})));case 2:return i=W.sent,P=i.list,V=i.page,ee=i.total,W.abrupt("return",{data:P||[],page:V,success:!0,total:ee});case 7:case"end":return W.stop()}},o)}));return function(r){return c.apply(this,arguments)}}(),F=function(o){n(function(r){r.visible=!0,r.loading=!0,r.formData=o})},Z=function(){n(function(o){o.visible=!0,o.formData={}})},M=function(o){var r=o||{},i=r.resourceMap,P=Ze(i);b(function(V){V.visible=!0,V.formData=(0,a.Z)((0,a.Z)({},o),{},{resourceIds:P})})},G=function(o){var r={edit:n,auth:b};r[o](function(i){i.visible=!1,i.loading=!1,i.formData={}})};return{actionRef:A,reload:E,editModalConfig:m,setEditModalConfig:n,authModalConfig:g,setAuthModalConfig:b,handleDisable:H,handleDelete:N,fetchList:I,handleRoleEdit:F,handleRoleAdd:Z,handleAuthorize:M,handleModalHide:G}},Ve=e(31261),$e=function(){var A=(0,Ce.tT)("company"),u=A.companyMapOptions,C=(0,Ve.Z)("auth_authority_menu_company"),m=C.showCompanySelect,n=Ne(),w=n.actionRef,O=n.reload,g=n.editModalConfig,b=n.fetchList,d=n.handleRoleAdd,E=n.handleRoleEdit,U=n.handleModalHide,H=n.authModalConfig,z=n.handleAuthorize,N=[{title:"\u4F01\u4E1A\u540D\u79F0",dataIndex:"orgCode",align:"left",copyable:!1,valueType:"text",hideInSearch:!m,hideInTable:!0,renderFormItem:function(){return t.createElement(l.Z,{allowClear:!0,options:u})}},{title:"\u89D2\u8272\u540D\u79F0",dataIndex:"role",align:"left",copyable:!1,valueType:"text",hideInSearch:!1},{title:"\u89D2\u8272\u63CF\u8FF0",dataIndex:"comment",align:"left",copyable:!1,valueType:"text",hideInSearch:!0},{title:"\u62E5\u6709\u8D44\u6E90",dataIndex:"resourceList",align:"left",copyable:!1,valueType:"text",hideInSearch:!0,render:function(F,Z){var M=Z||{},G=M.resourceMap,c=G===void 0?[]:G,o=[];return Object.keys(c).forEach(function(r){c[r].forEach(function(i){o.push(i.description)})}),o.join(",")}},{title:"\u64CD\u4F5C",dataIndex:"id",align:"left",copyable:!1,valueType:"text",hideInSearch:!0,render:function(F,Z){return t.createElement(R.Z,{buttons:[{name:"\u7F16\u8F91",key:"edit",onClick:function(){return E(Z)}},{name:"\u6388\u6743",key:"authorize",onClick:function(){return z(Z)}}]})}}];return t.createElement(t.Fragment,null,t.createElement(v.ZP,{style:{padding:"18px 22px"},actionRef:w,request:b,onRequestError:function(F){console.error(F.message),s.default.error("\u6570\u636E\u52A0\u8F7D\u5931\u8D25,".concat(F.message))},columns:N,bordered:!0,rowKey:"id",pagination:{size:"default"},dateFormatter:"string",headerTitle:"\u83DC\u5355\u6743\u9650\u5217\u8868",tableAlertRender:!1,toolBarRender:function(){return[t.createElement(D.Z,{onClick:d,key:"add",type:"primary"},t.createElement(L.Z,null),"\u65B0\u5EFA")]}}),t.createElement(Te,{visible:g.visible,formData:g.formData,loading:g.loading,toggleVisible:function(){return U("edit")},reload:O}),t.createElement(Ke,{visible:H.visible,formData:H.formData,toggleVisible:function(){return U("auth")},reload:O}))}}}]);
