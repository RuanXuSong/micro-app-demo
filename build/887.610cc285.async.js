(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[887],{84664:function(j){j.exports={formWrap:"formWrap___276Lb",rowWrap:"rowWrap___1Q2qE",listWrap:"listWrap___2GzdK",userName:"userName___3K3PK"}},55632:function(j){j.exports={treeWrap:"treeWrap___LOi_-",cover:"cover___3a6dl"}},31567:function(j,O,e){"use strict";var Q=e(19597),R=e(2291),H=e(37482),m=e(3810),ee=e(44742),s=e(67294),t=e(48786);O.Z=function(C){var T=C.buttons,l=C.maxNumber,n=l===void 0?2:l,a=C.className,G=C.style,h=T.filter(function(o){return!o.hidden}),ue=h.length,te=function(y){var g=y,I=[];return y.length>n&&(g=y.slice(0,n-1),I=y.slice(n-1)),[g,I]},k=(0,s.useMemo)(function(){return te(h)},[h]),L=(0,ee.Z)(k,2),K=L[0],oe=L[1];return s.createElement("div",{className:a,style:G},K.map(function(o,y){var g=o.name,I=o.key,J=o.onClick,se=o.path,x=s.createElement("a",{style:{marginRight:18},key:I,onClick:se?function(){return t.m8.push(se)}:J},g);return y!==ue-1?s.createElement(s.Fragment,{key:I},x):x}),oe.length>0&&s.createElement(R.Z,{overlay:s.createElement(m.Z,null,oe.map(function(o){return s.createElement(m.Z.Item,{onClick:o.path?function(){return t.m8.push(o.path)}:function(){var y;return(y=o.onClick)===null||y===void 0?void 0:y.call(o)}},o.name)}))},s.createElement("a",null,"\u66F4\u591A")))}},57044:function(j,O,e){"use strict";var Q=e(87753),R=e(98570),H=e(67294),m=e(96486),ee=e.n(m);O.Z=function(s){var t=s.value,C=t===void 0?[]:t,T=s.onChange,l=s.treeData,n=l===void 0?[]:l,a=function(h,ue){var te=ue||{},k=te.node,L=te.checked,K=k||{},oe=K.children,o=oe===void 0?[]:oe,y=h.checked,g=function I(J){if(!(!J||(0,m.isEmpty)(J))){var se=J.map(function(x){return x.key});L||(y=y.filter(function(x){return!se.includes(x)})),J.forEach(function(x){(0,m.isEmpty)(x.children)||I(x.children)})}};g(o),T==null||T(y)};return H.createElement(R.Z,{checkable:!0,defaultExpandAll:!0,onCheck:a,checkedKeys:C,treeData:n,checkStrictly:!0})}},31261:function(j,O,e){"use strict";e.d(O,{Z:function(){return H}});var Q=e(67294),R=e(48786);function H(m){var ee=(0,R.tT)("@@initialState"),s=ee.initialState,t=s||{},C=t.privileges,T=C===void 0?[]:C,l=(0,Q.useMemo)(function(){return T.some(function(n){return n.resourceKey===m})},[T,m]);return{showCompanySelect:l}}},84850:function(j,O,e){"use strict";e.d(O,{Z:function(){return H}});var Q=e(44742),R=e(67294);function H(){var m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,ee=(0,R.useState)(!1),s=(0,Q.Z)(ee,2),t=s[0],C=s[1],T=(0,R.useState)(""),l=(0,Q.Z)(T,2),n=l[0],a=l[1];return(0,R.useEffect)(function(){C(m)},[]),{spinning:t,setSpinning:C,tip:n,setTip:a}}},76887:function(j,O,e){"use strict";e.r(O),e.d(O,{default:function(){return He}});var Q=e(13753),R=e(48429),H=e(14643),m=e(92909),ee=e(97140),s=e(93228),t=e(67294),C=e(21191),T=e(49101),l=e(31567),n=e(26780),a=e(46567),G=e(58210),h=e(87240),ue=e(37092),te=e(91911),k=e(13378),L=e(68137),K=e(50532),oe=e(3911),o=e(56361),y=e(67604),g=e(66498),I=e(44742),J=e(46368),se=e(46391),x=e(47376),ie=e(66827),Ee=e(84850),Ce=e(48786),ve=e(66594),Re=e(57044),Te=e(55632),ye=e.n(Te),Ie=e(50189),Ze=function(d){var c=[];return d?(Object.keys(d).forEach(function(f){c.push.apply(c,(0,Ie.Z)(d[f].map(function(r){return r.id})))}),c):[]},Me=e(27870),Ae={labelCol:{span:3},wrapperCol:{span:20}},Oe={labelCol:{span:3},wrapperCol:{span:10}},Pe=function(d){var c=d.visible,f=d.toggleVisible,r=d.formData,le=d.loading,b=d.reload,D=g.Z.useForm(),U=(0,I.Z)(D,1),p=U[0],S=(0,Ee.Z)(),Y=S.tip,ne=S.setTip,X=r.id,_=(0,Ce.tT)("@@initialState"),A=_.initialState,W=A||{},P=W.authResourceData,F=W.userInfo,ae=F||{},E=ae.orgCode,i=(0,t.useState)(!1),u=(0,I.Z)(i,2),v=u[0],B=u[1];(0,t.useEffect)(function(){if(!(0,J.Z)(r)){var $=r||{},q=$.resourceMap,me=q===void 0?{}:q,fe=Ze(me);p.setFieldsValue((0,o.Z)((0,o.Z)({},r),{},{resourceIds:fe,modalResourceIds:fe}))}return function(){p.resetFields()}},[r]);var w=function(){f(),p.resetFields()},de=function(q){var me=q.resourceIds,fe=me===void 0?[]:me,re=q.modalResourceIds,Z=(0,oe.Z)(q,["resourceIds","modalResourceIds"]);ne("\u6570\u636E\u4FDD\u5B58\u4E2D\uFF0C\u8BF7\u7A0D\u5019...");var z=(0,Me.HO)((0,o.Z)((0,o.Z)({},Z),{},{clientKey:ve.OW.clientId,id:X,businessValue:E,resourceIds:fe.filter(function(V){return(0,se.Z)(V)})}));return API.authorization.resourceRole.resourceSave.fetch(z)},he=(0,ie.QT)(de,{manual:!0,onSuccess:function(){m.default.success("\u4FDD\u5B58\u6210\u529F"),p.resetFields(),f(),b==null||b()}}),N=he.run,ce=he.loading;return t.createElement(g.Z,(0,k.Z)({form:p,onFinish:N},Oe),t.createElement(a.Z,{centered:!0,visible:c,forceRender:!0,maskClosable:!1,title:"".concat((0,x.Z)(X)?"\u65B0\u5EFA":"\u7F16\u8F91","\u89D2\u8272"),okButtonProps:{htmlType:"submit"},width:800,onOk:function(){return p.submit()},onCancel:w,confirmLoading:ce},t.createElement(h.Z,{spinning:le&&ce,tip:Y},t.createElement(g.Z.Item,{label:"\u89D2\u8272\u540D\u79F0",name:"role",rules:[{whitespace:!0},{required:!0}]},t.createElement(K.Z,{placeholder:"\u8BF7\u8F93\u5165"})),t.createElement(g.Z.Item,(0,k.Z)({label:"\u89D2\u8272\u63CF\u8FF0",name:"comment"},Ae,{rules:[{whitespace:!0}]}),t.createElement(K.Z,{placeholder:"\u8BF7\u8F93\u5165"})),t.createElement("div",{className:ye().treeWrap},t.createElement("div",{className:ye().cover,onClick:function(){return B(!0)}}),t.createElement(g.Z.Item,{label:"\u62E5\u6709\u8D44\u6E90",name:"resourceIds",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u62E5\u6709\u8D44\u6E90"}]},t.createElement(te.Z,{treeData:P,allowClear:!0,multiple:!0,placeholder:"\u8BF7\u9009\u62E9"}))))),t.createElement(a.Z,{centered:!0,visible:v,forceRender:!0,maskClosable:!1,title:"\u62E5\u6709\u8D44\u6E90",width:412,onOk:function(){p.setFieldsValue({resourceIds:p.getFieldValue("modalResourceIds")}),B(!1)},onCancel:function(){p.setFieldsValue({modalResourceIds:p.getFieldValue("resourceIds")}),B(!1)},confirmLoading:ce},t.createElement(g.Z.Item,{label:"\u62E5\u6709\u8D44\u6E90",name:"modalResourceIds",noStyle:!0},t.createElement(Re.Z,{treeData:P}))))},Fe=Pe,ke=e(66518),De=e(95322),Je=e(44862),Le=e(42091),xe=e(3855),be=e(84664),ge=e.n(be),pe=e(89193),We={page:1,pageSize:6},Be={labelCol:{span:6},wrapperCol:{span:16}},Ke=function(M){var d=M.visible,c=M.toggleVisible,f=M.formData,r=M.reload,le=g.Z.useForm(),b=(0,I.Z)(le,1),D=b[0],U=(0,Ee.Z)(),p=U.tip,S=U.setTip,Y=f.id,ne=(0,t.useState)([]),X=(0,I.Z)(ne,2),_=X[0],A=X[1],W=(0,pe.x)(We),P=(0,I.Z)(W,2),F=P[0],ae=P[1],E=(0,ie.QT)(API.platform.sysUser.pageList.fetch,{manual:!0}),i=E.data,u=E.run,v=E.loading,B=(0,ie.QT)(API.authorization.resourceRole.resourceRoleDetailUser.fetch,{manual:!0,onSuccess:function(Z){var z=Z.userIdList,V=z===void 0?[]:z;A(V)}}),w=B.run,de=B.loading;(0,t.useEffect)(function(){d&&(u(F),w({clientKey:ve.OW.clientId,roleId:Y}))},[d,F]),(0,t.useEffect)(function(){return(0,J.Z)(f)||D.setFieldsValue((0,o.Z)({},f)),function(){D.resetFields()}},[f]);var he=function(){c(),D.resetFields()},N=function(){return S("\u6570\u636E\u4FDD\u5B58\u4E2D\uFF0C\u8BF7\u7A0D\u5019..."),API.authorization.resourceRole.resourceSaveAddUser.fetch({clientKey:ve.OW.clientId,id:Y,userIds:_.map(function(Z){return+Z}),resourceIds:f.resourceIds,role:f.role})},ce=(0,ie.QT)(N,{manual:!0,onSuccess:function(){m.default.success("\u6388\u6743\u6210\u529F"),D.resetFields(),c(),r==null||r()}}),$=ce.run,q=ce.loading,me=function(Z,z){var V=(0,Ie.Z)(_);Z.target.checked?V.push(+z.userId):V=V.filter(function(Ge){return Ge!==z.userId}),A(V)},fe=function(Z){return t.createElement(De.ZP.Item,null,t.createElement(Le.Z,{checked:_.includes(+Z.userId),onChange:function(V){return me(V,Z)}},t.createElement("div",{className:ge().userName},Z.userName,Z.phone?"(".concat(Z.phone.slice(-4),")"):"")))};return t.createElement(a.Z,{centered:!0,visible:d,forceRender:!0,maskClosable:!1,title:"\u7528\u6237\u6388\u6743",okButtonProps:{htmlType:"submit"},width:442,onOk:function(){return D.submit()},onCancel:he,confirmLoading:q,wrapClassName:"auth-modal"},t.createElement(h.Z,{spinning:v&&q&&de,tip:p},t.createElement(g.Z,(0,k.Z)({form:D,onFinish:$},Be,{className:ge().formWrap}),t.createElement(g.Z.Item,{label:"\u4F01\u4E1A\u7F16\u7801",name:"account",tooltip:{icon:t.createElement(xe.Z,null),title:"\u4F01\u4E1A\u7F16\u7801\u5C06\u4F5C\u4E3A\u4F01\u4E1A\u4E0B\u6240\u6709\u8D26\u53F7\u540E\u7F00"},noStyle:!0},t.createElement(De.ZP,{loading:v,className:ge().listWrap,size:"small",dataSource:i==null?void 0:i.list,pagination:(0,o.Z)((0,o.Z)({},F),{},{current:F.page,onChange:function(Z){ae(function(z){z.page=Z})},showQuickJumper:!0}),renderItem:fe})))))},Ue=e(68699),Ne=e(94043),Se=e.n(Ne),$e=function(){var M=(0,t.useRef)(),d=(0,pe.x)({visible:!1,formData:{},loading:!1}),c=(0,I.Z)(d,2),f=c[0],r=c[1],le=(0,pe.x)({visible:!1,formData:{}}),b=(0,I.Z)(le,2),D=b[0],U=b[1],p=M.current||{},S=p.reload,Y=(0,ie.QT)(API.authorization.role.update.fetch,{manual:!0,onSuccess:function(){m.default.success("\u64CD\u4F5C\u6210\u529F"),S==null||S()}}),ne=Y.run,X=(0,ie.QT)(API.authorization.resourceRole.resourceDelete.fetch,{manual:!0,onSuccess:function(){m.default.success("\u5220\u9664\u6210\u529F"),S==null||S()}}),_=X.run,A=function(){var E=(0,Ue.Z)(Se().mark(function i(u){var v,B,w,de;return Se().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:return N.next=2,API.platform.sysRole.pageList.fetch((0,Me.HO)((0,o.Z)((0,o.Z)({},u),{},{page:(u==null?void 0:u.current)||ve.ii.page,pageSize:(u==null?void 0:u.pageSize)||ve.ii.pageSize})));case 2:return v=N.sent,B=v.list,w=v.page,de=v.total,N.abrupt("return",{data:B||[],page:w,success:!0,total:de});case 7:case"end":return N.stop()}},i)}));return function(u){return E.apply(this,arguments)}}(),W=function(i){r(function(u){u.visible=!0,u.loading=!0,u.formData=i})},P=function(){r(function(i){i.visible=!0,i.formData={}})},F=function(i){var u=i||{},v=u.resourceMap,B=Ze(v);U(function(w){w.visible=!0,w.formData=(0,o.Z)((0,o.Z)({},i),{},{resourceIds:B})})},ae=function(i){var u={edit:r,auth:U};u[i](function(v){v.visible=!1,v.loading=!1,v.formData={}})};return{actionRef:M,reload:S,editModalConfig:f,setEditModalConfig:r,authModalConfig:D,setAuthModalConfig:U,handleDisable:ne,handleDelete:_,fetchList:A,handleRoleEdit:W,handleRoleAdd:P,handleAuthorize:F,handleModalHide:ae}},ze=e(31261),Ye=e(81984),Ve=e(82692),je=e(73567),Qe=function(M){var d=M.text,c=d===void 0?"":d,f=M.maxLength,r=f===void 0?50:f;return(c==null?void 0:c.length)>r?t.createElement(Ve.Z,{title:c},t.createElement("span",null,je.ZP.textEllipsis(c,r))):t.createElement("span",null,c)},He=function(){var M=(0,Ce.tT)("company"),d=M.companyMapOptions,c=(0,ze.Z)("auth_authority_menu_company"),f=c.showCompanySelect,r=$e(),le=r.actionRef,b=r.reload,D=r.editModalConfig,U=r.fetchList,p=r.handleRoleAdd,S=r.handleRoleEdit,Y=r.handleModalHide,ne=r.authModalConfig,X=r.handleAuthorize,_=[{title:"\u4F01\u4E1A\u540D\u79F0",dataIndex:"orgCode",align:"left",copyable:!1,valueType:"text",hideInSearch:!f,hideInTable:!0,renderFormItem:function(){return t.createElement(s.Z,{allowClear:!0,options:d})}},{title:"\u89D2\u8272\u540D\u79F0",dataIndex:"role",align:"left",copyable:!1,valueType:"text",hideInSearch:!1},{title:"\u89D2\u8272\u63CF\u8FF0",dataIndex:"comment",align:"left",copyable:!1,valueType:"text",hideInSearch:!0},{title:"\u62E5\u6709\u8D44\u6E90",dataIndex:"resourceList",align:"left",copyable:!1,valueType:"text",hideInSearch:!0,render:function(W,P){var F=P||{},ae=F.resourceMap,E=ae===void 0?[]:ae,i=[];return Object.keys(E).forEach(function(u){E[u].forEach(function(v){i.push(v.description)})}),t.createElement(Qe,{text:i.join(",")})}},{title:"\u64CD\u4F5C",dataIndex:"id",align:"left",copyable:!1,valueType:"text",hideInSearch:!0,render:function(W,P){return t.createElement(l.Z,{buttons:[{name:"\u7F16\u8F91",key:"edit",onClick:function(){return S(P)}},{name:"\u6388\u6743",key:"authorize",onClick:function(){return X(P)}}]})}}];return t.createElement(t.Fragment,null,t.createElement(C.ZP,{style:{padding:"18px 22px"},actionRef:le,request:U,onRequestError:function(W){console.error(W.message),m.default.error("\u6570\u636E\u52A0\u8F7D\u5931\u8D25,".concat(W.message))},columns:_,bordered:!0,rowKey:"id",pagination:{size:"default"},dateFormatter:"string",headerTitle:"\u83DC\u5355\u6743\u9650\u5217\u8868",tableAlertRender:!1,toolBarRender:function(){return[t.createElement(R.Z,{onClick:p,key:"add",type:"primary"},t.createElement(T.Z,null),"\u65B0\u5EFA")]}}),t.createElement(Fe,{visible:D.visible,formData:D.formData,loading:D.loading,toggleVisible:function(){return Y("edit")},reload:b}),t.createElement(Ke,{visible:ne.visible,formData:ne.formData,toggleVisible:function(){return Y("auth")},reload:b}))}},73567:function(j,O,e){"use strict";var Q=1,R=1,H=4;O.ZP={fillZero:function(n){return typeof n=="number"&&n>=10?n:"0".concat(n)},textEllipsis:function(n,a){return n.length>a&&a>0?"".concat(n.substring(0,a),"..."):n},getLastSubstring:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";return n.substring(n.lastIndexOf(a)+a.length,n.length)},valueToString:function(n){return typeof n=="string"?n:JSON.stringify(n)},copyText:function(n){var a=document.createElement("input");document.body.appendChild(a),a.setAttribute("value",n),a.select(),document.execCommand("copy"),document.body.removeChild(a)},imgUrlToBase64:function(n,a,G){var h=document.createElement("canvas"),ue=h.getContext("2d");return new Promise(function(te,k){var L=new Image;L.crossOrigin="Anonymous",L.onload=function(){h.width=a,h.height=G,ue.drawImage(L,0,0,a,G);var K=h.toDataURL("image/");h=null,te(K)},L.onerror=function(K){k(K)},L.src=n})}};var m=function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:2;return n||n===0?(n/100).toFixed(a):""},ee=function(n){return n*100},s=function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return n?"".concat(n.slice(0,a),"****").concat(n.slice(-a)):""},t=function(n){var a=/(?<=.)./g;return n==null?void 0:n.replace(a,"*")},C=function(n){var a,G=(a=n==null?void 0:n.split("-"))!==null&&a!==void 0?a:[];return G.filter(function(h){return!!h}).length===2?n:G.join("")},T=function(n,a){return n===Q&&(a===R||a===H)}}}]);
