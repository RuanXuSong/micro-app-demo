(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[840],{84664:function(H){H.exports={formWrap:"formWrap___276Lb",rowWrap:"rowWrap___1Q2qE",listWrap:"listWrap___2GzdK",userName:"userName___3K3PK"}},55632:function(H){H.exports={treeWrap:"treeWrap___LOi_-",cover:"cover___3a6dl"}},31567:function(H,V,e){"use strict";var ee=e(19597),b=e(2291),te=e(37482),g=e(3810),Y=e(44742),l=e(67294),t=e(48786);V.Z=function(Z){var G=Z.buttons,W=Z.maxNumber,R=W===void 0?2:W,J=Z.className,Ee=Z.style,w=G.filter(function(n){return!n.hidden}),pe=w.length,me=function(y){var E=y,I=[];return y.length>R&&(E=y.slice(0,R-1),I=y.slice(R-1)),[E,I]},ne=(0,l.useMemo)(function(){return me(w)},[w]),fe=(0,Y.Z)(ne,2),se=fe[0],ue=fe[1];return l.createElement("div",{className:J,style:Ee},se.map(function(n,y){var E=n.name,I=n.key,ie=n.onClick,de=n.path,ce=l.createElement("a",{style:{marginRight:18},key:I,onClick:de?function(){return t.m8.push(de)}:ie},E);return y!==pe-1?l.createElement(l.Fragment,{key:I},ce):ce}),ue.length>0&&l.createElement(b.Z,{overlay:l.createElement(g.Z,null,ue.map(function(n){return l.createElement(g.Z.Item,{onClick:n.path?function(){return t.m8.push(n.path)}:function(){var y;return(y=n.onClick)===null||y===void 0?void 0:y.call(n)}},n.name)}))},l.createElement("a",null,"\u66F4\u591A")))}},57044:function(H,V,e){"use strict";var ee=e(87753),b=e(98570),te=e(67294);V.Z=function(g){var Y=g.value,l=g.onChange,t=g.treeData,Z=t===void 0?[]:t,G=function(R){l==null||l(R)};return te.createElement(b.Z,{checkable:!0,defaultExpandAll:!0,onCheck:function(R){return G(R)},checkedKeys:Y,treeData:Z})}},84850:function(H,V,e){"use strict";e.d(V,{Z:function(){return te}});var ee=e(44742),b=e(67294);function te(){var g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,Y=(0,b.useState)(!1),l=(0,ee.Z)(Y,2),t=l[0],Z=l[1],G=(0,b.useState)(""),W=(0,ee.Z)(G,2),R=W[0],J=W[1];return(0,b.useEffect)(function(){Z(g)},[]),{spinning:t,setSpinning:Z,tip:R,setTip:J}}},29840:function(H,V,e){"use strict";e.r(V),e.d(V,{default:function(){return Ue}});var ee=e(13753),b=e(48429),te=e(14643),g=e(92909),Y=e(97140),l=e(93228),t=e(67294),Z=e(21191),G=e(49101),W=e(31567),R=e(26780),J=e(46567),Ee=e(58210),w=e(87240),pe=e(37092),me=e(91911),ne=e(13378),fe=e(68137),se=e(50532),ue=e(3911),n=e(56361),y=e(67604),E=e(66498),I=e(44742),ie=e(46368),de=e(46391),ce=e(47376),_=e(66827),Ie=e(84850),ve=e(48786),ae=e(66594),Re=e(57044),Se=e(55632),Ce=e.n(Se),Ze=e(50189),ye=function(d){var C=[];return d?(Object.keys(d).forEach(function(m){C.push.apply(C,(0,Ze.Z)(d[m].map(function(s){return s.id})))}),C):[]},Ae={labelCol:{span:3},wrapperCol:{span:20}},Fe={labelCol:{span:3},wrapperCol:{span:10}},Oe=function(d){var C=d.visible,m=d.toggleVisible,s=d.formData,k=d.loading,S=d.reload,o=E.Z.useForm(),A=(0,I.Z)(o,1),c=A[0],f=(0,Ie.Z)(),U=f.tip,X=f.setTip,x=s.id,F=(0,ve.tT)("@@initialState"),B=F.initialState,$=B||{},K=$.authResourceData,v=$.userInfo,O=v||{},u=O.orgCode,r=(0,t.useState)(!1),a=(0,I.Z)(r,2),i=a[0],p=a[1];(0,t.useEffect)(function(){if(!(0,ie.Z)(s)){var T=s||{},z=T.resourceMap,oe=z===void 0?{}:z,le=ye(oe);c.setFieldsValue((0,n.Z)((0,n.Z)({},s),{},{resourceIds:le,modalResourceIds:le}))}return function(){c.resetFields()}},[s]);var M=function(){m(),c.resetFields()},j=function(z){var oe=z.resourceIds,le=z.modalResourceIds,N=(0,ue.Z)(z,["resourceIds","modalResourceIds"]);X("\u6570\u636E\u4FDD\u5B58\u4E2D\uFF0C\u8BF7\u7A0D\u5019...");var h=(0,n.Z)((0,n.Z)({},N),{},{clientKey:ae.OW.clientId,id:x,businessValue:u,resourceIds:oe.filter(function(L){return(0,de.Z)(L)})});return API.authorization.resourceRole.resourceSave.fetch(h)},re=(0,_.QT)(j,{manual:!0,onSuccess:function(){g.default.success("\u4FDD\u5B58\u6210\u529F"),c.resetFields(),m(),S==null||S()}}),P=re.run,q=re.loading;return t.createElement(E.Z,(0,ne.Z)({form:c,onFinish:P},Fe),t.createElement(J.Z,{centered:!0,visible:C,forceRender:!0,maskClosable:!1,title:"".concat((0,ce.Z)(x)?"\u65B0\u5EFA":"\u7F16\u8F91","\u89D2\u8272"),okButtonProps:{htmlType:"submit"},width:800,onOk:function(){return c.submit()},onCancel:M,confirmLoading:q},t.createElement(w.Z,{spinning:k&&q,tip:U},t.createElement(E.Z.Item,{label:"\u89D2\u8272\u540D\u79F0",name:"role",rules:[{whitespace:!0},{required:!0}]},t.createElement(se.Z,{placeholder:"\u8BF7\u8F93\u5165"})),t.createElement(E.Z.Item,(0,ne.Z)({label:"\u89D2\u8272\u63CF\u8FF0",name:"comment"},Ae,{rules:[{whitespace:!0}]}),t.createElement(se.Z,{placeholder:"\u8BF7\u8F93\u5165"})),t.createElement("div",{className:Ce().treeWrap},t.createElement("div",{className:Ce().cover,onClick:function(){return p(!0)}}),t.createElement(E.Z.Item,{label:"\u62E5\u6709\u8D44\u6E90",name:"resourceIds"},t.createElement(me.Z,{treeData:K,allowClear:!0,multiple:!0,placeholder:"\u8BF7\u9009\u62E9"}))))),t.createElement(J.Z,{centered:!0,visible:i,forceRender:!0,maskClosable:!1,title:"\u62E5\u6709\u8D44\u6E90",width:412,onOk:function(){c.setFieldsValue({resourceIds:c.getFieldValue("modalResourceIds")}),p(!1)},onCancel:function(){c.setFieldsValue({modalResourceIds:c.getFieldValue("resourceIds")}),p(!1)},confirmLoading:q},t.createElement(E.Z.Item,{label:"\u62E5\u6709\u8D44\u6E90",name:"modalResourceIds",noStyle:!0},t.createElement(Re.Z,{treeData:K}))))},Pe=Oe,je=e(66518),De=e(95322),Qe=e(44862),Te=e(42091),Le=e(3855),be=e(84664),he=e.n(be),ge=e(89193),We={page:1,pageSize:6},xe={labelCol:{span:6},wrapperCol:{span:16}},Be=function(D){var d=D.visible,C=D.toggleVisible,m=D.formData,s=D.reload,k=E.Z.useForm(),S=(0,I.Z)(k,1),o=S[0],A=(0,Ie.Z)(),c=A.tip,f=A.setTip,U=m.id,X=(0,t.useState)([]),x=(0,I.Z)(X,2),F=x[0],B=x[1],$=(0,ge.x)(We),K=(0,I.Z)($,2),v=K[0],O=K[1],u=(0,_.QT)(API.platform.sysUser.pageList.fetch,{manual:!0}),r=u.data,a=u.run,i=u.loading,p=(0,_.QT)(API.authorization.resourceRole.resourceRoleDetailUser.fetch,{manual:!0,onSuccess:function(h){var L=h.userIdList,Q=L===void 0?[]:L;B(Q)}}),M=p.run,j=p.loading;(0,t.useEffect)(function(){d&&(a(v),M({clientKey:ae.OW.clientId,roleId:U}))},[d,v]),(0,t.useEffect)(function(){return(0,ie.Z)(m)||o.setFieldsValue((0,n.Z)({},m)),function(){o.resetFields()}},[m]);var re=function(){C(),o.resetFields()},P=function(){return f("\u6570\u636E\u4FDD\u5B58\u4E2D\uFF0C\u8BF7\u7A0D\u5019..."),API.authorization.resourceRole.resourceSave.fetch({clientKey:ae.OW.clientId,id:U,userIds:F.map(function(h){return+h}),resourceIds:m.resourceIds,role:m.role})},q=(0,_.QT)(P,{manual:!0,onSuccess:function(){g.default.success("\u6388\u6743\u6210\u529F"),o.resetFields(),C(),s==null||s()}}),T=q.run,z=q.loading,oe=function(h,L){var Q=(0,Ze.Z)(F);h.target.checked?Q.push(+L.userId):Q=Q.filter(function($e){return $e!==L.userId}),B(Q)},le=function(h){return t.createElement(De.ZP.Item,null,t.createElement(Te.Z,{checked:F.includes(+h.userId),onChange:function(Q){return oe(Q,h)}},t.createElement("div",{className:he().userName},h.userName,h.phone?"(".concat(h.phone.slice(-4),")"):"")))};return t.createElement(J.Z,{centered:!0,visible:d,forceRender:!0,maskClosable:!1,title:"\u7528\u6237\u6388\u6743",okButtonProps:{htmlType:"submit"},width:442,onOk:function(){return o.submit()},onCancel:re,confirmLoading:z,wrapClassName:"auth-modal"},t.createElement(w.Z,{spinning:i&&z&&j,tip:c},t.createElement(E.Z,(0,ne.Z)({form:o,onFinish:T},xe,{className:he().formWrap}),t.createElement(E.Z.Item,{label:"\u4F01\u4E1A\u7F16\u7801",name:"account",tooltip:{icon:t.createElement(Le.Z,null),title:"\u4F01\u4E1A\u7F16\u7801\u5C06\u4F5C\u4E3A\u4F01\u4E1A\u4E0B\u6240\u6709\u8D26\u53F7\u540E\u7F00"},noStyle:!0},t.createElement(De.ZP,{loading:i,className:he().listWrap,size:"small",dataSource:r==null?void 0:r.list,pagination:(0,n.Z)((0,n.Z)({},v),{},{current:v.page,onChange:function(h){O(function(L){L.page=h})},showQuickJumper:!0}),renderItem:le})))))},Ke=e(68699),ze=e(94043),Me=e.n(ze),Ne=e(27870),Ve=function(){var D=(0,t.useRef)(),d=(0,ge.x)({visible:!1,formData:{},loading:!1}),C=(0,I.Z)(d,2),m=C[0],s=C[1],k=(0,ge.x)({visible:!1,formData:{}}),S=(0,I.Z)(k,2),o=S[0],A=S[1],c=D.current||{},f=c.reload,U=(0,_.QT)(API.authorization.role.update.fetch,{manual:!0,onSuccess:function(){g.default.success("\u64CD\u4F5C\u6210\u529F"),f==null||f()}}),X=U.run,x=(0,_.QT)(API.authorization.resourceRole.resourceDelete.fetch,{manual:!0,onSuccess:function(){g.default.success("\u5220\u9664\u6210\u529F"),f==null||f()}}),F=x.run,B=function(){var u=(0,Ke.Z)(Me().mark(function r(a){var i,p,M,j;return Me().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return P.next=2,API.platform.sysRole.pageList.fetch((0,Ne.HO)((0,n.Z)((0,n.Z)({},a),{},{page:(a==null?void 0:a.current)||ae.ii.page,pageSize:(a==null?void 0:a.pageSize)||ae.ii.pageSize})));case 2:return i=P.sent,p=i.list,M=i.page,j=i.total,P.abrupt("return",{data:p||[],page:M,success:!0,total:j});case 7:case"end":return P.stop()}},r)}));return function(a){return u.apply(this,arguments)}}(),$=function(r){s(function(a){a.visible=!0,a.loading=!0,a.formData=r})},K=function(){s(function(r){r.visible=!0,r.formData={}})},v=function(r){var a=r||{},i=a.resourceMap,p=ye(i);A(function(M){M.visible=!0,M.formData=(0,n.Z)((0,n.Z)({},r),{},{resourceIds:p})})},O=function(r){var a={edit:s,auth:A};a[r](function(i){i.visible=!1,i.loading=!1,i.formData={}})};return{actionRef:D,reload:f,editModalConfig:m,setEditModalConfig:s,authModalConfig:o,setAuthModalConfig:A,handleDisable:X,handleDelete:F,fetchList:B,handleRoleEdit:$,handleRoleAdd:K,handleAuthorize:v,handleModalHide:O}},Ue=function(){var D=(0,ve.tT)("@@initialState"),d=D.initialState,C=d||{},m=C.userInfo,s=m===void 0?{}:m,k=(0,ve.tT)("company"),S=k.companyMapOptions,o=Ve(),A=o.actionRef,c=o.reload,f=o.editModalConfig,U=o.fetchList,X=o.handleRoleAdd,x=o.handleRoleEdit,F=o.handleModalHide,B=o.authModalConfig,$=o.handleAuthorize,K=[{title:"\u4F01\u4E1A\u540D\u79F0",dataIndex:"orgCode",align:"left",copyable:!1,valueType:"text",hideInSearch:!!s.orgId,hideInTable:!0,renderFormItem:function(){return t.createElement(l.Z,{allowClear:!0,options:S})}},{title:"\u89D2\u8272\u540D\u79F0",dataIndex:"role",align:"left",copyable:!1,valueType:"text",hideInSearch:!1},{title:"\u89D2\u8272\u63CF\u8FF0",dataIndex:"comment",align:"left",copyable:!1,valueType:"text",hideInSearch:!0},{title:"\u62E5\u6709\u8D44\u6E90",dataIndex:"resourceList",align:"left",copyable:!1,valueType:"text",hideInSearch:!0,render:function(O,u){var r=u||{},a=r.resourceMap,i=a===void 0?[]:a,p=[];return Object.keys(i).forEach(function(M){i[M].forEach(function(j){p.push(j.description)})}),p.join(",")}},{title:"\u64CD\u4F5C",dataIndex:"id",align:"left",copyable:!1,valueType:"text",hideInSearch:!0,render:function(O,u){return t.createElement(W.Z,{buttons:[{name:"\u7F16\u8F91",key:"edit",onClick:function(){return x(u)}},{name:"\u6388\u6743",key:"authorize",onClick:function(){return $(u)}}]})}}];return t.createElement(t.Fragment,null,t.createElement(Z.ZP,{style:{padding:"18px 22px"},actionRef:A,request:U,onRequestError:function(O){console.error(O.message),g.default.error("\u6570\u636E\u52A0\u8F7D\u5931\u8D25,".concat(O.message))},columns:K,bordered:!0,rowKey:"id",pagination:{size:"default"},dateFormatter:"string",headerTitle:"\u83DC\u5355\u6743\u9650\u5217\u8868",tableAlertRender:!1,toolBarRender:function(){return[t.createElement(b.Z,{onClick:X,key:"add",type:"primary"},t.createElement(G.Z,null),"\u65B0\u5EFA")]}}),t.createElement(Pe,{visible:f.visible,formData:f.formData,loading:f.loading,toggleVisible:function(){return F("edit")},reload:c}),t.createElement(Be,{visible:B.visible,formData:B.formData,toggleVisible:function(){return F("auth")},reload:c}))}}}]);
