(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[887],{84664:function(V){V.exports={formWrap:"formWrap___276Lb",rowWrap:"rowWrap___1Q2qE",listWrap:"listWrap___2GzdK",userName:"userName___3K3PK"}},55632:function(V){V.exports={treeWrap:"treeWrap___LOi_-",cover:"cover___3a6dl"}},31567:function(V,O,e){"use strict";var x=e(19597),Z=e(2291),$=e(37482),h=e(3810),Q=e(44742),u=e(67294),t=e(48786);O.Z=function(C){var T=C.buttons,l=C.maxNumber,n=l===void 0?2:l,a=C.className,F=C.style,S=T.filter(function(r){return!r.hidden}),ge=S.length,fe=function(b){var M=b,D=[];return b.length>n&&(M=b.slice(0,n-1),D=b.slice(n-1)),[M,D]},ae=(0,u.useMemo)(function(){return fe(S)},[S]),H=(0,Q.Z)(ae,2),X=H[0],he=H[1];return u.createElement("div",{className:a,style:F},X.map(function(r,b){var M=r.name,D=r.key,pe=r.onClick,Ee=r.path,Ce=u.createElement("a",{style:{marginRight:18},key:D,onClick:Ee?function(){return t.m8.push(Ee)}:pe},M);return b!==ge-1?u.createElement(u.Fragment,{key:D},Ce):Ce}),he.length>0&&u.createElement(Z.Z,{overlay:u.createElement(h.Z,null,he.map(function(r){return u.createElement(h.Z.Item,{onClick:r.path?function(){return t.m8.push(r.path)}:function(){var b;return(b=r.onClick)===null||b===void 0?void 0:b.call(r)}},r.name)}))},u.createElement("a",null,"\u66F4\u591A")))}},24342:function(V,O,e){"use strict";var x=e(13378),Z=e(56361),$=e(3911),h=e(67294),Q=e(87542);O.Z=function(u){var t=u.value,C=t===void 0?[]:t,T=u.onChange,l=(0,$.Z)(u,["value","onChange"]),n={selectedRowKeys:C,onChange:function(F){T==null||T(F)}};return h.createElement(Q.ZP,(0,x.Z)({rowSelection:(0,Z.Z)((0,Z.Z)({},n),{},{checkStrictly:!0})},l))}},31261:function(V,O,e){"use strict";e.d(O,{Z:function(){return $}});var x=e(67294),Z=e(48786);function $(h){var Q=(0,Z.tT)("@@initialState"),u=Q.initialState,t=u||{},C=t.privileges,T=C===void 0?[]:C,l=(0,x.useMemo)(function(){return T.some(function(n){return n.resourceKey===h})},[T,h]);return{showCompanySelect:l}}},84850:function(V,O,e){"use strict";e.d(O,{Z:function(){return $}});var x=e(44742),Z=e(67294);function $(){var h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,Q=(0,Z.useState)(!1),u=(0,x.Z)(Q,2),t=u[0],C=u[1],T=(0,Z.useState)(""),l=(0,x.Z)(T,2),n=l[0],a=l[1];return(0,Z.useEffect)(function(){C(h)},[]),{spinning:t,setSpinning:C,tip:n,setTip:a}}},76887:function(V,O,e){"use strict";e.r(O),e.d(O,{default:function(){return we}});var x=e(13753),Z=e(48429),$=e(14643),h=e(92909),Q=e(97140),u=e(93228),t=e(67294),C=e(87542),T=e(49101),l=e(31567),n=e(26780),a=e(46567),F=e(58210),S=e(87240),ge=e(37092),fe=e(91911),ae=e(13378),H=e(68137),X=e(50532),he=e(3911),r=e(56361),b=e(67604),M=e(66498),D=e(44742),pe=e(46368),Ee=e(46391),Ce=e(47376),de=e(66827),De=e(84850),ve=e(48786),ce=e(66594),xe=e(55632),Te=e.n(xe),Re=e(50189),Oe=function(i){var d=[];return i?(Object.keys(i).forEach(function(c){d.push.apply(d,(0,Re.Z)(i[c].map(function(f){return f.id})))}),d):[]},Pe=e(27870),Fe=e(24342),_e={labelCol:{span:3},wrapperCol:{span:20}},We={labelCol:{span:3},wrapperCol:{span:10}},Be=function(i){var d=i.visible,c=i.toggleVisible,f=i.formData,k=i.loading,m=i.reload,re=M.Z.useForm(),_=(0,D.Z)(re,1),p=_[0],W=(0,De.Z)(),B=W.tip,G=W.setTip,w=f.id,v=(0,ve.tT)("@@initialState"),J=v.initialState,q=J||{},oe=q.userInfo,Y=(0,ve.tT)("resourceData"),P=Y.resourceList,A=Y.resourceTreeData,I=oe||{},U=I.orgCode,ee=(0,t.useState)(!1),E=(0,D.Z)(ee,2),s=E[0],o=E[1];(0,t.useEffect)(function(){if(!(0,pe.Z)(f)){var L=f||{},z=L.resourceMap,me=z===void 0?{}:z,ue=Oe(me);p.setFieldsValue((0,r.Z)((0,r.Z)({},f),{},{resourceIds:ue,modalResourceIds:ue}))}return function(){p.resetFields()}},[f]);var g=function(){c(),p.resetFields()},K=function(z){var me=z.resourceIds,ue=me===void 0?[]:me,Le=z.modalResourceIds,ye=(0,he.Z)(z,["resourceIds","modalResourceIds"]);G("\u6570\u636E\u4FDD\u5B58\u4E2D\uFF0C\u8BF7\u7A0D\u5019...");var Se=(0,Pe.HO)((0,r.Z)((0,r.Z)({},ye),{},{clientKey:ce.OW.clientId,id:w,businessValue:U,resourceIds:ue.filter(function(Me){return(0,Ee.Z)(Me)})}));return API.authorization.resourceRole.resourceSave.fetch(Se)},N=(0,de.QT)(K,{manual:!0,onSuccess:function(){h.default.success("\u4FDD\u5B58\u6210\u529F"),p.resetFields(),c(),m==null||m()}}),le=N.run,se=N.loading,j=[{title:"\u8D44\u6E90\u540D\u79F0",dataIndex:"description",align:"left",copyable:!1,valueType:"text"},{title:"\u8D44\u6E90\u6807\u8BC6",dataIndex:"resourceKey",align:"left",copyable:!1,valueType:"text"},{title:"\u8D44\u6E90\u7C7B\u578B",dataIndex:"type",align:"left",copyable:!1,valueType:"text",render:function(z){return z===ce.o4.\u8DEF\u7531\u7EA7\u8D44\u6E90?"\u8DEF\u7531\u7EA7\u8D44\u6E90":"\u9875\u9762\u7EA7\u8D44\u6E90"}}];return t.createElement(M.Z,(0,ae.Z)({form:p,onFinish:le},We),t.createElement(a.Z,{centered:!0,visible:d,forceRender:!0,maskClosable:!1,title:"".concat((0,Ce.Z)(w)?"\u65B0\u5EFA":"\u7F16\u8F91","\u89D2\u8272"),okButtonProps:{htmlType:"submit"},width:800,onOk:function(){return p.submit()},onCancel:g,confirmLoading:se},t.createElement(S.Z,{spinning:k&&se,tip:B},t.createElement(M.Z.Item,{label:"\u89D2\u8272\u540D\u79F0",name:"role",rules:[{whitespace:!0},{required:!0}]},t.createElement(X.Z,{placeholder:"\u8BF7\u8F93\u5165"})),t.createElement(M.Z.Item,(0,ae.Z)({label:"\u89D2\u8272\u63CF\u8FF0",name:"comment"},_e,{rules:[{whitespace:!0}]}),t.createElement(X.Z,{placeholder:"\u8BF7\u8F93\u5165"})),t.createElement("div",{className:Te().treeWrap},t.createElement("div",{className:Te().cover,onClick:function(){return o(!0)}}),t.createElement(M.Z.Item,{label:"\u62E5\u6709\u8D44\u6E90",name:"resourceIds",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u62E5\u6709\u8D44\u6E90"}]},t.createElement(fe.Z,{treeData:A,allowClear:!0,multiple:!0,placeholder:"\u8BF7\u9009\u62E9"}))))),t.createElement(a.Z,{centered:!0,visible:s,forceRender:!0,maskClosable:!1,title:"\u62E5\u6709\u8D44\u6E90",width:800,onOk:function(){p.setFieldsValue({resourceIds:p.getFieldValue("modalResourceIds")}),o(!1)},onCancel:function(){p.setFieldsValue({modalResourceIds:p.getFieldValue("resourceIds")}),o(!1)},confirmLoading:se},t.createElement(M.Z.Item,{label:"\u62E5\u6709\u8D44\u6E90",name:"modalResourceIds",noStyle:!0},t.createElement(Fe.Z,{search:!1,rowKey:"id",columns:j,dataSource:P}))))},Ue=Be,et=e(66518),Ae=e(95322),tt=e(44862),Ke=e(42091),Ne=e(3855),je=e(84664),Ie=e.n(je),Ze=e(89193),ze={page:1,pageSize:6},Ve={labelCol:{span:6},wrapperCol:{span:16}},$e=function(y){var i=y.visible,d=y.toggleVisible,c=y.formData,f=y.reload,k=y.orgCode,m=(0,ve.tT)("@@initialState"),re=m.initialState,_=re||{},p=_.userInfo,W=p||{},B=W.orgCode,G=M.Z.useForm(),w=(0,D.Z)(G,1),v=w[0],J=(0,De.Z)(),q=J.tip,oe=J.setTip,Y=c.id,P=(0,t.useState)([]),A=(0,D.Z)(P,2),I=A[0],U=A[1],ee=(0,Ze.x)(ze),E=(0,D.Z)(ee,2),s=E[0],o=E[1],g=(0,de.QT)(API.platform.sysUser.pageList.fetch,{manual:!0}),K=g.data,N=g.run,le=g.loading,se=(0,de.QT)(API.authorization.resourceRole.resourceRoleDetailUser.fetch,{manual:!0,onSuccess:function(R){var te=R.userIdList,ne=te===void 0?[]:te;U(ne)}}),j=se.run,L=se.loading;(0,t.useEffect)(function(){i&&(N((0,r.Z)((0,r.Z)({},s),{},{orgCode:k||B})),j({clientKey:ce.OW.clientId,roleId:Y}))},[k,B,i,s]),(0,t.useEffect)(function(){return(0,pe.Z)(c)||v.setFieldsValue((0,r.Z)({},c)),function(){v.resetFields()}},[c]);var z=function(){d(),v.resetFields()},me=function(){return oe("\u6570\u636E\u4FDD\u5B58\u4E2D\uFF0C\u8BF7\u7A0D\u5019..."),API.authorization.resourceRole.resourceSaveAddUser.fetch({clientKey:ce.OW.clientId,id:Y,userIds:I.map(function(R){return+R}),resourceIds:c.resourceIds,role:c.role})},ue=(0,de.QT)(me,{manual:!0,onSuccess:function(){h.default.success("\u6388\u6743\u6210\u529F"),v.resetFields(),d(),f==null||f()}}),Le=ue.run,ye=ue.loading,Se=function(R,te){var ne=(0,Re.Z)(I);R.target.checked?ne.push(+te.userId):ne=ne.filter(function(qe){return qe!==te.userId}),U(ne)},Me=function(R){return t.createElement(Ae.ZP.Item,null,t.createElement(Ke.Z,{checked:I.includes(+R.userId),onChange:function(ne){return Se(ne,R)}},t.createElement("div",{className:Ie().userName},R.userName,R.phone?"(".concat(R.phone.slice(-4),")"):"")))};return t.createElement(a.Z,{centered:!0,visible:i,forceRender:!0,maskClosable:!1,title:"\u7528\u6237\u6388\u6743",okButtonProps:{htmlType:"submit"},width:442,onOk:function(){return v.submit()},onCancel:z,confirmLoading:ye,wrapClassName:"auth-modal"},t.createElement(S.Z,{spinning:le&&ye&&L,tip:q},t.createElement(M.Z,(0,ae.Z)({form:v,onFinish:Le},Ve,{className:Ie().formWrap}),t.createElement(M.Z.Item,{label:"\u4F01\u4E1A\u7F16\u7801",name:"account",tooltip:{icon:t.createElement(Ne.Z,null),title:"\u4F01\u4E1A\u7F16\u7801\u5C06\u4F5C\u4E3A\u4F01\u4E1A\u4E0B\u6240\u6709\u8D26\u53F7\u540E\u7F00"},noStyle:!0},t.createElement(Ae.ZP,{loading:le,className:Ie().listWrap,size:"small",dataSource:K==null?void 0:K.list,pagination:(0,r.Z)((0,r.Z)({},s),{},{current:s.page,onChange:function(R){o(function(te){te.page=R})},showQuickJumper:!0}),renderItem:Me})))))},Qe=e(68699),He=e(94043),be=e.n(He),Ge=function(){var y=(0,t.useRef)(),i=(0,t.useState)(),d=(0,D.Z)(i,2),c=d[0],f=d[1],k=(0,Ze.x)({visible:!1,formData:{},loading:!1}),m=(0,D.Z)(k,2),re=m[0],_=m[1],p=(0,Ze.x)({visible:!1,formData:{}}),W=(0,D.Z)(p,2),B=W[0],G=W[1],w=y.current||{},v=w.reload,J=(0,de.QT)(API.authorization.role.update.fetch,{manual:!0,onSuccess:function(){h.default.success("\u64CD\u4F5C\u6210\u529F"),v==null||v()}}),q=J.run,oe=(0,de.QT)(API.authorization.resourceRole.resourceDelete.fetch,{manual:!0,onSuccess:function(){h.default.success("\u5220\u9664\u6210\u529F"),v==null||v()}}),Y=oe.run,P=function(){var E=(0,Qe.Z)(be().mark(function s(o){var g,K,N,le;return be().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return j.next=2,API.platform.sysRole.pageList.fetch((0,Pe.HO)((0,r.Z)((0,r.Z)({},o),{},{page:(o==null?void 0:o.current)||ce.ii.page,pageSize:(o==null?void 0:o.pageSize)||ce.ii.pageSize})));case 2:return g=j.sent,K=g.list,N=g.page,le=g.total,j.abrupt("return",{data:K||[],page:N,success:!0,total:le});case 7:case"end":return j.stop()}},s)}));return function(o){return E.apply(this,arguments)}}(),A=function(s){_(function(o){o.visible=!0,o.loading=!0,o.formData=s})},I=function(){_(function(s){s.visible=!0,s.formData={}})},U=function(s){var o=s||{},g=o.resourceMap,K=Oe(g);G(function(N){N.visible=!0,N.formData=(0,r.Z)((0,r.Z)({},s),{},{resourceIds:K})})},ee=function(s){var o={edit:_,auth:G};o[s](function(g){g.visible=!1,g.loading=!1,g.formData={}})};return{orgCode:c,setOrgCode:f,actionRef:y,reload:v,editModalConfig:re,setEditModalConfig:_,authModalConfig:B,setAuthModalConfig:G,handleDisable:q,handleDelete:Y,fetchList:P,handleRoleEdit:A,handleRoleAdd:I,handleAuthorize:U,handleModalHide:ee}},Je=e(31261),nt=e(81984),Ye=e(82692),Xe=e(73567),ke=function(y){var i=y.text,d=i===void 0?"":i,c=y.maxLength,f=c===void 0?50:c;return(d==null?void 0:d.length)>f?t.createElement(Ye.Z,{title:d},t.createElement("span",null,Xe.ZP.textEllipsis(d,f))):t.createElement("span",null,d)},we=function(){var y=(0,ve.tT)("company"),i=y.companyMapOptions,d=(0,ve.tT)("resourceData"),c=d.reloadResourceList,f=(0,Je.Z)("auth_authority_menu_company"),k=f.showCompanySelect,m=Ge(),re=m.orgCode,_=m.setOrgCode,p=m.actionRef,W=m.reload,B=m.editModalConfig,G=m.fetchList,w=m.handleRoleAdd,v=m.handleRoleEdit,J=m.handleModalHide,q=m.authModalConfig,oe=m.handleAuthorize,Y=[{title:"\u4F01\u4E1A\u540D\u79F0",dataIndex:"orgCode",align:"left",copyable:!1,valueType:"text",hideInSearch:!k,hideInTable:!0,renderFormItem:function(){return t.createElement(u.Z,{allowClear:!0,options:i,onChange:function(I){_(I),c==null||c({orgCode:I})}})}},{title:"\u89D2\u8272\u540D\u79F0",dataIndex:"role",align:"left",copyable:!1,valueType:"text",hideInSearch:!1},{title:"\u89D2\u8272\u63CF\u8FF0",dataIndex:"comment",align:"left",copyable:!1,valueType:"text",hideInSearch:!0},{title:"\u62E5\u6709\u8D44\u6E90",dataIndex:"resourceList",align:"left",copyable:!1,valueType:"text",hideInSearch:!0,render:function(A,I){var U=I||{},ee=U.resourceMap,E=ee===void 0?[]:ee,s=[];return Object.keys(E).forEach(function(o){E[o].forEach(function(g){s.push(g.description)})}),t.createElement(ke,{text:s.join(",")})}},{title:"\u64CD\u4F5C",dataIndex:"id",align:"left",copyable:!1,valueType:"text",hideInSearch:!0,render:function(A,I){return t.createElement(l.Z,{buttons:[{name:"\u7F16\u8F91",key:"edit",onClick:function(){return v(I)}},{name:"\u6388\u6743",key:"authorize",onClick:function(){return oe(I)}}]})}}];return t.createElement(t.Fragment,null,t.createElement(C.ZP,{style:{padding:"18px 22px"},actionRef:p,request:G,onRequestError:function(A){console.error(A.message),h.default.error("\u6570\u636E\u52A0\u8F7D\u5931\u8D25,".concat(A.message))},columns:Y,bordered:!0,rowKey:"id",pagination:{size:"default"},dateFormatter:"string",headerTitle:"\u83DC\u5355\u6743\u9650\u5217\u8868",tableAlertRender:!1,toolBarRender:function(){return[t.createElement(Z.Z,{onClick:w,key:"add",type:"primary"},t.createElement(T.Z,null),"\u65B0\u5EFA")]}}),t.createElement(Ue,{visible:B.visible,formData:B.formData,loading:B.loading,toggleVisible:function(){return J("edit")},reload:W}),t.createElement($e,{visible:q.visible,formData:q.formData,toggleVisible:function(){return J("auth")},reload:W,orgCode:re}))}},73567:function(V,O,e){"use strict";var x=1,Z=1,$=4;O.ZP={fillZero:function(n){return typeof n=="number"&&n>=10?n:"0".concat(n)},textEllipsis:function(n,a){return n.length>a&&a>0?"".concat(n.substring(0,a),"..."):n},getLastSubstring:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";return n.substring(n.lastIndexOf(a)+a.length,n.length)},valueToString:function(n){return typeof n=="string"?n:JSON.stringify(n)},copyText:function(n){var a=document.createElement("input");document.body.appendChild(a),a.setAttribute("value",n),a.select(),document.execCommand("copy"),document.body.removeChild(a)},imgUrlToBase64:function(n,a,F){var S=document.createElement("canvas"),ge=S.getContext("2d");return new Promise(function(fe,ae){var H=new Image;H.crossOrigin="Anonymous",H.onload=function(){S.width=a,S.height=F,ge.drawImage(H,0,0,a,F);var X=S.toDataURL("image/");S=null,fe(X)},H.onerror=function(X){ae(X)},H.src=n})}};var h=function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:2;return n||n===0?(n/100).toFixed(a):""},Q=function(n){return n*100},u=function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return n?"".concat(n.slice(0,a),"****").concat(n.slice(-a)):""},t=function(n){var a=/(?<=.)./g;return n==null?void 0:n.replace(a,"*")},C=function(n){var a,F=(a=n==null?void 0:n.split("-"))!==null&&a!==void 0?a:[];return F.filter(function(S){return!!S}).length===2?n:F.join("")},T=function(n,a){return n===x&&(a===Z||a===$)}}}]);
