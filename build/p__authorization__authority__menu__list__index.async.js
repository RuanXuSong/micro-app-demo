"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[505],{62571:function(e,n,t){var r=t(5574),i=t.n(r),o=t(67294),a=t(13013),s=t(66516),l=t(84354),u=t(85893);n.Z=function(e){var n=e.buttons,t=e.maxNumber,r=void 0===t?2:t,c=e.className,d=e.style,f=n.filter((function(e){return!e.hidden})),h=f.length,p=(0,o.useMemo)((function(){return function(e){var n=e,t=[];return e.length>r&&(n=e.slice(0,r-1),t=e.slice(r-1)),[n,t]}(f)}),[f]),m=i()(p,2),g=m[0],v=m[1];return(0,u.jsxs)("div",{className:c,style:d,children:[g.map((function(e,n){var t=e.name,r=e.key,i=e.onClick,a=e.path,s=(0,u.jsx)("a",{style:{marginRight:18},onClick:a?function(){return l.history.push(a)}:i,children:t},r);return n!==h-1?(0,u.jsx)(o.Fragment,{children:s},r):s})),v.length>0&&(0,u.jsx)(a.Z,{overlay:(0,u.jsx)(s.Z,{children:v.map((function(e){return(0,u.jsx)(s.Z.Item,{onClick:e.path?function(){return l.history.push(e.path)}:function(){var n;return null===(n=e.onClick)||void 0===n?void 0:n.call(e)},children:e.name})}))}),children:(0,u.jsx)("a",{children:"更多"})})]})}},77123:function(e,n,t){t.d(n,{Z:function(){return x}});var r=t(97857),i=t.n(r),o=t(19632),a=t.n(o),s=t(5574),l=t.n(s),u=t(13769),c=t.n(u),d=t(67294),f=t(9308),h=t(27601),p=t(96486),m=t(14955),g="disabled___mlAxB",v=t(85893),b=["value","onChange","disabled","rowKey","dataSource"],x=function(e){var n=e.value,t=void 0===n?[]:n,r=e.onChange,o=e.disabled,s=e.rowKey,u=e.dataSource,x=c()(e,b),y=(0,d.useRef)([]),I=(0,d.useRef)([]),C=(0,d.useState)(!0),Z=l()(C,2),S=Z[0],j=Z[1],R={selectedRowKeys:t,onChange:function(e,n){var t;if(!o){var i=a()(e),l=function(e,n){for(var t={add:[],del:[]},r={},i=0;i<e.length;i++)r[e[i]]=e[i];for(var o=0;o<n.length;o++)(0,h.Z)(r[n[o]])?t.add.push(n[o]):delete r[n[o]];for(var a in r)t.del.push(r[a]);return t}(y.current,e),c=l.add,d=void 0===c?[]:c,f=l.del,g=void 0===f?[]:f,v=n.filter((function(e){return d.includes(e[s])})),b=I.current.filter((function(e){return g.includes(e[s])}));!function e(n){for(var t=0;t<n.length;t++){var r=(n[t]||{}).children;i.push(n[t][s]),(0,p.isEmpty)(r)||e(r)}}(v);!function e(n){for(var t=function(t){var r=(n[t]||{}).children;i=i.filter((function(e){return e!==n[t][s]})),(0,p.isEmpty)(r)||e(r)},r=0;r<n.length;r++)t(r)}(b);var x=a()(new Set(i));null==r||r(x),y.current=a()(x);var C=a()(u||[]);I.current=null!==(t=(0,m.oO)(C).filter((function(e){return x.includes(e[s])})))&&void 0!==t?t:[]}}};return(0,d.useEffect)((function(){if(S&&!(0,p.isEmpty)(t)){var e,n;y.current=t;var r=a()(u||[]);I.current=null!==(e=null===(n=(0,m.oO)(r))||void 0===n?void 0:n.filter((function(e){return t.includes(e[s])})))&&void 0!==e?e:[],j(!1)}}),[t]),(0,v.jsx)(f.ZP,i()({className:o?g:{},rowSelection:i()(i()({},R),{},{checkStrictly:!0,selections:!1}),rowKey:s,dataSource:u},x))}},73011:function(e,n,t){t.d(n,{Z:function(){return o}});var r=t(67294),i=t(84354);function o(e){var n=((0,i.useModel)("@@initialState").initialState||{}).privileges,t=void 0===n?[]:n;return{showCompanySelect:(0,r.useMemo)((function(){return t.some((function(n){return n.resourceKey===e}))}),[t,e])}}},59360:function(e,n,t){t.d(n,{Z:function(){return a}});var r=t(5574),i=t.n(r),o=t(67294);function a(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=(0,o.useState)(!1),t=i()(n,2),r=t[0],a=t[1],s=(0,o.useState)(""),l=i()(s,2),u=l[0],c=l[1];return(0,o.useEffect)((function(){a(e)}),[]),{spinning:r,setSpinning:a,tip:u,setTip:c}}},42077:function(e,n,t){t.r(n),t.d(n,{default:function(){return ae}});var r=t(34041),i=t(12461),o=t(71577),a=t(9308),s=t(24969),l=t(62571),u=t(13769),c=t.n(u),d=t(97857),f=t.n(d),h=t(5574),p=t.n(h),m=t(67294),g=t(66490),v=t(74348),b=t(11382),x=t(11486),y=t(82507),I=t(79697),C=t(290),Z=t(27601),S=t(86317),j=t(59360),R=t(84354),k=t(43758),w="treeWrap___LkF5B",T="cover___S6EgI",A=t(19632),_=t.n(A),D=function(e){var n=[];return e?(Object.keys(e).forEach((function(t){n.push.apply(n,_()(e[t].map((function(e){return e.id}))))})),n):[]},L=t(41712),P=t(77123),E=t(85893),F=["resourceIds","modalResourceIds"],M={labelCol:{span:3},wrapperCol:{span:20}},O={labelCol:{span:3},wrapperCol:{span:10}},z=function(e){var n=e.visible,t=e.toggleVisible,r=e.formData,o=e.loading,a=e.reload,s=e.resourceList,l=e.resourceTreeData,u=e.orgCode,d=e.disabledAction,h=g.Z.useForm(),A=p()(h,1)[0],_=(0,j.Z)(),z=_.tip,N=_.setTip,K=r.id,V=(((0,R.useModel)("@@initialState").initialState||{}).userInfo||{}).orgCode,Q=(0,m.useState)(!1),U=p()(Q,2),B=U[0],W=U[1];(0,m.useEffect)((function(){if(!(0,I.Z)(r)){var e=(r||{}).resourceMap,n=void 0===e?{}:e,t=D(n);(0,I.Z)(n["敏捷应用"])||t.push(k.ku),A.setFieldsValue(f()(f()({},r),{},{resourceIds:t,modalResourceIds:t}))}return function(){A.resetFields()}}),[r]);var H=(0,S.QT)((function(e){var n=e.resourceIds,t=void 0===n?[]:n,r=(e.modalResourceIds,c()(e,F));N("数据保存中，请稍候...");var i=(0,L.HO)(f()(f()({},r),{},{clientKey:k.OW.clientId,id:K,businessValue:null!=u?u:V,resourceIds:t.filter((function(e){return(0,C.Z)(e)}))}));return API.authorization.resourceRole.resourceSave.fetch(i)}),{manual:!0,onSuccess:function(){i.ZP.success("保存成功"),A.resetFields(),t(),null==a||a()}}),q=H.run,J=H.loading;return(0,E.jsxs)(g.Z,f()(f()({form:A,onFinish:q},O),{},{children:[(0,E.jsx)(v.Z,{centered:!0,visible:n,forceRender:!0,maskClosable:!1,title:"".concat((0,Z.Z)(K)?"新建":"编辑","角色"),okButtonProps:{htmlType:"submit",disabled:d},width:800,onOk:function(){return A.submit()},onCancel:function(){t(),A.resetFields()},confirmLoading:J,children:(0,E.jsxs)(b.Z,{spinning:o&&J,tip:z,children:[(0,E.jsx)(g.Z.Item,{label:"角色名称",name:"role",rules:[{whitespace:!0},{required:!0}],children:(0,E.jsx)(x.Z,{placeholder:"请输入"})}),(0,E.jsx)(g.Z.Item,f()(f()({label:"角色描述",name:"comment"},M),{},{rules:[{whitespace:!0}],children:(0,E.jsx)(x.Z,{placeholder:"请输入"})})),(0,E.jsxs)("div",{className:w,children:[(0,E.jsx)("div",{className:T,onClick:function(){return W(!0)}}),(0,E.jsx)(g.Z.Item,{label:"拥有资源",name:"resourceIds",rules:[{required:!0,message:"请选择拥有资源"}],children:(0,E.jsx)(y.Z,{treeData:l,allowClear:!0,multiple:!0,placeholder:"请选择"})})]})]})}),(0,E.jsx)(v.Z,{centered:!0,visible:B,forceRender:!0,maskClosable:!1,title:"拥有资源",width:800,onOk:function(){A.setFieldsValue({resourceIds:A.getFieldValue("modalResourceIds")}),W(!1)},onCancel:function(){A.setFieldsValue({modalResourceIds:A.getFieldValue("resourceIds")}),W(!1)},confirmLoading:J,children:(0,E.jsx)(g.Z.Item,{label:"拥有资源",name:"modalResourceIds",noStyle:!0,children:(0,E.jsx)(P.Z,{disabled:d,search:!1,rowKey:"id",columns:[{title:"资源名称",dataIndex:"description",align:"left",copyable:!1,valueType:"text"}],dataSource:s})})})]}))},N=t(95507),K=t(32808),V="formWrap___Fwld8",Q="listWrap___JUJAs",U="userName___KHheP",B=t(60106),W={page:1,pageSize:6},H={labelCol:{span:6},wrapperCol:{span:16}},q=function(e){var n=e.visible,t=e.toggleVisible,r=e.formData,o=e.reload,a=e.orgCode,s=e.disabledAction,l=(((0,R.useModel)("@@initialState").initialState||{}).userInfo||{}).orgCode,u=g.Z.useForm(),c=p()(u,1)[0],d=(0,j.Z)(),h=d.tip,x=d.setTip,y=r.id,C=(0,m.useState)([]),Z=p()(C,2),w=Z[0],T=Z[1],A=(0,B.x)(W),D=p()(A,2),L=D[0],P=D[1],F=(0,S.QT)(API.platform.sysUser.pageList.fetch,{manual:!0}),M=F.data,O=F.run,z=F.loading,q=(0,S.QT)(API.authorization.resourceRole.resourceRoleDetailUser.fetch,{manual:!0,onSuccess:function(e){var n=e.userIdList;T(void 0===n?[]:n)}}),J=q.run,G=q.loading;(0,m.useEffect)((function(){n&&(O(f()(f()({},L),{},{orgCode:a||l})),J({clientKey:k.OW.clientId,roleId:y}))}),[a,l,n,L]),(0,m.useEffect)((function(){return(0,I.Z)(r)||c.setFieldsValue(f()({},r)),function(){c.resetFields()}}),[r]);var X=(0,S.QT)((function(){return x("数据保存中，请稍候..."),API.authorization.resourceRole.resourceSaveAddUser.fetch({clientKey:k.OW.clientId,id:y,userIds:w.map((function(e){return+e})),resourceIds:r.resourceIds,role:r.role})}),{manual:!0,onSuccess:function(){i.ZP.success("授权成功"),c.resetFields(),t(),null==o||o()}}),Y=X.run,$=X.loading;return(0,E.jsx)(v.Z,{centered:!0,visible:n,forceRender:!0,maskClosable:!1,title:"用户授权",okButtonProps:{htmlType:"submit",disabled:s},width:442,onOk:function(){return c.submit()},onCancel:function(){t(),c.resetFields()},confirmLoading:$,wrapClassName:"auth-modal",children:(0,E.jsx)(b.Z,{spinning:z&&$&&G,tip:h,children:(0,E.jsx)(g.Z,f()(f()({form:c,onFinish:Y},H),{},{className:V,children:(0,E.jsx)(g.Z.Item,{label:"用户授权",noStyle:!0,children:(0,E.jsx)(N.ZP,{loading:z,className:Q,size:"small",dataSource:null==M?void 0:M.list,pagination:f()(f()({},L),{},{current:L.page,onChange:function(e){P((function(n){n.page=e}))},showQuickJumper:!0}),renderItem:function(e){return(0,E.jsx)(N.ZP.Item,{children:(0,E.jsx)(K.Z,{checked:w.includes(+e.userId),onChange:function(n){return function(e,n){var t=_()(w);e.target.checked?t.push(+n.userId):t=t.filter((function(e){return e!==n.userId})),T(t)}(n,e)},children:(0,E.jsxs)("div",{className:U,children:[e.name,e.phone?"(".concat(e.phone.slice(-4),")"):""]})})})}})})}))})})},J=t(15009),G=t.n(J),X=t(99289),Y=t.n(X),$=t(89891),ee=t(62865);var ne=function(){var e=((0,R.useModel)("@@initialState").initialState||{}).userInfo,n=(e||{}).orgCode,t=(0,m.useRef)(),r=(0,m.useState)(),o=p()(r,2),a=o[0],s=o[1],l=a!==n,u=(0,B.x)({visible:!1,formData:{},loading:!1}),c=p()(u,2),d=c[0],h=c[1],g=(0,B.x)({visible:!1,formData:{}}),v=p()(g,2),b=v[0],x=v[1],y=function(){var e=(0,S.QT)(API.platform.sysUser.myResourceList.fetch),n=e.data,t=e.run;return{resourceList:(0,ee.r)(n),resourceTreeData:(0,$.Z)(n),fetchResourceList:t}}(),I=y.fetchResourceList,C=y.resourceList,Z=y.resourceTreeData,j=(t.current||{}).reload,w=(0,S.QT)(API.authorization.role.update.fetch,{manual:!0,onSuccess:function(){i.ZP.success("操作成功"),null==j||j()}}).run,T=(0,S.QT)(API.authorization.resourceRole.resourceDelete.fetch,{manual:!0,onSuccess:function(){i.ZP.success("删除成功"),null==j||j()}}).run;(0,m.useEffect)((function(){null!=e&&e.orgCode&&s(null==e?void 0:e.orgCode)}),[e]),(0,m.useEffect)((function(){null==j||j()}),[a]);var A=function(){var e=Y()(G()().mark((function e(n){var t,r,i,o;return G()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,API.platform.sysRole.pageList.fetch((0,L.HO)(f()(f()({},n),{},{orgCode:a,page:(null==n?void 0:n.current)||k.ii.page,pageSize:(null==n?void 0:n.pageSize)||k.ii.pageSize})));case 2:return t=e.sent,r=t.list,i=t.page,o=t.total,e.abrupt("return",{data:r||[],page:i,success:!0,total:o});case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return{orgCode:a,disabledAction:l,setOrgCode:s,actionRef:t,reload:j,editModalConfig:d,resourceList:C,fetchResourceList:I,resourceTreeData:Z,setEditModalConfig:h,authModalConfig:b,setAuthModalConfig:x,handleDisable:w,handleDelete:T,fetchList:A,handleRoleEdit:function(e){h((function(n){n.visible=!0,n.loading=!0,n.formData=e}))},handleRoleAdd:function(){h((function(e){e.visible=!0,e.formData={}}))},handleAuthorize:function(e){var n=(e||{}).resourceMap,t=D(n);x((function(n){n.visible=!0,n.formData=f()(f()({},e),{},{resourceIds:t})}))},handleModalHide:function(e){({edit:h,auth:x})[e]((function(e){e.visible=!1,e.loading=!1,e.formData={}}))}}},te=t(73011),re=t(84908),ie=t(7369),oe=function(e){var n=e.text,t=void 0===n?"":n,r=e.maxLength,i=void 0===r?50:r;return(null==t?void 0:t.length)>i?(0,E.jsx)(re.Z,{title:t,children:(0,E.jsx)("span",{children:ie.ZP.textEllipsis(t,i)})}):(0,E.jsx)("span",{children:t})},ae=function(){var e=(0,R.useModel)("company").companyMapOptions,n=(0,te.Z)("cloud_authority_menu_company").showCompanySelect,t=ne(),u=t.orgCode,c=t.setOrgCode,d=t.disabledAction,f=t.actionRef,h=t.reload,p=t.editModalConfig,m=t.fetchList,g=t.handleRoleAdd,v=t.handleRoleEdit,b=t.handleModalHide,x=t.authModalConfig,y=t.resourceList,I=t.resourceTreeData,C=t.fetchResourceList,Z=t.handleAuthorize,S=[{title:"企业名称",dataIndex:"orgCode",align:"left",copyable:!1,valueType:"text",hideInSearch:!n,hideInTable:!0,renderFormItem:function(){return(0,E.jsx)(r.Z,{value:u,allowClear:!0,options:e,onChange:function(e){c(e),null==C||C({orgCode:e})}})}},{title:"角色名称",dataIndex:"role",align:"left",copyable:!1,valueType:"text",hideInSearch:!1},{title:"角色描述",dataIndex:"comment",align:"left",copyable:!1,valueType:"text",hideInSearch:!0},{title:"拥有资源",dataIndex:"resourceList",align:"left",copyable:!1,valueType:"text",hideInSearch:!0,render:function(e,n){var t=(n||{}).resourceMap,r=void 0===t?[]:t,i=[];return Object.keys(r).forEach((function(e){r[e].forEach((function(e){i.push(e.description)}))})),(0,E.jsx)(oe,{text:i.join(",")})}},{title:"操作",dataIndex:"id",align:"left",copyable:!1,valueType:"text",hideInSearch:!0,render:function(e,n){return(0,E.jsx)(l.Z,{buttons:[{name:"编辑",key:"edit",onClick:function(){return v(n)}},{name:"授权",key:"authorize",onClick:function(){return Z(n)}}]})}}];return(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(a.ZP,{style:{padding:"18px 22px"},actionRef:f,request:m,onRequestError:function(e){console.error(e.message),i.ZP.error("数据加载失败,".concat(e.message))},onReset:function(){return c("")},columns:S,bordered:!0,rowKey:"id",pagination:{size:"default"},dateFormatter:"string",headerTitle:"菜单权限列表",tableAlertRender:!1,toolBarRender:function(){return[(0,E.jsxs)(o.Z,{onClick:g,type:"primary",children:[(0,E.jsx)(s.Z,{}),"新建"]},"add")]}}),(0,E.jsx)(z,{visible:p.visible,formData:p.formData,loading:p.loading,toggleVisible:function(){return b("edit")},reload:h,resourceList:y,resourceTreeData:I,orgCode:u,disabledAction:d}),(0,E.jsx)(q,{visible:x.visible,formData:x.formData,toggleVisible:function(){return b("auth")},reload:h,orgCode:u,disabledAction:d})]})}},7369:function(e,n,t){n.ZP={fillZero:function(e){return"number"==typeof e&&e>=10?e:"0".concat(e)},textEllipsis:function(e,n){return e.length>n&&n>0?"".concat(e.substring(0,n),"..."):e},getLastSubstring:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e.substring(e.lastIndexOf(n)+n.length,e.length)},valueToString:function(e){return"string"==typeof e?e:JSON.stringify(e)},copyText:function(e){var n=document.createElement("input");document.body.appendChild(n),n.setAttribute("value",e),n.select(),document.execCommand("copy"),document.body.removeChild(n)},imgUrlToBase64:function(e,n,t){var r=document.createElement("canvas"),i=r.getContext("2d");return new Promise((function(o,a){var s=new Image;s.crossOrigin="Anonymous",s.onload=function(){r.width=n,r.height=t,i.drawImage(s,0,0,n,t);var e=r.toDataURL("image/");r=null,o(e)},s.onerror=function(e){a(e)},s.src=e}))}}}}]);