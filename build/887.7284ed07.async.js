(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[887],{84664:function(N){N.exports={formWrap:"formWrap___276Lb",rowWrap:"rowWrap___1Q2qE",listWrap:"listWrap___2GzdK",userName:"userName___3K3PK"}},55632:function(N){N.exports={treeWrap:"treeWrap___LOi_-",cover:"cover___3a6dl"}},31567:function(N,O,e){"use strict";var $=e(19597),S=e(2291),z=e(37482),m=e(3810),X=e(44742),s=e(67294),t=e(48786);O.Z=function(C){var D=C.buttons,l=C.maxNumber,n=l===void 0?2:l,a=C.className,V=C.style,h=D.filter(function(r){return!r.hidden}),ie=h.length,_=function(I){var g=I,y=[];return I.length>n&&(g=I.slice(0,n-1),y=I.slice(n-1)),[g,y]},j=(0,s.useMemo)(function(){return _(h)},[h]),L=(0,X.Z)(j,2),K=L[0],oe=L[1];return s.createElement("div",{className:a,style:V},K.map(function(r,I){var g=r.name,y=r.key,Q=r.onClick,de=r.path,x=s.createElement("a",{style:{marginRight:18},key:y,onClick:de?function(){return t.m8.push(de)}:Q},g);return I!==ie-1?s.createElement(s.Fragment,{key:y},x):x}),oe.length>0&&s.createElement(S.Z,{overlay:s.createElement(m.Z,null,oe.map(function(r){return s.createElement(m.Z.Item,{onClick:r.path?function(){return t.m8.push(r.path)}:function(){var I;return(I=r.onClick)===null||I===void 0?void 0:I.call(r)}},r.name)}))},s.createElement("a",null,"\u66F4\u591A")))}},57044:function(N,O,e){"use strict";var $=e(87753),S=e(98570),z=e(67294),m=e(96486),X=e.n(m);O.Z=function(s){var t=s.value,C=t===void 0?[]:t,D=s.onChange,l=s.treeData,n=l===void 0?[]:l,a=function(h,ie){var _=ie||{},j=_.node,L=_.checked,K=j||{},oe=K.children,r=oe===void 0?[]:oe,I=h.checked,g=function y(Q){if(!(!Q||(0,m.isEmpty)(Q))){var de=Q.map(function(x){return x.key});L||(I=I.filter(function(x){return!de.includes(x)})),Q.forEach(function(x){(0,m.isEmpty)(x.children)||y(x.children)})}};g(r),D==null||D(I)};return z.createElement(S.Z,{checkable:!0,defaultExpandAll:!0,onCheck:a,checkedKeys:C,treeData:n,checkStrictly:!0})}},31261:function(N,O,e){"use strict";e.d(O,{Z:function(){return z}});var $=e(67294),S=e(48786);function z(m){var X=(0,S.tT)("@@initialState"),s=X.initialState,t=s||{},C=t.privileges,D=C===void 0?[]:C,l=(0,$.useMemo)(function(){return D.some(function(n){return n.resourceKey===m})},[D,m]);return{showCompanySelect:l}}},84850:function(N,O,e){"use strict";e.d(O,{Z:function(){return z}});var $=e(44742),S=e(67294);function z(){var m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,X=(0,S.useState)(!1),s=(0,$.Z)(X,2),t=s[0],C=s[1],D=(0,S.useState)(""),l=(0,$.Z)(D,2),n=l[0],a=l[1];return(0,S.useEffect)(function(){C(m)},[]),{spinning:t,setSpinning:C,tip:n,setTip:a}}},76887:function(N,O,e){"use strict";e.r(O),e.d(O,{default:function(){return Ye}});var $=e(13753),S=e(48429),z=e(14643),m=e(92909),X=e(97140),s=e(93228),t=e(67294),C=e(21191),D=e(49101),l=e(31567),n=e(26780),a=e(46567),V=e(58210),h=e(87240),ie=e(37092),_=e(91911),j=e(13378),L=e(68137),K=e(50532),oe=e(3911),r=e(56361),I=e(67604),g=e(66498),y=e(44742),Q=e(46368),de=e(46391),x=e(47376),ce=e(66827),Ze=e(84850),Ee=e(48786),he=e(66594),Pe=e(57044),Fe=e(55632),Me=e.n(Fe),Se=e(50189),De=function(i){var d=[];return i?(Object.keys(i).forEach(function(f){d.push.apply(d,(0,Se.Z)(i[f].map(function(o){return o.id})))}),d):[]},Re=e(27870),Le={labelCol:{span:3},wrapperCol:{span:20}},xe={labelCol:{span:3},wrapperCol:{span:10}},be=function(i){var d=i.visible,f=i.toggleVisible,o=i.formData,le=i.loading,b=i.reload,H=g.Z.useForm(),G=(0,y.Z)(H,1),p=G[0],Z=(0,Ze.Z)(),w=Z.tip,q=Z.setTip,R=o.id,ee=(0,Ee.tT)("@@initialState"),P=ee.initialState,W=P||{},F=W.authResourceData,k=W.userInfo,J=k||{},E=J.orgCode,c=(0,t.useState)(!1),u=(0,y.Z)(c,2),v=u[0],T=u[1];(0,t.useEffect)(function(){if(!(0,Q.Z)(o)){var B=o||{},ne=B.resourceMap,fe=ne===void 0?{}:ne,ve=De(fe);p.setFieldsValue((0,r.Z)((0,r.Z)({},o),{},{resourceIds:ve,modalResourceIds:ve}))}return function(){p.resetFields()}},[o]);var Y=function(){f(),p.resetFields()},te=function(ne){var fe=ne.resourceIds,ve=fe===void 0?[]:fe,Oe=ne.modalResourceIds,ge=(0,oe.Z)(ne,["resourceIds","modalResourceIds"]);q("\u6570\u636E\u4FDD\u5B58\u4E2D\uFF0C\u8BF7\u7A0D\u5019...");var ye=(0,Re.HO)((0,r.Z)((0,r.Z)({},ge),{},{clientKey:he.OW.clientId,id:R,businessValue:E,resourceIds:ve.filter(function(pe){return(0,de.Z)(pe)})}));return API.authorization.resourceRole.resourceSave.fetch(ye)},ue=(0,ce.QT)(te,{manual:!0,onSuccess:function(){m.default.success("\u4FDD\u5B58\u6210\u529F"),p.resetFields(),f(),b==null||b()}}),U=ue.run,me=ue.loading;return t.createElement(g.Z,(0,j.Z)({form:p,onFinish:U},xe),t.createElement(a.Z,{centered:!0,visible:d,forceRender:!0,maskClosable:!1,title:"".concat((0,x.Z)(R)?"\u65B0\u5EFA":"\u7F16\u8F91","\u89D2\u8272"),okButtonProps:{htmlType:"submit"},width:800,onOk:function(){return p.submit()},onCancel:Y,confirmLoading:me},t.createElement(h.Z,{spinning:le&&me,tip:w},t.createElement(g.Z.Item,{label:"\u89D2\u8272\u540D\u79F0",name:"role",rules:[{whitespace:!0},{required:!0}]},t.createElement(K.Z,{placeholder:"\u8BF7\u8F93\u5165"})),t.createElement(g.Z.Item,(0,j.Z)({label:"\u89D2\u8272\u63CF\u8FF0",name:"comment"},Le,{rules:[{whitespace:!0}]}),t.createElement(K.Z,{placeholder:"\u8BF7\u8F93\u5165"})),t.createElement("div",{className:Me().treeWrap},t.createElement("div",{className:Me().cover,onClick:function(){return T(!0)}}),t.createElement(g.Z.Item,{label:"\u62E5\u6709\u8D44\u6E90",name:"resourceIds",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u62E5\u6709\u8D44\u6E90"}]},t.createElement(_.Z,{treeData:F,allowClear:!0,multiple:!0,placeholder:"\u8BF7\u9009\u62E9"}))))),t.createElement(a.Z,{centered:!0,visible:v,forceRender:!0,maskClosable:!1,title:"\u62E5\u6709\u8D44\u6E90",width:412,onOk:function(){p.setFieldsValue({resourceIds:p.getFieldValue("modalResourceIds")}),T(!1)},onCancel:function(){p.setFieldsValue({modalResourceIds:p.getFieldValue("resourceIds")}),T(!1)},confirmLoading:me},t.createElement(g.Z.Item,{label:"\u62E5\u6709\u8D44\u6E90",name:"modalResourceIds",noStyle:!0},t.createElement(Pe.Z,{treeData:F}))))},We=be,qe=e(66518),Te=e(95322),et=e(44862),Be=e(42091),Ke=e(3855),Ue=e(84664),Ce=e.n(Ue),Ie=e(89193),Ne={page:1,pageSize:6},$e={labelCol:{span:6},wrapperCol:{span:16}},ze=function(M){var i=M.visible,d=M.toggleVisible,f=M.formData,o=M.reload,le=(0,Ee.tT)("@@initialState"),b=le.initialState,H=b||{},G=H.userInfo,p=G||{},Z=p.orgId,w=g.Z.useForm(),q=(0,y.Z)(w,1),R=q[0],ee=(0,Ze.Z)(),P=ee.tip,W=ee.setTip,F=f.id,k=(0,t.useState)([]),J=(0,y.Z)(k,2),E=J[0],c=J[1],u=(0,Ie.x)(Ne),v=(0,y.Z)(u,2),T=v[0],Y=v[1],te=(0,ce.QT)(API.platform.sysUser.pageList.fetch,{manual:!0}),ue=te.data,U=te.run,me=te.loading,B=(0,ce.QT)(API.authorization.resourceRole.resourceRoleDetailUser.fetch,{manual:!0,onSuccess:function(A){var ae=A.userIdList,re=ae===void 0?[]:ae;c(re)}}),ne=B.run,fe=B.loading;(0,t.useEffect)(function(){i&&(U((0,r.Z)((0,r.Z)({},T),{},{orgId:Z})),ne({clientKey:he.OW.clientId,roleId:F}))},[Z,i,T]),(0,t.useEffect)(function(){return(0,Q.Z)(f)||R.setFieldsValue((0,r.Z)({},f)),function(){R.resetFields()}},[f]);var ve=function(){d(),R.resetFields()},Oe=function(){return W("\u6570\u636E\u4FDD\u5B58\u4E2D\uFF0C\u8BF7\u7A0D\u5019..."),API.authorization.resourceRole.resourceSaveAddUser.fetch({clientKey:he.OW.clientId,id:F,userIds:E.map(function(A){return+A}),resourceIds:f.resourceIds,role:f.role})},ge=(0,ce.QT)(Oe,{manual:!0,onSuccess:function(){m.default.success("\u6388\u6743\u6210\u529F"),R.resetFields(),d(),o==null||o()}}),ye=ge.run,pe=ge.loading,Xe=function(A,ae){var re=(0,Se.Z)(E);A.target.checked?re.push(+ae.userId):re=re.filter(function(we){return we!==ae.userId}),c(re)},_e=function(A){return t.createElement(Te.ZP.Item,null,t.createElement(Be.Z,{checked:E.includes(+A.userId),onChange:function(re){return Xe(re,A)}},t.createElement("div",{className:Ce().userName},A.userName,A.phone?"(".concat(A.phone.slice(-4),")"):"")))};return t.createElement(a.Z,{centered:!0,visible:i,forceRender:!0,maskClosable:!1,title:"\u7528\u6237\u6388\u6743",okButtonProps:{htmlType:"submit"},width:442,onOk:function(){return R.submit()},onCancel:ve,confirmLoading:pe,wrapClassName:"auth-modal"},t.createElement(h.Z,{spinning:me&&pe&&fe,tip:P},t.createElement(g.Z,(0,j.Z)({form:R,onFinish:ye},$e,{className:Ce().formWrap}),t.createElement(g.Z.Item,{label:"\u4F01\u4E1A\u7F16\u7801",name:"account",tooltip:{icon:t.createElement(Ke.Z,null),title:"\u4F01\u4E1A\u7F16\u7801\u5C06\u4F5C\u4E3A\u4F01\u4E1A\u4E0B\u6240\u6709\u8D26\u53F7\u540E\u7F00"},noStyle:!0},t.createElement(Te.ZP,{loading:me,className:Ce().listWrap,size:"small",dataSource:ue==null?void 0:ue.list,pagination:(0,r.Z)((0,r.Z)({},T),{},{current:T.page,onChange:function(A){Y(function(ae){ae.page=A})},showQuickJumper:!0}),renderItem:_e})))))},Ve=e(68699),je=e(94043),Ae=e.n(je),Qe=function(){var M=(0,t.useRef)(),i=(0,Ie.x)({visible:!1,formData:{},loading:!1}),d=(0,y.Z)(i,2),f=d[0],o=d[1],le=(0,Ie.x)({visible:!1,formData:{}}),b=(0,y.Z)(le,2),H=b[0],G=b[1],p=M.current||{},Z=p.reload,w=(0,ce.QT)(API.authorization.role.update.fetch,{manual:!0,onSuccess:function(){m.default.success("\u64CD\u4F5C\u6210\u529F"),Z==null||Z()}}),q=w.run,R=(0,ce.QT)(API.authorization.resourceRole.resourceDelete.fetch,{manual:!0,onSuccess:function(){m.default.success("\u5220\u9664\u6210\u529F"),Z==null||Z()}}),ee=R.run,P=function(){var E=(0,Ve.Z)(Ae().mark(function c(u){var v,T,Y,te;return Ae().wrap(function(U){for(;;)switch(U.prev=U.next){case 0:return U.next=2,API.platform.sysRole.pageList.fetch((0,Re.HO)((0,r.Z)((0,r.Z)({},u),{},{page:(u==null?void 0:u.current)||he.ii.page,pageSize:(u==null?void 0:u.pageSize)||he.ii.pageSize})));case 2:return v=U.sent,T=v.list,Y=v.page,te=v.total,U.abrupt("return",{data:T||[],page:Y,success:!0,total:te});case 7:case"end":return U.stop()}},c)}));return function(u){return E.apply(this,arguments)}}(),W=function(c){o(function(u){u.visible=!0,u.loading=!0,u.formData=c})},F=function(){o(function(c){c.visible=!0,c.formData={}})},k=function(c){var u=c||{},v=u.resourceMap,T=De(v);G(function(Y){Y.visible=!0,Y.formData=(0,r.Z)((0,r.Z)({},c),{},{resourceIds:T})})},J=function(c){var u={edit:o,auth:G};u[c](function(v){v.visible=!1,v.loading=!1,v.formData={}})};return{actionRef:M,reload:Z,editModalConfig:f,setEditModalConfig:o,authModalConfig:H,setAuthModalConfig:G,handleDisable:q,handleDelete:ee,fetchList:P,handleRoleEdit:W,handleRoleAdd:F,handleAuthorize:k,handleModalHide:J}},He=e(31261),tt=e(81984),Ge=e(82692),ke=e(73567),Je=function(M){var i=M.text,d=i===void 0?"":i,f=M.maxLength,o=f===void 0?50:f;return(d==null?void 0:d.length)>o?t.createElement(Ge.Z,{title:d},t.createElement("span",null,ke.ZP.textEllipsis(d,o))):t.createElement("span",null,d)},Ye=function(){var M=(0,Ee.tT)("company"),i=M.companyMapOptions,d=(0,He.Z)("auth_authority_menu_company"),f=d.showCompanySelect,o=Qe(),le=o.actionRef,b=o.reload,H=o.editModalConfig,G=o.fetchList,p=o.handleRoleAdd,Z=o.handleRoleEdit,w=o.handleModalHide,q=o.authModalConfig,R=o.handleAuthorize,ee=[{title:"\u4F01\u4E1A\u540D\u79F0",dataIndex:"orgCode",align:"left",copyable:!1,valueType:"text",hideInSearch:!f,hideInTable:!0,renderFormItem:function(){return t.createElement(s.Z,{allowClear:!0,options:i})}},{title:"\u89D2\u8272\u540D\u79F0",dataIndex:"role",align:"left",copyable:!1,valueType:"text",hideInSearch:!1},{title:"\u89D2\u8272\u63CF\u8FF0",dataIndex:"comment",align:"left",copyable:!1,valueType:"text",hideInSearch:!0},{title:"\u62E5\u6709\u8D44\u6E90",dataIndex:"resourceList",align:"left",copyable:!1,valueType:"text",hideInSearch:!0,render:function(W,F){var k=F||{},J=k.resourceMap,E=J===void 0?[]:J,c=[];return Object.keys(E).forEach(function(u){E[u].forEach(function(v){c.push(v.description)})}),t.createElement(Je,{text:c.join(",")})}},{title:"\u64CD\u4F5C",dataIndex:"id",align:"left",copyable:!1,valueType:"text",hideInSearch:!0,render:function(W,F){return t.createElement(l.Z,{buttons:[{name:"\u7F16\u8F91",key:"edit",onClick:function(){return Z(F)}},{name:"\u6388\u6743",key:"authorize",onClick:function(){return R(F)}}]})}}];return t.createElement(t.Fragment,null,t.createElement(C.ZP,{style:{padding:"18px 22px"},actionRef:le,request:G,onRequestError:function(W){console.error(W.message),m.default.error("\u6570\u636E\u52A0\u8F7D\u5931\u8D25,".concat(W.message))},columns:ee,bordered:!0,rowKey:"id",pagination:{size:"default"},dateFormatter:"string",headerTitle:"\u83DC\u5355\u6743\u9650\u5217\u8868",tableAlertRender:!1,toolBarRender:function(){return[t.createElement(S.Z,{onClick:p,key:"add",type:"primary"},t.createElement(D.Z,null),"\u65B0\u5EFA")]}}),t.createElement(We,{visible:H.visible,formData:H.formData,loading:H.loading,toggleVisible:function(){return w("edit")},reload:b}),t.createElement(ze,{visible:q.visible,formData:q.formData,toggleVisible:function(){return w("auth")},reload:b}))}},73567:function(N,O,e){"use strict";var $=1,S=1,z=4;O.ZP={fillZero:function(n){return typeof n=="number"&&n>=10?n:"0".concat(n)},textEllipsis:function(n,a){return n.length>a&&a>0?"".concat(n.substring(0,a),"..."):n},getLastSubstring:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";return n.substring(n.lastIndexOf(a)+a.length,n.length)},valueToString:function(n){return typeof n=="string"?n:JSON.stringify(n)},copyText:function(n){var a=document.createElement("input");document.body.appendChild(a),a.setAttribute("value",n),a.select(),document.execCommand("copy"),document.body.removeChild(a)},imgUrlToBase64:function(n,a,V){var h=document.createElement("canvas"),ie=h.getContext("2d");return new Promise(function(_,j){var L=new Image;L.crossOrigin="Anonymous",L.onload=function(){h.width=a,h.height=V,ie.drawImage(L,0,0,a,V);var K=h.toDataURL("image/");h=null,_(K)},L.onerror=function(K){j(K)},L.src=n})}};var m=function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:2;return n||n===0?(n/100).toFixed(a):""},X=function(n){return n*100},s=function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return n?"".concat(n.slice(0,a),"****").concat(n.slice(-a)):""},t=function(n){var a=/(?<=.)./g;return n==null?void 0:n.replace(a,"*")},C=function(n){var a,V=(a=n==null?void 0:n.split("-"))!==null&&a!==void 0?a:[];return V.filter(function(h){return!!h}).length===2?n:V.join("")},D=function(n,a){return n===$&&(a===S||a===z)}}}]);
