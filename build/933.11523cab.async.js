(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[933],{84664:function($){$.exports={formWrap:"formWrap___276Lb",rowWrap:"rowWrap___1Q2qE",listWrap:"listWrap___2GzdK",userName:"userName___3K3PK"}},55632:function($){$.exports={treeWrap:"treeWrap___LOi_-",cover:"cover___3a6dl"}},31567:function($,x,e){"use strict";var N=e(19597),Z=e(2291),Q=e(37482),E=e(3810),H=e(44742),i=e(67294),t=e(48786);x.Z=function(C){var L=C.buttons,u=C.maxNumber,n=u===void 0?2:u,r=C.className,j=C.style,S=L.filter(function(o){return!o.hidden}),ge=S.length,fe=function(F){var R=F,D=[];return F.length>n&&(R=F.slice(0,n-1),D=F.slice(n-1)),[R,D]},ue=(0,i.useMemo)(function(){return fe(S)},[S]),G=(0,H.Z)(ue,2),w=G[0],he=G[1];return i.createElement("div",{className:r,style:j},w.map(function(o,F){var R=o.name,D=o.key,ve=o.onClick,pe=o.path,Ee=i.createElement("a",{style:{marginRight:18},key:D,onClick:pe?function(){return t.m8.push(pe)}:ve},R);return F!==ge-1?i.createElement(i.Fragment,{key:D},Ee):Ee}),he.length>0&&i.createElement(Z.Z,{overlay:i.createElement(E.Z,null,he.map(function(o){return i.createElement(E.Z.Item,{onClick:o.path?function(){return t.m8.push(o.path)}:function(){var F;return(F=o.onClick)===null||F===void 0?void 0:F.call(o)}},o.name)}))},i.createElement("a",null,"\u66F4\u591A")))}},24342:function($,x,e){"use strict";var N=e(13378),Z=e(56361),Q=e(3911),E=e(67294),H=e(87542);x.Z=function(i){var t=i.value,C=t===void 0?[]:t,L=i.onChange,u=(0,Q.Z)(i,["value","onChange"]),n={selectedRowKeys:C,onChange:function(j){L==null||L(j)}};return E.createElement(H.ZP,(0,N.Z)({rowSelection:(0,Z.Z)((0,Z.Z)({},n),{},{checkStrictly:!0})},u))}},31261:function($,x,e){"use strict";e.d(x,{Z:function(){return Q}});var N=e(67294),Z=e(48786);function Q(E){var H=(0,Z.tT)("@@initialState"),i=H.initialState,t=i||{},C=t.privileges,L=C===void 0?[]:C,u=(0,N.useMemo)(function(){return L.some(function(n){return n.resourceKey===E})},[L,E]);return{showCompanySelect:u}}},84850:function($,x,e){"use strict";e.d(x,{Z:function(){return Q}});var N=e(44742),Z=e(67294);function Q(){var E=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,H=(0,Z.useState)(!1),i=(0,N.Z)(H,2),t=i[0],C=i[1],L=(0,Z.useState)(""),u=(0,N.Z)(L,2),n=u[0],r=u[1];return(0,Z.useEffect)(function(){C(E)},[]),{spinning:t,setSpinning:C,tip:n,setTip:r}}},3933:function($,x,e){"use strict";e.r(x),e.d(x,{default:function(){return et}});var N=e(13753),Z=e(48429),Q=e(14643),E=e(92909),H=e(97140),i=e(93228),t=e(67294),C=e(87542),L=e(49101),u=e(31567),n=e(26780),r=e(46567),j=e(58210),S=e(87240),ge=e(37092),fe=e(91911),ue=e(13378),G=e(68137),w=e(50532),he=e(3911),o=e(56361),F=e(67604),R=e(66498),D=e(44742),ve=e(46368),pe=e(46391),Ee=e(47376),le=e(66827),De=e(84850),ye=e(48786),ie=e(66594),xe=e(55632),Te=e.n(xe),Me=e(50189),Le=function(s){var l=[];return s?(Object.keys(s).forEach(function(c){l.push.apply(l,(0,Me.Z)(s[c].map(function(a){return a.id})))}),l):[]},Oe=e(27870),Fe=e(24342),We={labelCol:{span:3},wrapperCol:{span:20}},_e={labelCol:{span:3},wrapperCol:{span:10}},Be=function(s){var l=s.visible,c=s.toggleVisible,a=s.formData,J=s.loading,W=s.reload,de=s.resourceList,_=s.resourceTreeData,B=s.orgCode,q=R.Z.useForm(),ee=(0,D.Z)(q,1),f=ee[0],U=(0,De.Z)(),O=U.tip,te=U.setTip,ne=a.id,Y=(0,ye.tT)("@@initialState"),v=Y.initialState,ce=v||{},T=ce.userInfo,P=T||{},M=P.orgCode,X=(0,t.useState)(!1),z=(0,D.Z)(X,2),K=z[0],V=z[1];(0,t.useEffect)(function(){if(!(0,ve.Z)(a)){var p=a||{},A=p.resourceMap,ae=A===void 0?{}:A,I=Le(ae);(0,ve.Z)(ae.\u654F\u6377\u5E94\u7528)||I.push(ie.ku),f.setFieldsValue((0,o.Z)((0,o.Z)({},a),{},{resourceIds:I,modalResourceIds:I}))}return function(){f.resetFields()}},[a]);var k=function(){c(),f.resetFields()},y=function(A){var ae=A.resourceIds,I=ae===void 0?[]:ae,be=A.modalResourceIds,Ce=(0,he.Z)(A,["resourceIds","modalResourceIds"]);te("\u6570\u636E\u4FDD\u5B58\u4E2D\uFF0C\u8BF7\u7A0D\u5019...");var Se=(0,Oe.HO)((0,o.Z)((0,o.Z)({},Ce),{},{clientKey:ie.OW.clientId,id:ne,businessValue:B!=null?B:M,resourceIds:I.filter(function(Re){return(0,pe.Z)(Re)})}));return API.authorization.resourceRole.resourceSave.fetch(Se)},g=(0,le.QT)(y,{manual:!0,onSuccess:function(){E.default.success("\u4FDD\u5B58\u6210\u529F"),f.resetFields(),c(),W==null||W()}}),d=g.run,h=g.loading,re=[{title:"\u8D44\u6E90\u540D\u79F0",dataIndex:"description",align:"left",copyable:!1,valueType:"text"},{title:"\u8D44\u6E90\u6807\u8BC6",dataIndex:"resourceKey",align:"left",copyable:!1,valueType:"text"},{title:"\u8D44\u6E90\u7C7B\u578B",dataIndex:"type",align:"left",copyable:!1,valueType:"text",render:function(A){return A===ie.o4.\u8DEF\u7531\u7EA7\u8D44\u6E90?"\u8DEF\u7531\u7EA7\u8D44\u6E90":"\u9875\u9762\u7EA7\u8D44\u6E90"}}];return t.createElement(R.Z,(0,ue.Z)({form:f,onFinish:d},_e),t.createElement(r.Z,{centered:!0,visible:l,forceRender:!0,maskClosable:!1,title:"".concat((0,Ee.Z)(ne)?"\u65B0\u5EFA":"\u7F16\u8F91","\u89D2\u8272"),okButtonProps:{htmlType:"submit"},width:800,onOk:function(){return f.submit()},onCancel:k,confirmLoading:h},t.createElement(S.Z,{spinning:J&&h,tip:O},t.createElement(R.Z.Item,{label:"\u89D2\u8272\u540D\u79F0",name:"role",rules:[{whitespace:!0},{required:!0}]},t.createElement(w.Z,{placeholder:"\u8BF7\u8F93\u5165"})),t.createElement(R.Z.Item,(0,ue.Z)({label:"\u89D2\u8272\u63CF\u8FF0",name:"comment"},We,{rules:[{whitespace:!0}]}),t.createElement(w.Z,{placeholder:"\u8BF7\u8F93\u5165"})),t.createElement("div",{className:Te().treeWrap},t.createElement("div",{className:Te().cover,onClick:function(){return V(!0)}}),t.createElement(R.Z.Item,{label:"\u62E5\u6709\u8D44\u6E90",name:"resourceIds",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u62E5\u6709\u8D44\u6E90"}]},t.createElement(fe.Z,{treeData:_,allowClear:!0,multiple:!0,placeholder:"\u8BF7\u9009\u62E9"}))))),t.createElement(r.Z,{centered:!0,visible:K,forceRender:!0,maskClosable:!1,title:"\u62E5\u6709\u8D44\u6E90",width:800,onOk:function(){f.setFieldsValue({resourceIds:f.getFieldValue("modalResourceIds")}),V(!1)},onCancel:function(){f.setFieldsValue({modalResourceIds:f.getFieldValue("resourceIds")}),V(!1)},confirmLoading:h},t.createElement(R.Z.Item,{label:"\u62E5\u6709\u8D44\u6E90",name:"modalResourceIds",noStyle:!0},t.createElement(Fe.Z,{search:!1,rowKey:"id",columns:re,dataSource:de}))))},Ue=Be,nt=e(66518),Pe=e(95322),rt=e(44862),Ke=e(42091),Ne=e(84664),Ie=e.n(Ne),Ze=e(89193),je={page:1,pageSize:6},ze={labelCol:{span:6},wrapperCol:{span:16}},Ve=function(m){var s=m.visible,l=m.toggleVisible,c=m.formData,a=m.reload,J=m.orgCode,W=(0,ye.tT)("@@initialState"),de=W.initialState,_=de||{},B=_.userInfo,q=B||{},ee=q.orgCode,f=R.Z.useForm(),U=(0,D.Z)(f,1),O=U[0],te=(0,De.Z)(),ne=te.tip,Y=te.setTip,v=c.id,ce=(0,t.useState)([]),T=(0,D.Z)(ce,2),P=T[0],M=T[1],X=(0,Ze.x)(je),z=(0,D.Z)(X,2),K=z[0],V=z[1],k=(0,le.QT)(API.platform.sysUser.pageList.fetch,{manual:!0}),y=k.data,g=k.run,d=k.loading,h=(0,le.QT)(API.authorization.resourceRole.resourceRoleDetailUser.fetch,{manual:!0,onSuccess:function(b){var oe=b.userIdList,se=oe===void 0?[]:oe;M(se)}}),re=h.run,p=h.loading;(0,t.useEffect)(function(){s&&(g((0,o.Z)((0,o.Z)({},K),{},{orgCode:J||ee})),re({clientKey:ie.OW.clientId,roleId:v}))},[J,ee,s,K]),(0,t.useEffect)(function(){return(0,ve.Z)(c)||O.setFieldsValue((0,o.Z)({},c)),function(){O.resetFields()}},[c]);var A=function(){l(),O.resetFields()},ae=function(){return Y("\u6570\u636E\u4FDD\u5B58\u4E2D\uFF0C\u8BF7\u7A0D\u5019..."),API.authorization.resourceRole.resourceSaveAddUser.fetch({clientKey:ie.OW.clientId,id:v,userIds:P.map(function(b){return+b}),resourceIds:c.resourceIds,role:c.role})},I=(0,le.QT)(ae,{manual:!0,onSuccess:function(){E.default.success("\u6388\u6743\u6210\u529F"),O.resetFields(),l(),a==null||a()}}),be=I.run,Ce=I.loading,Se=function(b,oe){var se=(0,Me.Z)(P);b.target.checked?se.push(+oe.userId):se=se.filter(function(tt){return tt!==oe.userId}),M(se)},Re=function(b){return t.createElement(Pe.ZP.Item,null,t.createElement(Ke.Z,{checked:P.includes(+b.userId),onChange:function(se){return Se(se,b)}},t.createElement("div",{className:Ie().userName},b.userName,b.phone?"(".concat(b.phone.slice(-4),")"):"")))};return t.createElement(r.Z,{centered:!0,visible:s,forceRender:!0,maskClosable:!1,title:"\u7528\u6237\u6388\u6743",okButtonProps:{htmlType:"submit"},width:442,onOk:function(){return O.submit()},onCancel:A,confirmLoading:Ce,wrapClassName:"auth-modal"},t.createElement(S.Z,{spinning:d&&Ce&&p,tip:ne},t.createElement(R.Z,(0,ue.Z)({form:O,onFinish:be},ze,{className:Ie().formWrap}),t.createElement(R.Z.Item,{label:"\u7528\u6237\u6388\u6743",noStyle:!0},t.createElement(Pe.ZP,{loading:d,className:Ie().listWrap,size:"small",dataSource:y==null?void 0:y.list,pagination:(0,o.Z)((0,o.Z)({},K),{},{current:K.page,onChange:function(b){V(function(oe){oe.page=b})},showQuickJumper:!0}),renderItem:Re})))))},$e=e(68699),Qe=e(94043),Ae=e.n(Qe),He=e(70552),Ge=e(95760);function Je(){var m=(0,le.QT)(API.platform.sysUser.myResourceList.fetch),s=m.data,l=m.run;return{resourceList:(0,Ge.r)(s),resourceTreeData:(0,He.Z)(s),fetchResourceList:l}}var Ye=function(){var m=(0,t.useRef)(),s=(0,t.useState)(),l=(0,D.Z)(s,2),c=l[0],a=l[1],J=(0,Ze.x)({visible:!1,formData:{},loading:!1}),W=(0,D.Z)(J,2),de=W[0],_=W[1],B=(0,Ze.x)({visible:!1,formData:{}}),q=(0,D.Z)(B,2),ee=q[0],f=q[1],U=Je(),O=U.fetchResourceList,te=U.resourceList,ne=U.resourceTreeData,Y=m.current||{},v=Y.reload,ce=(0,le.QT)(API.authorization.role.update.fetch,{manual:!0,onSuccess:function(){E.default.success("\u64CD\u4F5C\u6210\u529F"),v==null||v()}}),T=ce.run,P=(0,le.QT)(API.authorization.resourceRole.resourceDelete.fetch,{manual:!0,onSuccess:function(){E.default.success("\u5220\u9664\u6210\u529F"),v==null||v()}}),M=P.run;(0,t.useEffect)(function(){v==null||v()},[c]);var X=function(){var y=(0,$e.Z)(Ae().mark(function g(d){var h,re,p,A;return Ae().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return I.next=2,API.platform.sysRole.pageList.fetch((0,Oe.HO)((0,o.Z)((0,o.Z)({},d),{},{orgCode:c,page:(d==null?void 0:d.current)||ie.ii.page,pageSize:(d==null?void 0:d.pageSize)||ie.ii.pageSize})));case 2:return h=I.sent,re=h.list,p=h.page,A=h.total,I.abrupt("return",{data:re||[],page:p,success:!0,total:A});case 7:case"end":return I.stop()}},g)}));return function(d){return y.apply(this,arguments)}}(),z=function(g){_(function(d){d.visible=!0,d.loading=!0,d.formData=g})},K=function(){_(function(g){g.visible=!0,g.formData={}})},V=function(g){var d=g||{},h=d.resourceMap,re=Le(h);f(function(p){p.visible=!0,p.formData=(0,o.Z)((0,o.Z)({},g),{},{resourceIds:re})})},k=function(g){var d={edit:_,auth:f};d[g](function(h){h.visible=!1,h.loading=!1,h.formData={}})};return{orgCode:c,setOrgCode:a,actionRef:m,reload:v,editModalConfig:de,resourceList:te,fetchResourceList:O,resourceTreeData:ne,setEditModalConfig:_,authModalConfig:ee,setAuthModalConfig:f,handleDisable:T,handleDelete:M,fetchList:X,handleRoleEdit:z,handleRoleAdd:K,handleAuthorize:V,handleModalHide:k}},Xe=e(31261),at=e(81984),ke=e(82692),we=e(73567),qe=function(m){var s=m.text,l=s===void 0?"":s,c=m.maxLength,a=c===void 0?50:c;return(l==null?void 0:l.length)>a?t.createElement(ke.Z,{title:l},t.createElement("span",null,we.ZP.textEllipsis(l,a))):t.createElement("span",null,l)},et=function(){var m=(0,ye.tT)("company"),s=m.companyMapOptions,l=(0,Xe.Z)("cloud_authority_menu_company"),c=l.showCompanySelect,a=Ye(),J=a.orgCode,W=a.setOrgCode,de=a.actionRef,_=a.reload,B=a.editModalConfig,q=a.fetchList,ee=a.handleRoleAdd,f=a.handleRoleEdit,U=a.handleModalHide,O=a.authModalConfig,te=a.resourceList,ne=a.resourceTreeData,Y=a.fetchResourceList,v=a.handleAuthorize,ce=[{title:"\u4F01\u4E1A\u540D\u79F0",dataIndex:"orgCode",align:"left",copyable:!1,valueType:"text",hideInSearch:!c,hideInTable:!0,renderFormItem:function(){return t.createElement(i.Z,{allowClear:!0,options:s,onChange:function(M){W(M),Y==null||Y({orgCode:M})}})}},{title:"\u89D2\u8272\u540D\u79F0",dataIndex:"role",align:"left",copyable:!1,valueType:"text",hideInSearch:!1},{title:"\u89D2\u8272\u63CF\u8FF0",dataIndex:"comment",align:"left",copyable:!1,valueType:"text",hideInSearch:!0},{title:"\u62E5\u6709\u8D44\u6E90",dataIndex:"resourceList",align:"left",copyable:!1,valueType:"text",hideInSearch:!0,render:function(P,M){var X=M||{},z=X.resourceMap,K=z===void 0?[]:z,V=[];return Object.keys(K).forEach(function(k){K[k].forEach(function(y){V.push(y.description)})}),t.createElement(qe,{text:V.join(",")})}},{title:"\u64CD\u4F5C",dataIndex:"id",align:"left",copyable:!1,valueType:"text",hideInSearch:!0,render:function(P,M){return t.createElement(u.Z,{buttons:[{name:"\u7F16\u8F91",key:"edit",onClick:function(){return f(M)}},{name:"\u6388\u6743",key:"authorize",onClick:function(){return v(M)}}]})}}];return t.createElement(t.Fragment,null,t.createElement(C.ZP,{style:{padding:"18px 22px"},actionRef:de,request:q,onRequestError:function(P){console.error(P.message),E.default.error("\u6570\u636E\u52A0\u8F7D\u5931\u8D25,".concat(P.message))},onReset:function(){return W("")},columns:ce,bordered:!0,rowKey:"id",pagination:{size:"default"},dateFormatter:"string",headerTitle:"\u83DC\u5355\u6743\u9650\u5217\u8868",tableAlertRender:!1,toolBarRender:function(){return[t.createElement(Z.Z,{onClick:ee,key:"add",type:"primary"},t.createElement(L.Z,null),"\u65B0\u5EFA")]}}),t.createElement(Ue,{visible:B.visible,formData:B.formData,loading:B.loading,toggleVisible:function(){return U("edit")},reload:_,resourceList:te,resourceTreeData:ne,orgCode:J}),t.createElement(Ve,{visible:O.visible,formData:O.formData,toggleVisible:function(){return U("auth")},reload:_,orgCode:J}))}},73567:function($,x,e){"use strict";var N=1,Z=1,Q=4;x.ZP={fillZero:function(n){return typeof n=="number"&&n>=10?n:"0".concat(n)},textEllipsis:function(n,r){return n.length>r&&r>0?"".concat(n.substring(0,r),"..."):n},getLastSubstring:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";return n.substring(n.lastIndexOf(r)+r.length,n.length)},valueToString:function(n){return typeof n=="string"?n:JSON.stringify(n)},copyText:function(n){var r=document.createElement("input");document.body.appendChild(r),r.setAttribute("value",n),r.select(),document.execCommand("copy"),document.body.removeChild(r)},imgUrlToBase64:function(n,r,j){var S=document.createElement("canvas"),ge=S.getContext("2d");return new Promise(function(fe,ue){var G=new Image;G.crossOrigin="Anonymous",G.onload=function(){S.width=r,S.height=j,ge.drawImage(G,0,0,r,j);var w=S.toDataURL("image/");S=null,fe(w)},G.onerror=function(w){ue(w)},G.src=n})}};var E=function(n){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:2;return n||n===0?(n/100).toFixed(r):""},H=function(n){return n*100},i=function(n){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return n?"".concat(n.slice(0,r),"****").concat(n.slice(-r)):""},t=function(n){var r=/(?<=.)./g;return n==null?void 0:n.replace(r,"*")},C=function(n){var r,j=(r=n==null?void 0:n.split("-"))!==null&&r!==void 0?r:[];return j.filter(function(S){return!!S}).length===2?n:j.join("")},L=function(n,r){return n===N&&(r===Z||r===Q)}}}]);
