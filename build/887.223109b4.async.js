(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[887],{84664:function(z){z.exports={formWrap:"formWrap___276Lb",rowWrap:"rowWrap___1Q2qE",listWrap:"listWrap___2GzdK",userName:"userName___3K3PK"}},55632:function(z){z.exports={treeWrap:"treeWrap___LOi_-",cover:"cover___3a6dl"}},31567:function(z,T,e){"use strict";var V=e(19597),S=e(2291),$=e(37482),m=e(3810),j=e(44742),s=e(67294),n=e(48786);T.Z=function(p){var P=p.buttons,l=p.maxNumber,t=l===void 0?2:l,a=p.className,k=p.style,C=P.filter(function(o){return!o.hidden}),ce=C.length,se=function(F){var y=F,D=[];return F.length>t&&(y=F.slice(0,t-1),D=F.slice(t-1)),[y,D]},te=(0,s.useMemo)(function(){return se(C)},[C]),Q=(0,j.Z)(te,2),w=Q[0],me=Q[1];return s.createElement("div",{className:a,style:k},w.map(function(o,F){var y=o.name,D=o.key,fe=o.onClick,ve=o.path,he=s.createElement("a",{style:{marginRight:18},key:D,onClick:ve?function(){return n.m8.push(ve)}:fe},y);return F!==ce-1?s.createElement(s.Fragment,{key:D},he):he}),me.length>0&&s.createElement(S.Z,{overlay:s.createElement(m.Z,null,me.map(function(o){return s.createElement(m.Z.Item,{onClick:o.path?function(){return n.m8.push(o.path)}:function(){var F;return(F=o.onClick)===null||F===void 0?void 0:F.call(o)}},o.name)}))},s.createElement("a",null,"\u66F4\u591A")))}},57044:function(z,T,e){"use strict";var V=e(87753),S=e(98570),$=e(67294);T.Z=function(m){var j=m.value,s=m.onChange,n=m.treeData,p=n===void 0?[]:n,P=function(t){s==null||s(t)};return $.createElement(S.Z,{checkable:!0,defaultExpandAll:!0,onCheck:function(t){return P(t)},checkedKeys:j,treeData:p})}},31261:function(z,T,e){"use strict";e.d(T,{Z:function(){return $}});var V=e(67294),S=e(48786);function $(m){var j=(0,S.tT)("@@initialState"),s=j.initialState,n=s||{},p=n.privileges,P=p===void 0?[]:p,l=(0,V.useMemo)(function(){return P.some(function(t){return t.resourceKey===m})},[P,m]);return{showCompanySelect:l}}},84850:function(z,T,e){"use strict";e.d(T,{Z:function(){return $}});var V=e(44742),S=e(67294);function $(){var m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,j=(0,S.useState)(!1),s=(0,V.Z)(j,2),n=s[0],p=s[1],P=(0,S.useState)(""),l=(0,V.Z)(P,2),t=l[0],a=l[1];return(0,S.useEffect)(function(){p(m)},[]),{spinning:n,setSpinning:p,tip:t,setTip:a}}},76887:function(z,T,e){"use strict";e.r(T),e.d(T,{default:function(){return He}});var V=e(13753),S=e(48429),$=e(14643),m=e(92909),j=e(97140),s=e(93228),n=e(67294),p=e(21191),P=e(49101),l=e(31567),t=e(26780),a=e(46567),k=e(58210),C=e(87240),ce=e(37092),se=e(91911),te=e(13378),Q=e(68137),w=e(50532),me=e(3911),o=e(56361),F=e(67604),y=e(66498),D=e(44742),fe=e(46368),ve=e(46391),he=e(47376),ae=e(66827),Ee=e(84850),Ce=e(48786),ie=e(66594),Re=e(57044),Te=e(55632),ye=e.n(Te),Ie=e(50189),Ze=function(d){var c=[];return d?(Object.keys(d).forEach(function(f){c.push.apply(c,(0,Ie.Z)(d[f].map(function(r){return r.id})))}),c):[]},Me=e(27870),Ae={labelCol:{span:3},wrapperCol:{span:20}},Oe={labelCol:{span:3},wrapperCol:{span:10}},Pe=function(d){var c=d.visible,f=d.toggleVisible,r=d.formData,ne=d.loading,L=d.reload,Z=y.Z.useForm(),W=(0,D.Z)(Z,1),h=W[0],M=(0,Ee.Z)(),H=M.tip,_=M.setTip,G=r.id,J=(0,Ce.tT)("@@initialState"),R=J.initialState,x=R||{},A=x.authResourceData,O=x.userInfo,q=O||{},g=q.orgCode,i=(0,n.useState)(!1),u=(0,D.Z)(i,2),v=u[0],b=u[1];(0,n.useEffect)(function(){if(!(0,fe.Z)(r)){var N=r||{},X=N.resourceMap,le=X===void 0?{}:X,ue=Ze(le);h.setFieldsValue((0,o.Z)((0,o.Z)({},r),{},{resourceIds:ue,modalResourceIds:ue}))}return function(){h.resetFields()}},[r]);var Y=function(){f(),h.resetFields()},re=function(X){var le=X.resourceIds,ue=le===void 0?[]:le,ee=X.modalResourceIds,E=(0,me.Z)(X,["resourceIds","modalResourceIds"]);_("\u6570\u636E\u4FDD\u5B58\u4E2D\uFF0C\u8BF7\u7A0D\u5019...");var U=(0,Me.HO)((0,o.Z)((0,o.Z)({},E),{},{clientKey:ie.OW.clientId,id:G,businessValue:g,resourceIds:ue.filter(function(K){return(0,ve.Z)(K)})}));return API.authorization.resourceRole.resourceSave.fetch(U)},de=(0,ae.QT)(re,{manual:!0,onSuccess:function(){m.default.success("\u4FDD\u5B58\u6210\u529F"),h.resetFields(),f(),L==null||L()}}),B=de.run,oe=de.loading;return n.createElement(y.Z,(0,te.Z)({form:h,onFinish:B},Oe),n.createElement(a.Z,{centered:!0,visible:c,forceRender:!0,maskClosable:!1,title:"".concat((0,he.Z)(G)?"\u65B0\u5EFA":"\u7F16\u8F91","\u89D2\u8272"),okButtonProps:{htmlType:"submit"},width:800,onOk:function(){return h.submit()},onCancel:Y,confirmLoading:oe},n.createElement(C.Z,{spinning:ne&&oe,tip:H},n.createElement(y.Z.Item,{label:"\u89D2\u8272\u540D\u79F0",name:"role",rules:[{whitespace:!0},{required:!0}]},n.createElement(w.Z,{placeholder:"\u8BF7\u8F93\u5165"})),n.createElement(y.Z.Item,(0,te.Z)({label:"\u89D2\u8272\u63CF\u8FF0",name:"comment"},Ae,{rules:[{whitespace:!0}]}),n.createElement(w.Z,{placeholder:"\u8BF7\u8F93\u5165"})),n.createElement("div",{className:ye().treeWrap},n.createElement("div",{className:ye().cover,onClick:function(){return b(!0)}}),n.createElement(y.Z.Item,{label:"\u62E5\u6709\u8D44\u6E90",name:"resourceIds",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u62E5\u6709\u8D44\u6E90"}]},n.createElement(se.Z,{treeData:A,allowClear:!0,multiple:!0,placeholder:"\u8BF7\u9009\u62E9"}))))),n.createElement(a.Z,{centered:!0,visible:v,forceRender:!0,maskClosable:!1,title:"\u62E5\u6709\u8D44\u6E90",width:412,onOk:function(){h.setFieldsValue({resourceIds:h.getFieldValue("modalResourceIds")}),b(!1)},onCancel:function(){h.setFieldsValue({modalResourceIds:h.getFieldValue("resourceIds")}),b(!1)},confirmLoading:oe},n.createElement(y.Z.Item,{label:"\u62E5\u6709\u8D44\u6E90",name:"modalResourceIds",noStyle:!0},n.createElement(Re.Z,{treeData:A}))))},Fe=Pe,Je=e(66518),Se=e(95322),Ye=e(44862),Le=e(42091),xe=e(3855),be=e(84664),ge=e.n(be),pe=e(89193),We={page:1,pageSize:6},Be={labelCol:{span:6},wrapperCol:{span:16}},Ne=function(I){var d=I.visible,c=I.toggleVisible,f=I.formData,r=I.reload,ne=y.Z.useForm(),L=(0,D.Z)(ne,1),Z=L[0],W=(0,Ee.Z)(),h=W.tip,M=W.setTip,H=f.id,_=(0,n.useState)([]),G=(0,D.Z)(_,2),J=G[0],R=G[1],x=(0,pe.x)(We),A=(0,D.Z)(x,2),O=A[0],q=A[1],g=(0,ae.QT)(API.platform.sysUser.pageList.fetch,{manual:!0}),i=g.data,u=g.run,v=g.loading,b=(0,ae.QT)(API.authorization.resourceRole.resourceRoleDetailUser.fetch,{manual:!0,onSuccess:function(E){var U=E.userIdList,K=U===void 0?[]:U;R(K)}}),Y=b.run,re=b.loading;(0,n.useEffect)(function(){d&&(u(O),Y({clientKey:ie.OW.clientId,roleId:H}))},[d,O]),(0,n.useEffect)(function(){return(0,fe.Z)(f)||Z.setFieldsValue((0,o.Z)({},f)),function(){Z.resetFields()}},[f]);var de=function(){c(),Z.resetFields()},B=function(){return M("\u6570\u636E\u4FDD\u5B58\u4E2D\uFF0C\u8BF7\u7A0D\u5019..."),API.authorization.resourceRole.resourceSaveAddUser.fetch({clientKey:ie.OW.clientId,id:H,userIds:J.map(function(E){return+E}),resourceIds:f.resourceIds,role:f.role})},oe=(0,ae.QT)(B,{manual:!0,onSuccess:function(){m.default.success("\u6388\u6743\u6210\u529F"),Z.resetFields(),c(),r==null||r()}}),N=oe.run,X=oe.loading,le=function(E,U){var K=(0,Ie.Z)(J);E.target.checked?K.push(+U.userId):K=K.filter(function(Ge){return Ge!==U.userId}),R(K)},ue=function(E){return n.createElement(Se.ZP.Item,null,n.createElement(Le.Z,{checked:J.includes(+E.userId),onChange:function(K){return le(K,E)}},n.createElement("div",{className:ge().userName},E.userName,E.phone?"(".concat(E.phone.slice(-4),")"):"")))};return n.createElement(a.Z,{centered:!0,visible:d,forceRender:!0,maskClosable:!1,title:"\u7528\u6237\u6388\u6743",okButtonProps:{htmlType:"submit"},width:442,onOk:function(){return Z.submit()},onCancel:de,confirmLoading:X,wrapClassName:"auth-modal"},n.createElement(C.Z,{spinning:v&&X&&re,tip:h},n.createElement(y.Z,(0,te.Z)({form:Z,onFinish:N},Be,{className:ge().formWrap}),n.createElement(y.Z.Item,{label:"\u4F01\u4E1A\u7F16\u7801",name:"account",tooltip:{icon:n.createElement(xe.Z,null),title:"\u4F01\u4E1A\u7F16\u7801\u5C06\u4F5C\u4E3A\u4F01\u4E1A\u4E0B\u6240\u6709\u8D26\u53F7\u540E\u7F00"},noStyle:!0},n.createElement(Se.ZP,{loading:v,className:ge().listWrap,size:"small",dataSource:i==null?void 0:i.list,pagination:(0,o.Z)((0,o.Z)({},O),{},{current:O.page,onChange:function(E){q(function(U){U.page=E})},showQuickJumper:!0}),renderItem:ue})))))},Ue=e(68699),Ke=e(94043),De=e.n(Ke),ze=function(){var I=(0,n.useRef)(),d=(0,pe.x)({visible:!1,formData:{},loading:!1}),c=(0,D.Z)(d,2),f=c[0],r=c[1],ne=(0,pe.x)({visible:!1,formData:{}}),L=(0,D.Z)(ne,2),Z=L[0],W=L[1],h=I.current||{},M=h.reload,H=(0,ae.QT)(API.authorization.role.update.fetch,{manual:!0,onSuccess:function(){m.default.success("\u64CD\u4F5C\u6210\u529F"),M==null||M()}}),_=H.run,G=(0,ae.QT)(API.authorization.resourceRole.resourceDelete.fetch,{manual:!0,onSuccess:function(){m.default.success("\u5220\u9664\u6210\u529F"),M==null||M()}}),J=G.run,R=function(){var g=(0,Ue.Z)(De().mark(function i(u){var v,b,Y,re;return De().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return B.next=2,API.platform.sysRole.pageList.fetch((0,Me.HO)((0,o.Z)((0,o.Z)({},u),{},{page:(u==null?void 0:u.current)||ie.ii.page,pageSize:(u==null?void 0:u.pageSize)||ie.ii.pageSize})));case 2:return v=B.sent,b=v.list,Y=v.page,re=v.total,B.abrupt("return",{data:b||[],page:Y,success:!0,total:re});case 7:case"end":return B.stop()}},i)}));return function(u){return g.apply(this,arguments)}}(),x=function(i){r(function(u){u.visible=!0,u.loading=!0,u.formData=i})},A=function(){r(function(i){i.visible=!0,i.formData={}})},O=function(i){var u=i||{},v=u.resourceMap,b=Ze(v);W(function(Y){Y.visible=!0,Y.formData=(0,o.Z)((0,o.Z)({},i),{},{resourceIds:b})})},q=function(i){var u={edit:r,auth:W};u[i](function(v){v.visible=!1,v.loading=!1,v.formData={}})};return{actionRef:I,reload:M,editModalConfig:f,setEditModalConfig:r,authModalConfig:Z,setAuthModalConfig:W,handleDisable:_,handleDelete:J,fetchList:R,handleRoleEdit:x,handleRoleAdd:A,handleAuthorize:O,handleModalHide:q}},Ve=e(31261),Xe=e(81984),$e=e(82692),je=e(73567),Qe=function(I){var d=I.text,c=d===void 0?"":d,f=I.maxLength,r=f===void 0?50:f;return(c==null?void 0:c.length)>r?n.createElement($e.Z,{title:c},n.createElement("span",null,je.ZP.textEllipsis(c,r))):n.createElement("span",null,c)},He=function(){var I=(0,Ce.tT)("company"),d=I.companyMapOptions,c=(0,Ve.Z)("auth_authority_menu_company"),f=c.showCompanySelect,r=ze(),ne=r.actionRef,L=r.reload,Z=r.editModalConfig,W=r.fetchList,h=r.handleRoleAdd,M=r.handleRoleEdit,H=r.handleModalHide,_=r.authModalConfig,G=r.handleAuthorize,J=[{title:"\u4F01\u4E1A\u540D\u79F0",dataIndex:"orgCode",align:"left",copyable:!1,valueType:"text",hideInSearch:!f,hideInTable:!0,renderFormItem:function(){return n.createElement(s.Z,{allowClear:!0,options:d})}},{title:"\u89D2\u8272\u540D\u79F0",dataIndex:"role",align:"left",copyable:!1,valueType:"text",hideInSearch:!1},{title:"\u89D2\u8272\u63CF\u8FF0",dataIndex:"comment",align:"left",copyable:!1,valueType:"text",hideInSearch:!0},{title:"\u62E5\u6709\u8D44\u6E90",dataIndex:"resourceList",align:"left",copyable:!1,valueType:"text",hideInSearch:!0,render:function(x,A){var O=A||{},q=O.resourceMap,g=q===void 0?[]:q,i=[];return Object.keys(g).forEach(function(u){g[u].forEach(function(v){i.push(v.description)})}),n.createElement(Qe,{text:i.join(",")})}},{title:"\u64CD\u4F5C",dataIndex:"id",align:"left",copyable:!1,valueType:"text",hideInSearch:!0,render:function(x,A){return n.createElement(l.Z,{buttons:[{name:"\u7F16\u8F91",key:"edit",onClick:function(){return M(A)}},{name:"\u6388\u6743",key:"authorize",onClick:function(){return G(A)}}]})}}];return n.createElement(n.Fragment,null,n.createElement(p.ZP,{style:{padding:"18px 22px"},actionRef:ne,request:W,onRequestError:function(x){console.error(x.message),m.default.error("\u6570\u636E\u52A0\u8F7D\u5931\u8D25,".concat(x.message))},columns:J,bordered:!0,rowKey:"id",pagination:{size:"default"},dateFormatter:"string",headerTitle:"\u83DC\u5355\u6743\u9650\u5217\u8868",tableAlertRender:!1,toolBarRender:function(){return[n.createElement(S.Z,{onClick:h,key:"add",type:"primary"},n.createElement(P.Z,null),"\u65B0\u5EFA")]}}),n.createElement(Fe,{visible:Z.visible,formData:Z.formData,loading:Z.loading,toggleVisible:function(){return H("edit")},reload:L}),n.createElement(Ne,{visible:_.visible,formData:_.formData,toggleVisible:function(){return H("auth")},reload:L}))}},73567:function(z,T,e){"use strict";var V=1,S=1,$=4;T.ZP={fillZero:function(t){return typeof t=="number"&&t>=10?t:"0".concat(t)},textEllipsis:function(t,a){return t.length>a&&a>0?"".concat(t.substring(0,a),"..."):t},getLastSubstring:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";return t.substring(t.lastIndexOf(a)+a.length,t.length)},valueToString:function(t){return typeof t=="string"?t:JSON.stringify(t)},copyText:function(t){var a=document.createElement("input");document.body.appendChild(a),a.setAttribute("value",t),a.select(),document.execCommand("copy"),document.body.removeChild(a)},imgUrlToBase64:function(t,a,k){var C=document.createElement("canvas"),ce=C.getContext("2d");return new Promise(function(se,te){var Q=new Image;Q.crossOrigin="Anonymous",Q.onload=function(){C.width=a,C.height=k,ce.drawImage(Q,0,0,a,k);var w=C.toDataURL("image/");C=null,se(w)},Q.onerror=function(w){te(w)},Q.src=t})}};var m=function(t){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:2;return t||t===0?(t/100).toFixed(a):""},j=function(t){return t*100},s=function(t){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return t?"".concat(t.slice(0,a),"****").concat(t.slice(-a)):""},n=function(t){var a=/(?<=.)./g;return t==null?void 0:t.replace(a,"*")},p=function(t){var a,k=(a=t==null?void 0:t.split("-"))!==null&&a!==void 0?a:[];return k.filter(function(C){return!!C}).length===2?t:k.join("")},P=function(t,a){return t===V&&(a===S||a===$)}}}]);
