(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[840],{84664:function(H){H.exports={formWrap:"formWrap___276Lb",rowWrap:"rowWrap___1Q2qE",listWrap:"listWrap___2GzdK",userName:"userName___3K3PK"}},55632:function(H){H.exports={treeWrap:"treeWrap___LOi_-",cover:"cover___3a6dl"}},31567:function(H,U,e){"use strict";var ne=e(19597),W=e(2291),ae=e(37482),g=e(3810),Y=e(44742),l=e(67294),t=e(48786);U.Z=function(Z){var G=Z.buttons,x=Z.maxNumber,R=x===void 0?2:x,J=Z.className,Ee=Z.style,w=G.filter(function(n){return!n.hidden}),pe=w.length,me=function(y){var E=y,I=[];return y.length>R&&(E=y.slice(0,R-1),I=y.slice(R-1)),[E,I]},re=(0,l.useMemo)(function(){return me(w)},[w]),fe=(0,Y.Z)(re,2),se=fe[0],ue=fe[1];return l.createElement("div",{className:J,style:Ee},se.map(function(n,y){var E=n.name,I=n.key,ie=n.onClick,de=n.path,ce=l.createElement("a",{style:{marginRight:18},key:I,onClick:de?function(){return t.m8.push(de)}:ie},E);return y!==pe-1?l.createElement(l.Fragment,{key:I},ce):ce}),ue.length>0&&l.createElement(W.Z,{overlay:l.createElement(g.Z,null,ue.map(function(n){return l.createElement(g.Z.Item,{onClick:n.path?function(){return t.m8.push(n.path)}:function(){var y;return(y=n.onClick)===null||y===void 0?void 0:y.call(n)}},n.name)}))},l.createElement("a",null,"\u66F4\u591A")))}},57044:function(H,U,e){"use strict";var ne=e(87753),W=e(98570),ae=e(67294);U.Z=function(g){var Y=g.value,l=g.onChange,t=g.treeData,Z=t===void 0?[]:t,G=function(R){l==null||l(R)};return ae.createElement(W.Z,{checkable:!0,defaultExpandAll:!0,onCheck:function(R){return G(R)},checkedKeys:Y,treeData:Z})}},84850:function(H,U,e){"use strict";e.d(U,{Z:function(){return ae}});var ne=e(44742),W=e(67294);function ae(){var g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,Y=(0,W.useState)(!1),l=(0,ne.Z)(Y,2),t=l[0],Z=l[1],G=(0,W.useState)(""),x=(0,ne.Z)(G,2),R=x[0],J=x[1];return(0,W.useEffect)(function(){Z(g)},[]),{spinning:t,setSpinning:Z,tip:R,setTip:J}}},29840:function(H,U,e){"use strict";e.r(U),e.d(U,{default:function(){return Ve}});var ne=e(13753),W=e(48429),ae=e(14643),g=e(92909),Y=e(97140),l=e(93228),t=e(67294),Z=e(21191),G=e(49101),x=e(31567),R=e(26780),J=e(46567),Ee=e(58210),w=e(87240),pe=e(37092),me=e(91911),re=e(13378),fe=e(68137),se=e(50532),ue=e(3911),n=e(56361),y=e(67604),E=e(66498),I=e(44742),ie=e(46368),de=e(46391),ce=e(47376),_=e(66827),Ie=e(84850),ve=e(48786),oe=e(66594),Se=e(57044),Ae=e(55632),Ce=e.n(Ae),Ze=e(50189),ye=function(d){var C=[];return d?(Object.keys(d).forEach(function(m){C.push.apply(C,(0,Ze.Z)(d[m].map(function(s){return s.id})))}),C):[]},De=e(27870),Fe={labelCol:{span:3},wrapperCol:{span:20}},Oe={labelCol:{span:3},wrapperCol:{span:10}},Pe=function(d){var C=d.visible,m=d.toggleVisible,s=d.formData,k=d.loading,S=d.reload,o=E.Z.useForm(),A=(0,I.Z)(o,1),c=A[0],f=(0,Ie.Z)(),V=f.tip,X=f.setTip,B=s.id,F=(0,ve.tT)("@@initialState"),K=F.initialState,$=K||{},z=$.authResourceData,v=$.userInfo,O=v||{},u=O.orgCode,r=(0,t.useState)(!1),a=(0,I.Z)(r,2),i=a[0],p=a[1];(0,t.useEffect)(function(){if(!(0,ie.Z)(s)){var T=s||{},N=T.resourceMap,ee=N===void 0?{}:N,te=ye(ee);c.setFieldsValue((0,n.Z)((0,n.Z)({},s),{},{resourceIds:te,modalResourceIds:te}))}return function(){c.resetFields()}},[s]);var M=function(){m(),c.resetFields()},j=function(N){var ee=N.resourceIds,te=ee===void 0?[]:ee,Q=N.modalResourceIds,h=(0,ue.Z)(N,["resourceIds","modalResourceIds"]);X("\u6570\u636E\u4FDD\u5B58\u4E2D\uFF0C\u8BF7\u7A0D\u5019...");var L=(0,De.HO)((0,n.Z)((0,n.Z)({},h),{},{clientKey:oe.OW.clientId,id:B,businessValue:u,resourceIds:te.filter(function(b){return(0,de.Z)(b)})}));return API.authorization.resourceRole.resourceSave.fetch(L)},le=(0,_.QT)(j,{manual:!0,onSuccess:function(){g.default.success("\u4FDD\u5B58\u6210\u529F"),c.resetFields(),m(),S==null||S()}}),P=le.run,q=le.loading;return t.createElement(E.Z,(0,re.Z)({form:c,onFinish:P},Oe),t.createElement(J.Z,{centered:!0,visible:C,forceRender:!0,maskClosable:!1,title:"".concat((0,ce.Z)(B)?"\u65B0\u5EFA":"\u7F16\u8F91","\u89D2\u8272"),okButtonProps:{htmlType:"submit"},width:800,onOk:function(){return c.submit()},onCancel:M,confirmLoading:q},t.createElement(w.Z,{spinning:k&&q,tip:V},t.createElement(E.Z.Item,{label:"\u89D2\u8272\u540D\u79F0",name:"role",rules:[{whitespace:!0},{required:!0}]},t.createElement(se.Z,{placeholder:"\u8BF7\u8F93\u5165"})),t.createElement(E.Z.Item,(0,re.Z)({label:"\u89D2\u8272\u63CF\u8FF0",name:"comment"},Fe,{rules:[{whitespace:!0}]}),t.createElement(se.Z,{placeholder:"\u8BF7\u8F93\u5165"})),t.createElement("div",{className:Ce().treeWrap},t.createElement("div",{className:Ce().cover,onClick:function(){return p(!0)}}),t.createElement(E.Z.Item,{label:"\u62E5\u6709\u8D44\u6E90",name:"resourceIds",rules:[{required:!0}]},t.createElement(me.Z,{treeData:z,allowClear:!0,multiple:!0,placeholder:"\u8BF7\u9009\u62E9"}))))),t.createElement(J.Z,{centered:!0,visible:i,forceRender:!0,maskClosable:!1,title:"\u62E5\u6709\u8D44\u6E90",width:412,onOk:function(){c.setFieldsValue({resourceIds:c.getFieldValue("modalResourceIds")}),p(!1)},onCancel:function(){c.setFieldsValue({modalResourceIds:c.getFieldValue("resourceIds")}),p(!1)},confirmLoading:q},t.createElement(E.Z.Item,{label:"\u62E5\u6709\u8D44\u6E90",name:"modalResourceIds",noStyle:!0},t.createElement(Se.Z,{treeData:z}))))},Te=Pe,je=e(66518),Me=e(95322),Qe=e(44862),Le=e(42091),be=e(3855),We=e(84664),he=e.n(We),ge=e(89193),xe={page:1,pageSize:6},Be={labelCol:{span:6},wrapperCol:{span:16}},Ke=function(D){var d=D.visible,C=D.toggleVisible,m=D.formData,s=D.reload,k=E.Z.useForm(),S=(0,I.Z)(k,1),o=S[0],A=(0,Ie.Z)(),c=A.tip,f=A.setTip,V=m.id,X=(0,t.useState)([]),B=(0,I.Z)(X,2),F=B[0],K=B[1],$=(0,ge.x)(xe),z=(0,I.Z)($,2),v=z[0],O=z[1],u=(0,_.QT)(API.platform.sysUser.pageList.fetch,{manual:!0}),r=u.data,a=u.run,i=u.loading,p=(0,_.QT)(API.authorization.resourceRole.resourceRoleDetailUser.fetch,{manual:!0,onSuccess:function(h){var L=h.userIdList,b=L===void 0?[]:L;K(b)}}),M=p.run,j=p.loading;(0,t.useEffect)(function(){d&&(a(v),M({clientKey:oe.OW.clientId,roleId:V}))},[d,v]),(0,t.useEffect)(function(){return(0,ie.Z)(m)||o.setFieldsValue((0,n.Z)({},m)),function(){o.resetFields()}},[m]);var le=function(){C(),o.resetFields()},P=function(){return f("\u6570\u636E\u4FDD\u5B58\u4E2D\uFF0C\u8BF7\u7A0D\u5019..."),API.authorization.resourceRole.resourceSaveAddUser.fetch({clientKey:oe.OW.clientId,id:V,userIds:F.map(function(h){return+h}),resourceIds:m.resourceIds,role:m.role})},q=(0,_.QT)(P,{manual:!0,onSuccess:function(){g.default.success("\u6388\u6743\u6210\u529F"),o.resetFields(),C(),s==null||s()}}),T=q.run,N=q.loading,ee=function(h,L){var b=(0,Ze.Z)(F);h.target.checked?b.push(+L.userId):b=b.filter(function($e){return $e!==L.userId}),K(b)},te=function(h){return t.createElement(Me.ZP.Item,null,t.createElement(Le.Z,{checked:F.includes(+h.userId),onChange:function(b){return ee(b,h)}},t.createElement("div",{className:he().userName},h.userName,h.phone?"(".concat(h.phone.slice(-4),")"):"")))};return t.createElement(J.Z,{centered:!0,visible:d,forceRender:!0,maskClosable:!1,title:"\u7528\u6237\u6388\u6743",okButtonProps:{htmlType:"submit"},width:442,onOk:function(){return o.submit()},onCancel:le,confirmLoading:N,wrapClassName:"auth-modal"},t.createElement(w.Z,{spinning:i&&N&&j,tip:c},t.createElement(E.Z,(0,re.Z)({form:o,onFinish:T},Be,{className:he().formWrap}),t.createElement(E.Z.Item,{label:"\u4F01\u4E1A\u7F16\u7801",name:"account",tooltip:{icon:t.createElement(be.Z,null),title:"\u4F01\u4E1A\u7F16\u7801\u5C06\u4F5C\u4E3A\u4F01\u4E1A\u4E0B\u6240\u6709\u8D26\u53F7\u540E\u7F00"},noStyle:!0},t.createElement(Me.ZP,{loading:i,className:he().listWrap,size:"small",dataSource:r==null?void 0:r.list,pagination:(0,n.Z)((0,n.Z)({},v),{},{current:v.page,onChange:function(h){O(function(L){L.page=h})},showQuickJumper:!0}),renderItem:te})))))},ze=e(68699),Ne=e(94043),Re=e.n(Ne),Ue=function(){var D=(0,t.useRef)(),d=(0,ge.x)({visible:!1,formData:{},loading:!1}),C=(0,I.Z)(d,2),m=C[0],s=C[1],k=(0,ge.x)({visible:!1,formData:{}}),S=(0,I.Z)(k,2),o=S[0],A=S[1],c=D.current||{},f=c.reload,V=(0,_.QT)(API.authorization.role.update.fetch,{manual:!0,onSuccess:function(){g.default.success("\u64CD\u4F5C\u6210\u529F"),f==null||f()}}),X=V.run,B=(0,_.QT)(API.authorization.resourceRole.resourceDelete.fetch,{manual:!0,onSuccess:function(){g.default.success("\u5220\u9664\u6210\u529F"),f==null||f()}}),F=B.run,K=function(){var u=(0,ze.Z)(Re().mark(function r(a){var i,p,M,j;return Re().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return P.next=2,API.platform.sysRole.pageList.fetch((0,De.HO)((0,n.Z)((0,n.Z)({},a),{},{page:(a==null?void 0:a.current)||oe.ii.page,pageSize:(a==null?void 0:a.pageSize)||oe.ii.pageSize})));case 2:return i=P.sent,p=i.list,M=i.page,j=i.total,P.abrupt("return",{data:p||[],page:M,success:!0,total:j});case 7:case"end":return P.stop()}},r)}));return function(a){return u.apply(this,arguments)}}(),$=function(r){s(function(a){a.visible=!0,a.loading=!0,a.formData=r})},z=function(){s(function(r){r.visible=!0,r.formData={}})},v=function(r){var a=r||{},i=a.resourceMap,p=ye(i);A(function(M){M.visible=!0,M.formData=(0,n.Z)((0,n.Z)({},r),{},{resourceIds:p})})},O=function(r){var a={edit:s,auth:A};a[r](function(i){i.visible=!1,i.loading=!1,i.formData={}})};return{actionRef:D,reload:f,editModalConfig:m,setEditModalConfig:s,authModalConfig:o,setAuthModalConfig:A,handleDisable:X,handleDelete:F,fetchList:K,handleRoleEdit:$,handleRoleAdd:z,handleAuthorize:v,handleModalHide:O}},Ve=function(){var D=(0,ve.tT)("@@initialState"),d=D.initialState,C=d||{},m=C.userInfo,s=m===void 0?{}:m,k=(0,ve.tT)("company"),S=k.companyMapOptions,o=Ue(),A=o.actionRef,c=o.reload,f=o.editModalConfig,V=o.fetchList,X=o.handleRoleAdd,B=o.handleRoleEdit,F=o.handleModalHide,K=o.authModalConfig,$=o.handleAuthorize,z=[{title:"\u4F01\u4E1A\u540D\u79F0",dataIndex:"orgCode",align:"left",copyable:!1,valueType:"text",hideInSearch:!!s.orgId,hideInTable:!0,renderFormItem:function(){return t.createElement(l.Z,{allowClear:!0,options:S})}},{title:"\u89D2\u8272\u540D\u79F0",dataIndex:"role",align:"left",copyable:!1,valueType:"text",hideInSearch:!1},{title:"\u89D2\u8272\u63CF\u8FF0",dataIndex:"comment",align:"left",copyable:!1,valueType:"text",hideInSearch:!0},{title:"\u62E5\u6709\u8D44\u6E90",dataIndex:"resourceList",align:"left",copyable:!1,valueType:"text",hideInSearch:!0,render:function(O,u){var r=u||{},a=r.resourceMap,i=a===void 0?[]:a,p=[];return Object.keys(i).forEach(function(M){i[M].forEach(function(j){p.push(j.description)})}),p.join(",")}},{title:"\u64CD\u4F5C",dataIndex:"id",align:"left",copyable:!1,valueType:"text",hideInSearch:!0,render:function(O,u){return t.createElement(x.Z,{buttons:[{name:"\u7F16\u8F91",key:"edit",onClick:function(){return B(u)}},{name:"\u6388\u6743",key:"authorize",onClick:function(){return $(u)}}]})}}];return t.createElement(t.Fragment,null,t.createElement(Z.ZP,{style:{padding:"18px 22px"},actionRef:A,request:V,onRequestError:function(O){console.error(O.message),g.default.error("\u6570\u636E\u52A0\u8F7D\u5931\u8D25,".concat(O.message))},columns:z,bordered:!0,rowKey:"id",pagination:{size:"default"},dateFormatter:"string",headerTitle:"\u83DC\u5355\u6743\u9650\u5217\u8868",tableAlertRender:!1,toolBarRender:function(){return[t.createElement(W.Z,{onClick:X,key:"add",type:"primary"},t.createElement(G.Z,null),"\u65B0\u5EFA")]}}),t.createElement(Te,{visible:f.visible,formData:f.formData,loading:f.loading,toggleVisible:function(){return F("edit")},reload:c}),t.createElement(Ke,{visible:K.visible,formData:K.formData,toggleVisible:function(){return F("auth")},reload:c}))}}}]);
