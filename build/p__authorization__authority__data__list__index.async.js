"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[241],{62571:function(e,n,t){var i=t(5574),a=t.n(i),r=t(67294),o=t(13013),l=t(66516),s=t(84354),u=t(85893);n.Z=function(e){var n=e.buttons,t=e.maxNumber,i=void 0===t?2:t,c=e.className,d=e.style,f=n.filter((function(e){return!e.hidden})),p=f.length,h=(0,r.useMemo)((function(){return function(e){var n=e,t=[];return e.length>i&&(n=e.slice(0,i-1),t=e.slice(i-1)),[n,t]}(f)}),[f]),m=a()(h,2),v=m[0],g=m[1];return(0,u.jsxs)("div",{className:c,style:d,children:[v.map((function(e,n){var t=e.name,i=e.key,a=e.onClick,o=e.path,l=(0,u.jsx)("a",{style:{marginRight:18},onClick:o?function(){return s.history.push(o)}:a,children:t},i);return n!==p-1?(0,u.jsx)(r.Fragment,{children:l},i):l})),g.length>0&&(0,u.jsx)(o.Z,{overlay:(0,u.jsx)(l.Z,{children:g.map((function(e){return(0,u.jsx)(l.Z.Item,{onClick:e.path?function(){return s.history.push(e.path)}:function(){var n;return null===(n=e.onClick)||void 0===n?void 0:n.call(e)},children:e.name})}))}),children:(0,u.jsx)("a",{children:"更多"})})]})}},73011:function(e,n,t){t.d(n,{Z:function(){return r}});var i=t(67294),a=t(84354);function r(e){var n=((0,a.useModel)("@@initialState").initialState||{}).privileges,t=void 0===n?[]:n;return{showCompanySelect:(0,i.useMemo)((function(){return t.some((function(n){return n.resourceKey===e}))}),[t,e])}}},59360:function(e,n,t){t.d(n,{Z:function(){return o}});var i=t(5574),a=t.n(i),r=t(67294);function o(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=(0,r.useState)(!1),t=a()(n,2),i=t[0],o=t[1],l=(0,r.useState)(""),s=a()(l,2),u=s[0],c=s[1];return(0,r.useEffect)((function(){o(e)}),[]),{spinning:i,setSpinning:o,tip:u,setTip:c}}},7219:function(e,n,t){t.r(n),t.d(n,{default:function(){return ue}});var i=t(67294),a=t(71230),r=t(15746),o=t(34041),l=t(12461),s=t(71577),u=t(9308),c=t(24969),d=t(62571),f=t(97857),p=t.n(f),h=t(5574),m=t.n(h),v=t(66490),g=t(74348),b=t(11382),x=t(11486),y=t(79697),C=t(27601),Z=t(86317),I=t(59360),j=t(41712),_=t(84354),S=t(85893),k={labelCol:{span:3},wrapperCol:{span:20}},T={labelCol:{span:3},wrapperCol:{span:10}},M=function(e){var n=e.visible,t=e.toggleVisible,a=e.formData,r=e.loading,s=e.reload,u=e.clientKey,c=e.scopeMap,d=e.scopeMapOptions,f=e.orgCode,h=e.disabledAction,M=v.Z.useForm(),R=m()(M,1)[0],w=(0,I.Z)(),D=w.tip,N=w.setTip,P=a.id,A=(((0,_.useModel)("@@initialState").initialState||{}).userInfo||{}).orgCode;(0,i.useEffect)((function(){if(!(0,y.Z)(a)){var e=(a||{}).dataRuleDTOList,n=(void 0===e?[]:e).map((function(e){return e.ruleKeyId}));R.setFieldsValue(p()(p()({},a),{},{ruleIdList:n}))}return function(){R.resetFields()}}),[a]);var K=(0,i.useMemo)((function(){var e={};return c?(c.forEach((function(n){var t=n.id,i=n.ruleKeyId;(0,C.Z)(i)||(e[i]=t)})),e):e}),[c]),E=(0,Z.QT)((function(e){var n,t;N("数据保存中，请稍候...");var i=(0,j.HO)(p()(p()({},e),{},{clientKey:u,id:P,ruleIdList:null!==(n=null==e||null===(t=e.ruleIdList)||void 0===t?void 0:t.map((function(e){return K[e]})))&&void 0!==n?n:[],businessValue:null!=f?f:A}));return API.platform.sysRole.roleDataSave.fetch(i)}),{manual:!0,onSuccess:function(){l.ZP.success("保存成功"),R.resetFields(),t(),null==s||s()}}),L=E.run,O=E.loading;return(0,S.jsx)(g.Z,{centered:!0,visible:n,forceRender:!0,maskClosable:!1,title:"".concat((0,C.Z)(P)?"新建":"编辑","角色"),okButtonProps:{htmlType:"submit",disabled:h},width:800,onOk:function(){return R.submit()},onCancel:function(){t(),R.resetFields()},confirmLoading:O,children:(0,S.jsx)(b.Z,{spinning:r&&O,tip:D,children:(0,S.jsxs)(v.Z,p()(p()({form:R,onFinish:L},T),{},{children:[(0,S.jsx)(v.Z.Item,{label:"角色名称",name:"role",rules:[{whitespace:!0},{required:!0}],children:(0,S.jsx)(x.Z,{placeholder:"请输入"})}),(0,S.jsx)(v.Z.Item,p()(p()({label:"角色描述",name:"comment"},k),{},{rules:[{whitespace:!0}],children:(0,S.jsx)(x.Z,{placeholder:"请输入"})})),(0,S.jsx)(v.Z.Item,{label:"限制菜单",name:"ruleIdList",rules:[{required:!0}],children:(0,S.jsx)(o.Z,{mode:"multiple",placeholder:"请选择",options:d})})]}))})})},R=t(19632),w=t.n(R),D=t(95507),N=t(32808),P="formWrap___xxVJP",A="listWrap___vt4o2",K="userName___zd8hP",E=t(60106),L={page:1,pageSize:6},O={labelCol:{span:6},wrapperCol:{span:16}},V=function(e){var n=e.visible,t=e.toggleVisible,a=e.formData,r=e.reload,o=e.orgId,s=e.clientKey,u=e.disabledAction,c=(((0,_.useModel)("@@initialState").initialState||{}).userInfo||{}).orgId,d=v.Z.useForm(),f=m()(d,1)[0],h=(0,I.Z)(),x=h.tip,C=h.setTip,k=a.id,T=(0,i.useState)([]),M=m()(T,2),R=M[0],V=M[1],F=(0,E.x)(L),z=m()(F,2),Q=z[0],B=z[1],W=(0,Z.QT)(API.platform.sysUser.pageList.fetch,{manual:!0}),q=W.data,H=W.run,J=W.loading,U=(0,Z.QT)(API.authorization.dataRole.listBoundUser.fetch,{manual:!0,onSuccess:function(e){return V(e)}}),G=U.run,X=U.loading;(0,i.useEffect)((function(){n&&(H(p()(p()({},Q),{},{orgId:o||c})),G({roleId:k}))}),[o,c,n,Q]),(0,i.useEffect)((function(){return(0,y.Z)(a)||f.setFieldsValue(p()({},a)),function(){f.resetFields()}}),[a]);var Y=(0,Z.QT)((function(){return C("数据保存中，请稍候..."),API.platform.sysRole.bindUserByRole.fetch((0,j.HO)({roleId:k,userIdList:R.map((function(e){return+e})),clientKey:s}))}),{manual:!0,onSuccess:function(){l.ZP.success("授权成功"),f.resetFields(),t(),null==r||r()}}),$=Y.run,ee=Y.loading;return(0,S.jsx)(g.Z,{centered:!0,visible:n,forceRender:!0,maskClosable:!1,title:"用户授权",okButtonProps:{htmlType:"submit",disabled:u},width:442,onOk:function(){return f.submit()},onCancel:function(){t(),f.resetFields()},confirmLoading:ee,wrapClassName:"auth-modal",children:(0,S.jsx)(b.Z,{spinning:J&&ee&&X,tip:x,children:(0,S.jsx)(v.Z,p()(p()({form:f,onFinish:$},O),{},{className:P,children:(0,S.jsx)(v.Z.Item,{noStyle:!0,children:(0,S.jsx)(D.ZP,{loading:J,className:A,size:"small",dataSource:null==q?void 0:q.list,pagination:p()(p()({},Q),{},{current:Q.page,onChange:function(e){B((function(n){n.page=e}))},showQuickJumper:!0}),renderItem:function(e){return(0,S.jsx)(D.ZP.Item,{children:(0,S.jsx)(N.Z,{checked:R.includes(+e.userId),onChange:function(n){return function(e,n){var t=w()(R);e.target.checked?t.push(+n.userId):t=t.filter((function(e){return e!==n.userId})),V(t)}(n,e)},children:(0,S.jsxs)("div",{className:K,children:[e.name,e.phone?"(".concat(e.phone.slice(-4),")"):""]})})})}})})}))})})},F=t(15009),z=t.n(F),Q=t(99289),B=t.n(Q),W="searchWrap___LUacy",q="formItemWrap___qzWMo",H="label___UoKWz",J="inputWrap___jOrGL",U=t(29634),G=t(94184),X=t.n(G),Y=t(96486),$="contentWrap___cQTXD",ee="left___oi6TK",ne="selectItem___E4rF9",te="label___frEZd",ie="selected___NV5nG",ae="right___cTJT6",re=t(64825),oe=function(e){var n=e.visible,t=e.toggleVisible,a=e.formData,r=e.reload,o=e.clientKey,s=e.orgCode,u=e.disabledAction,c=v.Z.useForm(),d=m()(c,1)[0],f=(0,I.Z)(),h=f.tip,x=f.setTip,C=a.dataRuleDTOList,_=void 0===C?[]:C,k=a.id,T=a.businessValue,M=(0,i.useState)(),R=m()(M,2),w=R[0],D=R[1],N=(0,i.useState)([]),P=m()(N,2),A=P[0],K=P[1],E=(0,i.useRef)();(0,i.useEffect)((function(){(0,y.Z)(_)||D(_[0].id)}),[_]);var L=(0,Z.QT)(API.authorization.data.detail.fetch,{manual:!0,onSuccess:function(e){var n=e.businessValueList,t=void 0===n?[]:n;K(t),E.current=t}}),O=L.run,V=L.loading;(0,i.useEffect)((function(){n&&w&&O({ruleId:w})}),[n,w]);var F=(0,Z.QT)(le,{manual:!0}),z=F.data,Q=F.run;(0,i.useEffect)((function(){if(n){var e=((null==_?void 0:_.find((function(e){return e.id===w})))||{}).originRuleInterface,t=void 0===e?"":e;t&&Q(t,(0,j.HO)({orgCode:s}))}}),[n,w]);var B=(0,Z.QT)((function(){x("数据保存中，请稍候...");var e=_.find((function(e){return e.id===w}));return API.platform.sysRole.ruleDataSave.fetch(p()(p()({},e),{},{businessValue:T,roleId:k,clientKey:o,id:w,businessValueList:null!=A?A:[]}))}),{manual:!0,onSuccess:function(){l.ZP.success("设置成功"),d.resetFields(),t(),null==r||r()}}),W=B.run,q=B.loading,H={selectedRowKeys:null!=A?A:[],onChange:function(e){K(e)}};return(0,S.jsx)(g.Z,{centered:!0,visible:n,forceRender:!0,maskClosable:!1,title:"设置范围",okButtonProps:{htmlType:"submit",disabled:u},width:640,onOk:W,onCancel:function(){t(),d.resetFields()},okText:"提交",cancelText:"重置",cancelButtonProps:{onClick:function(){K([])}},confirmLoading:q,wrapClassName:"scope-modal",children:(0,S.jsx)(b.Z,{spinning:q,tip:h,children:(0,S.jsxs)("div",{className:$,children:[(0,S.jsx)("div",{className:ee,children:_.map((function(e){return(0,S.jsx)("div",{className:ne,children:(0,S.jsx)("span",{className:X()(te,w===e.id?ie:{}),onClick:function(){(0,Y.isEqual)(A||[],E.current||[])?D(e.id):l.ZP.error("请先保存再切换规则！")},children:e.ruleName})})}))}),(0,S.jsx)("div",{className:ae,children:(0,S.jsx)(U.Z,{loading:V,rowSelection:H,columns:[{title:"名称",dataIndex:"name"},{title:"创建人",dataIndex:"createdBy"},{title:"创建时间",dataIndex:"createdAt"}],dataSource:z,rowKey:function(e){return"".concat(e.id)}})})]})})})},le=function(){var e=B()(z()().mark((function e(n){var t,i,a,r=arguments;return z()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>1&&void 0!==r[1]?r[1]:{},e.prev=1,e.next=4,(0,re.E)();case 4:return i=e.sent,e.next=7,i.get(n,{headers:{"Content-Type":"application/json"},params:t});case 7:if(!(a=e.sent)){e.next=16;break}if(a.success){e.next=13;break}throw new Error(JSON.stringify(a));case 13:return e.abrupt("return",a.data||void 0);case 14:e.next=17;break;case 16:throw new Error(JSON.stringify({message:"接口未响应"}));case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(1),l.ZP.error("列表接口请求失败！");case 22:case"end":return e.stop()}}),e,null,[[1,19]])})));return function(n){return e.apply(this,arguments)}}(),se=t(73011),ue=function(){var e,n=function(){var e=(0,i.useRef)(),n=(0,i.useState)(""),t=m()(n,2),a=t[0],r=t[1],o=(0,i.useState)(""),s=m()(o,2),u=s[0],c=s[1],d=((0,_.useModel)("@@initialState").initialState||{}).userInfo,f=(d||{}).orgCode,h=u!==f,v=(0,E.x)({visible:!1,formData:{},loading:!1}),g=m()(v,2),b=g[0],x=g[1],y=(0,E.x)({visible:!1,formData:{}}),C=m()(y,2),I=C[0],S=C[1],k=(0,E.x)({visible:!1,formData:{}}),T=m()(k,2),M=T[0],R=T[1],w=(e.current||{}).reload;(0,i.useEffect)((function(){null!=d&&d.orgCode&&c(null==d?void 0:d.orgCode)}),[d]);var D=(0,Z.QT)((function(){return API.platform.sysRole.myRuleList.fetch({clientKey:a,orgCode:u||(null==d?void 0:d.orgCode)})}),{refreshDeps:[a],ready:!!a}).data,N=(0,i.useMemo)((function(){return(0,j.bu)(D,{labelMapping:"ruleName",codeMapping:"ruleKeyId"})}),[D]),P=(0,Z.QT)(API.authorization.role.update.fetch,{manual:!0,onSuccess:function(){l.ZP.success("操作成功"),null==w||w()}}).run,A=(0,Z.QT)(API.authorization.resourceRole.resourceDelete.fetch,{manual:!0,onSuccess:function(){l.ZP.success("删除成功"),null==w||w()}}).run,K=function(){var e=B()(z()().mark((function e(n){var t,i,r,o;return z()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!a){e.next=8;break}return e.next=3,API.authorization.dataRole.listPagination.fetch((0,j.HO)(p()(p()({},n),{},{clientKey:a,businessValue:u||(null==d?void 0:d.orgCode)})));case 3:return t=e.sent,i=t.list,r=t.page,o=t.total,e.abrupt("return",{data:i||[],page:r,success:!0,total:o});case 8:return e.abrupt("return",{data:[]});case 9:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return{scopeMap:D,actionRef:e,disabledAction:h,reload:w,clientKey:a,setClientKey:r,businessValue:u,setBusinessValue:c,scopeMapOptions:N,editModalConfig:b,setEditModalConfig:x,authModalConfig:I,scopeModalConfig:M,setAuthModalConfig:S,handleDisable:P,handleDelete:A,handleScopeSet:function(e){R((function(n){n.visible=!0,n.formData=e}))},fetchList:K,handleRoleEdit:function(e){x((function(n){n.visible=!0,n.loading=!0,n.formData=e}))},handleRoleAdd:function(){x((function(e){e.visible=!0,e.formData={}}))},handleAuthorize:function(e){S((function(n){n.visible=!0,n.formData=e}))},handleModalHide:function(e){({edit:x,auth:S,scope:R})[e]((function(e){e.visible=!1,e.loading=!1,e.formData={}}))}}}(),t=n.actionRef,f=n.reload,h=n.clientKey,v=n.disabledAction,g=n.setClientKey,b=n.businessValue,x=n.setBusinessValue,y=n.scopeMap,C=n.scopeMapOptions,I=n.editModalConfig,k=n.fetchList,T=n.handleRoleAdd,R=n.handleRoleEdit,w=n.handleScopeSet,D=n.handleModalHide,N=n.authModalConfig,P=n.scopeModalConfig,A=n.handleAuthorize,K=(0,_.useModel)("business").businessMapOptions,L=(0,se.Z)("cloud_authority_data_company").showCompanySelect,O=(0,_.useModel)("company"),F=O.companyMapOptions,Q=O.companyMap;(0,i.useEffect)((function(){(0,Y.isEmpty)(K)||g(K[0].value)}),[K]);var U=[{title:"角色名称",dataIndex:"roleName",align:"left",copyable:!1,valueType:"text",hideInSearch:!1,hideInTable:!0},{title:"角色名称",dataIndex:"role",align:"left",copyable:!1,valueType:"text",hideInSearch:!0},{title:"角色描述",dataIndex:"comment",align:"left",copyable:!1,valueType:"text",hideInSearch:!0},{title:"限制菜单",dataIndex:"dataRuleDTOList",align:"left",copyable:!1,valueType:"text",hideInSearch:!0,render:function(e,n){var t=(n||{}).dataRuleDTOList;return(void 0===t?[]:t).map((function(e){return e.ruleName})).join(",")}},{title:"操作",align:"left",copyable:!1,valueType:"text",hideInSearch:!0,render:function(e,n){return(0,S.jsx)(d.Z,{buttons:[{name:"编辑",key:"edit",onClick:function(){return R(n)}},{name:"授权",key:"authorize",onClick:function(){return A(n)}},{name:"设置范围",key:"scope",onClick:function(){return w(n)}}]})}}];return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("div",{className:W,children:(0,S.jsxs)(a.Z,{children:[L&&(0,S.jsxs)(r.Z,{span:"6",className:q,children:[(0,S.jsx)("div",{className:H,children:"企业名称："}),(0,S.jsx)("div",{className:J,children:(0,S.jsx)(o.Z,{value:b,onChange:function(e){x(e),null==f||f()},allowClear:!0,placeholder:"请选择",options:F})})]}),(0,S.jsxs)(r.Z,{span:"6",className:q,children:[(0,S.jsx)("div",{className:H,children:"子系统："}),(0,S.jsx)("div",{className:J,children:(0,S.jsx)(o.Z,{value:h,onChange:function(e){g(e),null==f||f()},allowClear:!0,placeholder:"请选择",options:K})})]})]})}),(0,S.jsx)(u.ZP,{style:{padding:"18px 22px"},actionRef:t,request:k,onRequestError:function(e){console.error(e.message),l.ZP.error("数据加载失败,".concat(e.message))},onReset:function(){x(""),g("")},columns:U,bordered:!0,rowKey:"id",dateFormatter:"string",headerTitle:"数据权限列表",tableAlertRender:!1,toolBarRender:function(){return[(0,S.jsxs)(s.Z,{onClick:T,type:"primary",children:[(0,S.jsx)(c.Z,{}),"新建"]},"add")]}}),(0,S.jsx)(M,{visible:I.visible,formData:I.formData,loading:I.loading,toggleVisible:function(){return D("edit")},reload:f,clientKey:h,scopeMap:y,scopeMapOptions:C,orgCode:b,disabledAction:v}),(0,S.jsx)(V,{visible:N.visible,formData:N.formData,toggleVisible:function(){return D("auth")},reload:f,clientKey:h,disabledAction:v,orgId:null==Q||null===(e=Q.find((function(e){return e.orgCode===b})))||void 0===e?void 0:e.id}),(0,S.jsx)(oe,{visible:P.visible,formData:P.formData,toggleVisible:function(){return D("scope")},reload:f,clientKey:h,disabledAction:v,orgCode:b})]})}},27601:function(e,n){n.Z=function(e){return null==e}}}]);