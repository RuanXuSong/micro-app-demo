(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[491],{84664:function(w){w.exports={formWrap:"formWrap___276Lb",rowWrap:"rowWrap___1Q2qE",listWrap:"listWrap___2GzdK",userName:"userName___3K3PK"}},31567:function(w,V,e){"use strict";var q=e(19597),N=e(2291),re=e(37482),R=e(3810),t=e(44742),d=e(67294),j=e(48786);V.Z=function(A){var _=A.buttons,T=A.maxNumber,Q=T===void 0?2:T,H=A.className,se=A.style,Y=_.filter(function(l){return!l.hidden}),k=Y.length,ue=function(m){var G=m,g=[];return m.length>Q&&(G=m.slice(0,Q-1),g=m.slice(Q-1)),[G,g]},ee=(0,d.useMemo)(function(){return ue(Y)},[Y]),c=(0,t.Z)(ee,2),ie=c[0],C=c[1];return d.createElement("div",{className:H,style:se},ie.map(function(l,m){var G=l.name,g=l.key,te=l.onClick,ne=l.path,b=d.createElement("a",{style:{marginRight:18},key:g,onClick:ne?function(){return j.m8.push(ne)}:te},G);return m!==k-1?d.createElement(d.Fragment,{key:g},b):b}),C.length>0&&d.createElement(N.Z,{overlay:d.createElement(R.Z,null,C.map(function(l){return d.createElement(R.Z.Item,{onClick:l.path?function(){return j.m8.push(l.path)}:function(){var m;return(m=l.onClick)===null||m===void 0?void 0:m.call(l)}},l.name)}))},d.createElement("a",null,"\u66F4\u591A")))}},84850:function(w,V,e){"use strict";e.d(V,{Z:function(){return re}});var q=e(44742),N=e(67294);function re(){var R=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,t=(0,N.useState)(!1),d=(0,q.Z)(t,2),j=d[0],A=d[1],_=(0,N.useState)(""),T=(0,q.Z)(_,2),Q=T[0],H=T[1];return(0,N.useEffect)(function(){A(R)},[]),{spinning:j,setSpinning:A,tip:Q,setTip:H}}},88491:function(w,V,e){"use strict";e.r(V),e.d(V,{default:function(){return Le}});var q=e(13753),N=e(48429),re=e(14643),R=e(92909),t=e(67294),d=e(21191),j=e(49101),A=e(31567),_=e(26780),T=e(46567),Q=e(58210),H=e(87240),se=e(37092),Y=e(91911),k=e(13378),ue=e(68137),ee=e(50532),c=e(56361),ie=e(67604),C=e(66498),l=e(44742),m=e(46368),G=e(47376),g=e(66827),te=e(84850),ne=e(48786),b=e(66594),he={labelCol:{span:3},wrapperCol:{span:20}},ge={labelCol:{span:3},wrapperCol:{span:10}},pe=function(n){var S=n.visible,I=n.toggleVisible,o=n.formData,p=n.loading,F=n.reload,O=C.Z.useForm(),f=(0,l.Z)(O,1),u=f[0],B=(0,te.Z)(),v=B.tip,E=B.setTip,Z=o.id,y=(0,ne.tT)("resourceTree"),D=y.resourceData;(0,t.useEffect)(function(){if(!(0,m.Z)(o)){var s=o||{},r=s.resourceList,a=r===void 0?[]:r,i=a.map(function(M){return M.id});u.setFieldsValue((0,c.Z)((0,c.Z)({},o),{},{resourceIds:i}))}return function(){u.resetFields()}},[o]);var L=function(){I(),u.resetFields()},U=function(r){E("\u6570\u636E\u4FDD\u5B58\u4E2D\uFF0C\u8BF7\u7A0D\u5019...");var a=(0,c.Z)((0,c.Z)({},r),{},{clientKey:b.OW.clientId,id:Z,role:o.role});return API.authorization.resourceRole.resourceSave.fetch(a)},P=(0,g.QT)(U,{manual:!0,onSuccess:function(){R.default.success("\u4FDD\u5B58\u6210\u529F"),u.resetFields(),I(),F==null||F()}}),W=P.run,J=P.loading;return t.createElement(T.Z,{centered:!0,visible:S,forceRender:!0,maskClosable:!1,title:"".concat((0,G.Z)(Z)?"\u65B0\u5EFA":"\u7F16\u8F91","\u89D2\u8272"),okButtonProps:{htmlType:"submit"},width:800,onOk:function(){return u.submit()},onCancel:L,confirmLoading:J},t.createElement(H.Z,{spinning:p&&J,tip:v},t.createElement(C.Z,(0,k.Z)({form:u,onFinish:W},ge),t.createElement(C.Z.Item,{label:"\u89D2\u8272\u540D\u79F0",name:"role",rules:[{whitespace:!0},{required:!0}]},t.createElement(ee.Z,{placeholder:"\u8BF7\u8F93\u5165"})),t.createElement(C.Z.Item,(0,k.Z)({label:"\u89D2\u8272\u63CF\u8FF0",name:"comment"},he,{rules:[{whitespace:!0}]}),t.createElement(ee.Z,{placeholder:"\u8BF7\u8F93\u5165"})),t.createElement(C.Z.Item,{label:"\u62E5\u6709\u8D44\u6E90",name:"resourceIds"},t.createElement(Y.Z,{treeData:D,allowClear:!0,disabled:!1,multiple:!0,placeholder:"\u8BF7\u9009\u62E9",showSearch:!0})))))},Be=e(66518),de=e(95322),We=e(44862),Ee=e(42091),Ce=e(50189),Ie=e(3855),Ze=e(84664),le=e.n(Ze),oe=e(89193),ye={page:1,pageSize:6},De={labelCol:{span:6},wrapperCol:{span:16}},Re=function(n){var S=n.visible,I=n.toggleVisible,o=n.formData,p=n.reload,F=C.Z.useForm(),O=(0,l.Z)(F,1),f=O[0],u=(0,te.Z)(),B=u.tip,v=u.setTip,E=o.id,Z=(0,t.useState)([]),y=(0,l.Z)(Z,2),D=y[0],L=y[1],U=(0,oe.x)(ye),P=(0,l.Z)(U,2),W=P[0],J=P[1],s=(0,g.QT)(API.platform.sysUser.pageList.fetch,{manual:!0}),r=s.data,a=s.run,i=s.loading,M=(0,g.QT)(API.authorization.resourceRole.resourceRoleDetailUser.fetch,{manual:!0,onSuccess:function(h){var z=h.userIdList,K=z===void 0?[]:z;L(K)}}),X=M.run,ae=M.loading;(0,t.useEffect)(function(){S&&(a(W),X({clientKey:b.OW.clientId,roleId:E}))},[S,W]),(0,t.useEffect)(function(){return(0,m.Z)(o)||f.setFieldsValue((0,c.Z)({},o)),function(){f.resetFields()}},[o]);var me=function(){I(),f.resetFields()},x=function(){return v("\u6570\u636E\u4FDD\u5B58\u4E2D\uFF0C\u8BF7\u7A0D\u5019..."),API.authorization.resourceRole.resourceSave.fetch({clientKey:b.OW.clientId,id:E,userIds:D.map(function(h){return+h}),resourceIds:o.resourceIds,role:o.role})},fe=(0,g.QT)(x,{manual:!0,onSuccess:function(){R.default.success("\u6388\u6743\u6210\u529F"),f.resetFields(),I(),p==null||p()}}),Pe=fe.run,ve=fe.loading,Te=function(h,z){var K=(0,Ce.Z)(D);h.target.checked?K.push(+z.userId):K=K.filter(function(Oe){return Oe!==z.userId}),L(K)},be=function(h){return t.createElement(de.ZP.Item,null,t.createElement(Ee.Z,{checked:D.includes(+h.userId),onChange:function(K){return Te(K,h)}},t.createElement("div",{className:le().userName},h.userName,h.phone?"(".concat(h.phone.slice(-4),")"):"")))};return t.createElement(T.Z,{centered:!0,visible:S,forceRender:!0,maskClosable:!1,title:"\u7528\u6237\u6388\u6743",okButtonProps:{htmlType:"submit"},width:442,onOk:function(){return f.submit()},onCancel:me,confirmLoading:ve,wrapClassName:"auth-modal"},t.createElement(H.Z,{spinning:i&&ve&&ae,tip:B},t.createElement(C.Z,(0,k.Z)({form:f,onFinish:Pe},De,{className:le().formWrap}),t.createElement(C.Z.Item,{label:"\u4F01\u4E1A\u7F16\u7801",name:"account",tooltip:{icon:t.createElement(Ie.Z,null),title:"\u4F01\u4E1A\u7F16\u7801\u5C06\u4F5C\u4E3A\u4F01\u4E1A\u4E0B\u6240\u6709\u8D26\u53F7\u540E\u7F00"},noStyle:!0},t.createElement(de.ZP,{loading:i,className:le().listWrap,size:"small",dataSource:r==null?void 0:r.list,pagination:(0,c.Z)((0,c.Z)({},W),{},{current:W.page,onChange:function(h){J(function(z){z.page=h})},showQuickJumper:!0}),renderItem:be})))))},Me=e(68699),Ae=e(94043),ce=e.n(Ae),Se=e(27870),Fe=function(){var n=(0,t.useRef)(),S=(0,oe.x)({visible:!1,formData:{},loading:!1}),I=(0,l.Z)(S,2),o=I[0],p=I[1],F=(0,oe.x)({visible:!1,formData:{}}),O=(0,l.Z)(F,2),f=O[0],u=O[1],B=n.current||{},v=B.reload,E=(0,g.QT)(API.authorization.role.update.fetch,{manual:!0,onSuccess:function(){R.default.success("\u64CD\u4F5C\u6210\u529F"),v==null||v()}}),Z=E.run,y=(0,g.QT)(API.authorization.resourceRole.resourceDelete.fetch,{manual:!0,onSuccess:function(){R.default.success("\u5220\u9664\u6210\u529F"),v==null||v()}}),D=y.run,L=function(){var s=(0,Me.Z)(ce().mark(function r(a){var i,M,X,ae;return ce().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.next=2,API.platform.sysRole.pageList.fetch((0,Se.HO)((0,c.Z)((0,c.Z)({},a),{},{page:(a==null?void 0:a.current)||b.ii.page,pageSize:(a==null?void 0:a.pageSize)||b.ii.pageSize})));case 2:return i=x.sent,M=i.list,X=i.page,ae=i.total,x.abrupt("return",{data:M||[],page:X,success:!0,total:ae});case 7:case"end":return x.stop()}},r)}));return function(a){return s.apply(this,arguments)}}(),U=function(r){p(function(a){a.visible=!0,a.loading=!0,a.formData=r})},P=function(){p(function(r){r.visible=!0,r.formData={}})},W=function(r){var a=r.resourceList,i=a===void 0?[]:a;u(function(M){M.visible=!0,M.formData=(0,c.Z)((0,c.Z)({},r),{},{resourceIds:i.map(function(X){return X.id})})})},J=function(r){var a={edit:p,auth:u};a[r](function(i){i.visible=!1,i.loading=!1,i.formData={}})};return{actionRef:n,reload:v,editModalConfig:o,setEditModalConfig:p,authModalConfig:f,setAuthModalConfig:u,handleDisable:Z,handleDelete:D,fetchList:L,handleRoleEdit:U,handleRoleAdd:P,handleAuthorize:W,handleModalHide:J}},Le=function(){var n=Fe(),S=n.actionRef,I=n.reload,o=n.editModalConfig,p=n.fetchList,F=n.handleRoleAdd,O=n.handleRoleEdit,f=n.handleModalHide,u=n.authModalConfig,B=n.handleAuthorize,v=[{title:"\u89D2\u8272\u540D\u79F0",dataIndex:"role",align:"left",copyable:!1,valueType:"text",hideInSearch:!1},{title:"\u89D2\u8272\u63CF\u8FF0",dataIndex:"comment",align:"left",copyable:!1,valueType:"text",hideInSearch:!0},{title:"\u62E5\u6709\u8D44\u6E90",dataIndex:"resourceList",align:"left",copyable:!1,valueType:"text",hideInSearch:!0,render:function(Z,y){var D=y||{},L=D.resourceList,U=L===void 0?[]:L;return U.map(function(P){return P.description}).join(",")}},{title:"\u64CD\u4F5C",dataIndex:"id",align:"left",copyable:!1,valueType:"text",hideInSearch:!0,render:function(Z,y){return t.createElement(A.Z,{buttons:[{name:"\u7F16\u8F91",key:"edit",onClick:function(){return O(y)}},{name:"\u6388\u6743",key:"authorize",onClick:function(){return B(y)}}]})}}];return t.createElement(t.Fragment,null,t.createElement(d.ZP,{style:{padding:"18px 22px"},actionRef:S,request:p,onRequestError:function(Z){console.error(Z.message),R.default.error("\u6570\u636E\u52A0\u8F7D\u5931\u8D25,".concat(Z.message))},columns:v,bordered:!0,rowKey:"id",pagination:{size:"default"},dateFormatter:"string",headerTitle:"\u83DC\u5355\u6743\u9650\u5217\u8868",tableAlertRender:!1,toolBarRender:function(){return[t.createElement(N.Z,{onClick:F,key:"add",type:"primary"},t.createElement(j.Z,null),"\u65B0\u5EFA")]}}),t.createElement(pe,{visible:o.visible,formData:o.formData,loading:o.loading,toggleVisible:function(){return f("edit")},reload:I}),t.createElement(Re,{visible:u.visible,formData:u.formData,toggleVisible:function(){return f("auth")},reload:I}))}}}]);
