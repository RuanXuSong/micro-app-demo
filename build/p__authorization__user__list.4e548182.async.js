(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[553,722],{46769:function(G){G.exports={formWrap:"formWrap___26yWO",uploadWrap:"uploadWrap___G6C_G"}},31261:function(G,W,e){"use strict";e.d(W,{Z:function(){return w}});var k=e(67294),N=e(48786);function w(I){var $=(0,N.tT)("@@initialState"),q=$.initialState,H=q||{},V=H.privileges,M=V===void 0?[]:V,j=(0,k.useMemo)(function(){return M.some(function(T){return T.resourceKey===I})},[M,I]);return{showCompanySelect:j}}},68504:function(G,W,e){"use strict";e.r(W),e.d(W,{default:function(){return Ze}});var k=e(13753),N=e(48429),w=e(14643),I=e(92909),$=e(68699),q=e(26780),H=e(46567),V=e(97140),M=e(93228),j=e(94043),T=e.n(j),t=e(67294),re=e(87542),i=e(66594),ue=e(49101),K=e(96689),oe=e(31567),Ce=e(58210),se=e(87240),ie=e(13378),Fe=e(68137),b=e(50532),d=e(56361),Me=e(67604),h=e(66498),Q=e(44742),de=e(46368),ce=e(47376),J=e(66827),me=e(84850),ve=e(3678),fe=e(95951),pe=e(32615),he=e(46769),_=e.n(he),X=e(42348),ee=e(27870),Y=e(48786),te={labelCol:{span:6},wrapperCol:{span:16}},ge=function(c){var B=c.visible,E=c.toggleVisible,o=c.formData,S=c.loading,r=c.reload,g=c.orgId,Z=h.Z.useForm(),C=(0,Q.Z)(Z,1),s=C[0],u=(0,me.Z)(),A=u.tip,x=u.setTip,U=o.id,O=(0,Y.tT)("@@initialState"),R=O.initialState,D=R||{},v=D.userInfo,y=v||{},n=y.orgCode,l=(0,Y.tT)("company"),a=l.companyMap;(0,t.useEffect)(function(){return(0,de.Z)(o)||s.setFieldsValue((0,d.Z)((0,d.Z)({},o),{},{avatar:o!=null&&o.avatar?[{uid:"1",name:"\u5934\u50CF",status:"done",url:o==null?void 0:o.avatar,size:0}]:[]})),function(){s.resetFields()}},[o]);var m=(0,t.useMemo)(function(){var F;return a==null||(F=a.find(function(z){return z.id===g}))===null||F===void 0?void 0:F.orgCode},[g]),L=function(){E(),s.resetFields()},f=function(z){x("\u6570\u636E\u4FDD\u5B58\u4E2D\uFF0C\u8BF7\u7A0D\u5019...");var ne=(0,ee.HO)((0,d.Z)((0,d.Z)((0,d.Z)({},o),z),{},{avatar:z.avatar.map(function(le){return le.url||le.response.data.url})[0]}));return U?API.platform.sysUser.update.fetch((0,d.Z)({},ne)):API.platform.sysUser.save.fetch((0,d.Z)((0,d.Z)({},ne),{},{orgId:g}))},P=(0,J.QT)(f,{manual:!0,onSuccess:function(){I.default.success("\u4FDD\u5B58\u6210\u529F"),s.resetFields(),E(),r==null||r()}}),ae=P.run,p=P.loading;return t.createElement(H.Z,{centered:!0,visible:B,forceRender:!0,maskClosable:!1,title:"".concat((0,ce.Z)(U)?"\u65B0\u589E":"\u7F16\u8F91","\u7528\u6237"),okButtonProps:{htmlType:"submit"},width:800,onOk:function(){return s.submit()},onCancel:L,confirmLoading:p},t.createElement(se.Z,{spinning:S&&p,tip:A},t.createElement(h.Z,(0,ie.Z)({form:s,onFinish:ae},te,{className:_().formWrap}),t.createElement(h.Z.Item,{label:"\u767B\u5F55\u8D26\u53F7",name:"userName",tooltip:"11\u4F4D\u4EE5\u5185\u7684\u82F1\u6587\u6570\u5B57",rules:[{whitespace:!0},{required:!0},{validator:X.iE}]},t.createElement(b.Z,{placeholder:"\u8BF7\u8F93\u5165",addonAfter:"@".concat(m!=null?m:n)})),t.createElement(h.Z.Item,{label:"\u7528\u6237\u6635\u79F0",name:"name",rules:[{whitespace:!0},{required:!0}]},t.createElement(b.Z,{placeholder:"\u8BF7\u8F93\u5165"})),t.createElement(h.Z.Item,{label:"\u624B\u673A\u53F7",name:"phone",rules:[{whitespace:!0},{required:!0},{validator:X.tH}]},t.createElement(b.Z,{placeholder:"\u8BF7\u8F93\u5165"})),t.createElement(h.Z.Item,{label:"\u90AE\u7BB1",name:"email",rules:[{whitespace:!0},{validator:X.Le}]},t.createElement(b.Z,{placeholder:"\u8BF7\u8F93\u5165"})),t.createElement("div",{className:_().uploadWrap},t.createElement(ve.Z,{formItemProps:te,label:"\u5934\u50CF",name:"avatar",maxCount:1,accept:fe.b1.\u56FE\u7247.join(","),uploadProps:{listType:"picture-card"},required:!0,requiredMessage:"\u8BF7\u4E0A\u4F20\u5934\u50CF"},t.createElement(pe.Z,null))),t.createElement(h.Z.Item,{label:"\u6027\u522B",name:"sex"},t.createElement(M.Z,{placeholder:"\u8BF7\u9009\u62E9",options:(0,K.MM)(i.TG)})),t.createElement(h.Z.Item,{label:"\u72B6\u6001",name:"status"},t.createElement(M.Z,{placeholder:"\u8BF7\u9009\u62E9",options:(0,K.MM)(i.w6)})))))},ye=e(89193),Ie=function(){var c=(0,t.useRef)(),B=(0,ye.x)({visible:!1,formData:{},loading:!1}),E=(0,Q.Z)(B,2),o=E[0],S=E[1],r=(0,t.useState)(""),g=(0,Q.Z)(r,2),Z=g[0],C=g[1],s=c.current||{},u=s.reload,A=(0,J.QT)(API.platform.sysUser.updateStatus.fetch,{manual:!0,onSuccess:function(){I.default.success("\u64CD\u4F5C\u6210\u529F"),u==null||u()}}),x=A.run,U=(0,J.QT)(API.authorization.resourceRole.resourceDelete.fetch,{manual:!0,onSuccess:function(){I.default.success("\u5220\u9664\u6210\u529F"),u==null||u()}}),O=U.run;(0,t.useEffect)(function(){u==null||u()},[Z]);var R=function(){var n=(0,$.Z)(T().mark(function l(a){var m,L,f,P;return T().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,API.platform.sysUser.pageList.fetch((0,ee.HO)((0,d.Z)((0,d.Z)({},a),{},{page:(a==null?void 0:a.current)||i.ii.page,pageSize:(a==null?void 0:a.pageSize)||i.ii.pageSize,orgId:Z})));case 2:return m=p.sent,L=m.list,f=m.page,P=m.total,p.abrupt("return",{data:L||[],page:f,success:!0,total:P});case 7:case"end":return p.stop()}},l)}));return function(a){return n.apply(this,arguments)}}(),D=function(l){S(function(a){a.visible=!0,a.loading=!0,a.formData=l})},v=function(){S(function(l){l.visible=!0,l.formData={}})},y=function(){return S(function(l){l.visible=!1,l.loading=!1,l.formData={}})};return{actionRef:c,reload:u,editModalConfig:o,orgId:Z,setOrgId:C,handleUpdateStatus:x,handleDelete:O,fetchList:R,handleUserAdd:v,handleUserEdit:D,handleModalHide:y}},Ee=e(31261),Se=function(){var B=(0,Ee.Z)("cloud_user_list_company"),E=B.showCompanySelect,o=(0,Y.tT)("company"),S=o.companyIdMapOptions,r=Ie(),g=r.actionRef,Z=r.reload,C=r.editModalConfig,s=r.orgId,u=r.setOrgId,A=r.fetchList,x=r.handleUpdateStatus,U=r.handleUserAdd,O=r.handleUserEdit,R=r.handleModalHide,D=[{title:"\u4F01\u4E1A\u540D\u79F0",dataIndex:"orgId",align:"left",copyable:!1,valueType:"text",hideInSearch:!E,hideInTable:!0,renderFormItem:function(){return t.createElement(M.Z,{allowClear:!0,value:s,onChange:u,options:S})}},{title:"\u767B\u5F55\u8D26\u53F7",dataIndex:"userName",align:"left",copyable:!1,valueType:"text",hideInSearch:!1},{title:"\u7528\u6237\u6635\u79F0",dataIndex:"name",align:"left",copyable:!1,valueType:"text",hideInSearch:!1},{title:"\u624B\u673A\u53F7",dataIndex:"phone",align:"left",valueType:"text",hideInSearch:!1,hideInTable:!0},{title:"\u8D1F\u8D23\u4EBA\u624B\u673A\u53F7",dataIndex:"phone",align:"left",copyable:!1,valueType:"text",hideInSearch:!0},{title:"\u90AE\u7BB1",dataIndex:"email",align:"left",copyable:!1,valueType:"text",hideInSearch:!0},{title:"\u5934\u50CF",dataIndex:"avatar",align:"left",copyable:!1,valueType:"text",hideInSearch:!0,render:function(y,n){return t.createElement("img",{alt:"\u5934\u50CF",src:n.avatar,width:72})}},{title:"\u6027\u522B",dataIndex:"sex",align:"left",copyable:!1,valueType:"text",hideInSearch:!0,valueEnum:i.TG},{title:"\u72B6\u6001",dataIndex:"status",align:"left",copyable:!1,valueType:"text",hideInSearch:!1,valueEnum:(0,K.BJ)(i.w6)},{title:"\u64CD\u4F5C",dataIndex:"id",align:"left",copyable:!1,valueType:"text",hideInSearch:!0,render:function(y,n){return t.createElement(oe.Z,{buttons:[{name:"\u7F16\u8F91",key:"edit",onClick:function(){return O(n)}},{name:"\u7981\u7528",key:"disable",onClick:function(){return H.Z.confirm({title:"\u786E\u8BA4\u7981\u7528\uFF1F",onOk:function(){return n.id&&x({status:i.w6.\u7981\u7528,id:n.id})}})},hidden:i.w6.\u7981\u7528===+n.status},{name:"\u542F\u7528",key:"enable",onClick:function(){var l=(0,$.Z)(T().mark(function m(){return T().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.abrupt("return",n.id&&x({status:i.w6.\u6B63\u5E38,id:n.id}));case 1:case"end":return f.stop()}},m)}));function a(){return l.apply(this,arguments)}return a}(),hidden:i.w6.\u7981\u7528!==+n.status}]})}}];return t.createElement(t.Fragment,null,t.createElement(re.ZP,{style:{padding:"18px 22px"},actionRef:g,request:A,onRequestError:function(y){console.error(y.message),I.default.error("\u6570\u636E\u52A0\u8F7D\u5931\u8D25,".concat(y.message))},onReset:function(){return u("")},columns:D,bordered:!0,rowKey:"id",pagination:{size:"default"},dateFormatter:"string",headerTitle:"\u7528\u6237\u5217\u8868",tableAlertRender:!1,toolBarRender:function(){return[t.createElement(N.Z,{onClick:U,key:"add",type:"primary"},t.createElement(ue.Z,null),"\u65B0\u5EFA")]}}),t.createElement(ge,{visible:C.visible,formData:C.formData,loading:C.loading,toggleVisible:R,reload:Z,orgId:s}))},Ze=Se}}]);
