(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[491],{84664:function($){$.exports={formWrap:"formWrap___276Lb",rowWrap:"rowWrap___1Q2qE",listWrap:"listWrap___2GzdK",userName:"userName___3K3PK"}},55632:function($){$.exports={treeWrap:"treeWrap___LOi_-",cover:"cover___3a6dl"}},31567:function($,K,e){"use strict";var q=e(19597),O=e(2291),ee=e(37482),f=e(3810),t=e(44742),o=e(67294),b=e(48786);K.Z=function(y){var J=y.buttons,M=y.maxNumber,F=M===void 0?2:M,X=y.className,me=y.style,te=J.filter(function(r){return!r.hidden}),ne=te.length,fe=function(g){var Y=g,Z=[];return g.length>F&&(Y=g.slice(0,F-1),Z=g.slice(F-1)),[Y,Z]},se=(0,o.useMemo)(function(){return fe(te)},[te]),v=(0,t.Z)(se,2),ve=v[0],I=v[1];return o.createElement("div",{className:X,style:me},ve.map(function(r,g){var Y=r.name,Z=r.key,ue=r.onClick,ae=r.path,U=o.createElement("a",{style:{marginRight:18},key:Z,onClick:ae?function(){return b.m8.push(ae)}:ue},Y);return g!==ne-1?o.createElement(o.Fragment,{key:Z},U):U}),I.length>0&&o.createElement(O.Z,{overlay:o.createElement(f.Z,null,I.map(function(r){return o.createElement(f.Z.Item,{onClick:r.path?function(){return b.m8.push(r.path)}:function(){var g;return(g=r.onClick)===null||g===void 0?void 0:g.call(r)}},r.name)}))},o.createElement("a",null,"\u66F4\u591A")))}},57044:function($,K,e){"use strict";var q=e(87753),O=e(98570),ee=e(67294);K.Z=function(f){var t=f.value,o=f.onChange,b=f.treeData,y=b===void 0?[]:b,J=function(F){o==null||o(F)};return ee.createElement(O.Z,{checkable:!0,onCheck:function(F){return J(F)},checkedKeys:t,treeData:y})}},84850:function($,K,e){"use strict";e.d(K,{Z:function(){return ee}});var q=e(44742),O=e(67294);function ee(){var f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,t=(0,O.useState)(!1),o=(0,q.Z)(t,2),b=o[0],y=o[1],J=(0,O.useState)(""),M=(0,q.Z)(J,2),F=M[0],X=M[1];return(0,O.useEffect)(function(){y(f)},[]),{spinning:b,setSpinning:y,tip:F,setTip:X}}},88491:function($,K,e){"use strict";e.r(K),e.d(K,{default:function(){return Be}});var q=e(13753),O=e(48429),ee=e(14643),f=e(92909),t=e(67294),o=e(21191),b=e(49101),y=e(31567),J=e(26780),M=e(46567),F=e(58210),X=e(87240),me=e(37092),te=e(91911),ne=e(13378),fe=e(68137),se=e(50532),v=e(56361),ve=e(67604),I=e(66498),r=e(44742),g=e(46368),Y=e(47376),Z=e(66827),ue=e(84850),ae=e(48786),U=e(66594),pe=e(57044),Ce=e(55632),he=e.n(Ce),Ie={labelCol:{span:3},wrapperCol:{span:20}},Ze={labelCol:{span:3},wrapperCol:{span:10}},De=function(i){var L=i.visible,c=i.toggleVisible,d=i.formData,j=i.loading,S=i.reload,E=i.currentUser,R=I.Z.useForm(),Q=(0,r.Z)(R,1),a=Q[0],p=(0,ue.Z)(),P=p.tip,A=p.setTip,D=d.id,W=E||{},H=W.orgCode,z=(0,ae.tT)("resourceTree"),B=z.resourceData,re=(0,t.useState)(!1),h=(0,r.Z)(re,2),s=h[0],n=h[1];(0,t.useEffect)(function(){if(!(0,g.Z)(d)){var u=d||{},k=u.resourceList,le=k===void 0?[]:k,oe=le.map(function(ce){return ce.id});a.setFieldsValue((0,v.Z)((0,v.Z)({},d),{},{resourceIds:oe,modalResourceIds:oe}))}return function(){a.resetFields()}},[d]);var m=function(){c(),a.resetFields()},T=function(k){A("\u6570\u636E\u4FDD\u5B58\u4E2D\uFF0C\u8BF7\u7A0D\u5019...");var le=(0,v.Z)((0,v.Z)({},k),{},{clientKey:U.OW.clientId,id:D,businessValue:H});return API.authorization.resourceRole.resourceSave.fetch(le)},x=(0,Z.QT)(T,{manual:!0,onSuccess:function(){f.default.success("\u4FDD\u5B58\u6210\u529F"),a.resetFields(),c(),S==null||S()}}),w=x.run,_=x.loading;return t.createElement(I.Z,(0,ne.Z)({form:a,onFinish:w},Ze),t.createElement(M.Z,{centered:!0,visible:L,forceRender:!0,maskClosable:!1,title:"".concat((0,Y.Z)(D)?"\u65B0\u5EFA":"\u7F16\u8F91","\u89D2\u8272"),okButtonProps:{htmlType:"submit"},width:800,onOk:function(){return a.submit()},onCancel:m,confirmLoading:_},t.createElement(X.Z,{spinning:j&&_,tip:P},t.createElement(I.Z.Item,{label:"\u89D2\u8272\u540D\u79F0",name:"role",rules:[{whitespace:!0},{required:!0}]},t.createElement(se.Z,{placeholder:"\u8BF7\u8F93\u5165"})),t.createElement(I.Z.Item,(0,ne.Z)({label:"\u89D2\u8272\u63CF\u8FF0",name:"comment"},Ie,{rules:[{whitespace:!0}]}),t.createElement(se.Z,{placeholder:"\u8BF7\u8F93\u5165"})),t.createElement("div",{className:he().treeWrap},t.createElement("div",{className:he().cover,onClick:function(){return n(!0)}}),t.createElement(I.Z.Item,{label:"\u62E5\u6709\u8D44\u6E90",name:"resourceIds"},t.createElement(te.Z,{treeData:B,allowClear:!0,multiple:!0,placeholder:"\u8BF7\u9009\u62E9"}))))),t.createElement(M.Z,{centered:!0,visible:s,forceRender:!0,maskClosable:!1,title:"\u62E5\u6709\u8D44\u6E90",width:412,onOk:function(){a.setFieldsValue({resourceIds:a.getFieldValue("modalResourceIds")}),n(!1)},onCancel:function(){a.setFieldsValue({modalResourceIds:a.getFieldValue("resourceIds")}),n(!1)},confirmLoading:_},t.createElement(I.Z.Item,{label:"\u62E5\u6709\u8D44\u6E90",name:"modalResourceIds",noStyle:!0},t.createElement(pe.Z,{treeData:B}))))},ye=(0,ae.$j)(function(l){var i=l.user;return{currentUser:i.currentUser}})(De),Ue=e(66518),ge=e(95322),ze=e(44862),Me=e(42091),Re=e(50189),Ae=e(3855),Fe=e(84664),ie=e.n(Fe),de=e(89193),Le={page:1,pageSize:6},Se={labelCol:{span:6},wrapperCol:{span:16}},Pe=function(l){var i=l.visible,L=l.toggleVisible,c=l.formData,d=l.reload,j=I.Z.useForm(),S=(0,r.Z)(j,1),E=S[0],R=(0,ue.Z)(),Q=R.tip,a=R.setTip,p=c.id,P=(0,t.useState)([]),A=(0,r.Z)(P,2),D=A[0],W=A[1],H=(0,de.x)(Le),z=(0,r.Z)(H,2),B=z[0],re=z[1],h=(0,Z.QT)(API.platform.sysUser.pageList.fetch,{manual:!0}),s=h.data,n=h.run,m=h.loading,T=(0,Z.QT)(API.authorization.resourceRole.resourceRoleDetailUser.fetch,{manual:!0,onSuccess:function(C){var N=C.userIdList,V=N===void 0?[]:N;W(V)}}),x=T.run,w=T.loading;(0,t.useEffect)(function(){i&&(n(B),x({clientKey:U.OW.clientId,roleId:p}))},[i,B]),(0,t.useEffect)(function(){return(0,g.Z)(c)||E.setFieldsValue((0,v.Z)({},c)),function(){E.resetFields()}},[c]);var _=function(){L(),E.resetFields()},u=function(){return a("\u6570\u636E\u4FDD\u5B58\u4E2D\uFF0C\u8BF7\u7A0D\u5019..."),API.authorization.resourceRole.resourceSave.fetch({clientKey:U.OW.clientId,id:p,userIds:D.map(function(C){return+C}),resourceIds:c.resourceIds,role:c.role})},k=(0,Z.QT)(u,{manual:!0,onSuccess:function(){f.default.success("\u6388\u6743\u6210\u529F"),E.resetFields(),L(),d==null||d()}}),le=k.run,oe=k.loading,ce=function(C,N){var V=(0,Re.Z)(D);C.target.checked?V.push(+N.userId):V=V.filter(function(Ke){return Ke!==N.userId}),W(V)},xe=function(C){return t.createElement(ge.ZP.Item,null,t.createElement(Me.Z,{checked:D.includes(+C.userId),onChange:function(V){return ce(V,C)}},t.createElement("div",{className:ie().userName},C.userName,C.phone?"(".concat(C.phone.slice(-4),")"):"")))};return t.createElement(M.Z,{centered:!0,visible:i,forceRender:!0,maskClosable:!1,title:"\u7528\u6237\u6388\u6743",okButtonProps:{htmlType:"submit"},width:442,onOk:function(){return E.submit()},onCancel:_,confirmLoading:oe,wrapClassName:"auth-modal"},t.createElement(X.Z,{spinning:m&&oe&&w,tip:Q},t.createElement(I.Z,(0,ne.Z)({form:E,onFinish:le},Se,{className:ie().formWrap}),t.createElement(I.Z.Item,{label:"\u4F01\u4E1A\u7F16\u7801",name:"account",tooltip:{icon:t.createElement(Ae.Z,null),title:"\u4F01\u4E1A\u7F16\u7801\u5C06\u4F5C\u4E3A\u4F01\u4E1A\u4E0B\u6240\u6709\u8D26\u53F7\u540E\u7F00"},noStyle:!0},t.createElement(ge.ZP,{loading:m,className:ie().listWrap,size:"small",dataSource:s==null?void 0:s.list,pagination:(0,v.Z)((0,v.Z)({},B),{},{current:B.page,onChange:function(C){re(function(N){N.page=C})},showQuickJumper:!0}),renderItem:xe})))))},Te=e(68699),Oe=e(94043),Ee=e.n(Oe),be=e(27870),We=function(){var l=(0,t.useRef)(),i=(0,de.x)({visible:!1,formData:{},loading:!1}),L=(0,r.Z)(i,2),c=L[0],d=L[1],j=(0,de.x)({visible:!1,formData:{}}),S=(0,r.Z)(j,2),E=S[0],R=S[1],Q=l.current||{},a=Q.reload,p=(0,Z.QT)(API.authorization.role.update.fetch,{manual:!0,onSuccess:function(){f.default.success("\u64CD\u4F5C\u6210\u529F"),a==null||a()}}),P=p.run,A=(0,Z.QT)(API.authorization.resourceRole.resourceDelete.fetch,{manual:!0,onSuccess:function(){f.default.success("\u5220\u9664\u6210\u529F"),a==null||a()}}),D=A.run,W=function(){var h=(0,Te.Z)(Ee().mark(function s(n){var m,T,x,w;return Ee().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,API.platform.sysRole.pageList.fetch((0,be.HO)((0,v.Z)((0,v.Z)({},n),{},{page:(n==null?void 0:n.current)||U.ii.page,pageSize:(n==null?void 0:n.pageSize)||U.ii.pageSize})));case 2:return m=u.sent,T=m.list,x=m.page,w=m.total,u.abrupt("return",{data:T||[],page:x,success:!0,total:w});case 7:case"end":return u.stop()}},s)}));return function(n){return h.apply(this,arguments)}}(),H=function(s){d(function(n){n.visible=!0,n.loading=!0,n.formData=s})},z=function(){d(function(s){s.visible=!0,s.formData={}})},B=function(s){var n=s.resourceList,m=n===void 0?[]:n;R(function(T){T.visible=!0,T.formData=(0,v.Z)((0,v.Z)({},s),{},{resourceIds:m.map(function(x){return x.id})})})},re=function(s){var n={edit:d,auth:R};n[s](function(m){m.visible=!1,m.loading=!1,m.formData={}})};return{actionRef:l,reload:a,editModalConfig:c,setEditModalConfig:d,authModalConfig:E,setAuthModalConfig:R,handleDisable:P,handleDelete:D,fetchList:W,handleRoleEdit:H,handleRoleAdd:z,handleAuthorize:B,handleModalHide:re}},Be=function(){var l=We(),i=l.actionRef,L=l.reload,c=l.editModalConfig,d=l.fetchList,j=l.handleRoleAdd,S=l.handleRoleEdit,E=l.handleModalHide,R=l.authModalConfig,Q=l.handleAuthorize,a=[{title:"\u89D2\u8272\u540D\u79F0",dataIndex:"role",align:"left",copyable:!1,valueType:"text",hideInSearch:!1},{title:"\u89D2\u8272\u63CF\u8FF0",dataIndex:"comment",align:"left",copyable:!1,valueType:"text",hideInSearch:!0},{title:"\u62E5\u6709\u8D44\u6E90",dataIndex:"resourceList",align:"left",copyable:!1,valueType:"text",hideInSearch:!0,render:function(P,A){var D=A||{},W=D.resourceList,H=W===void 0?[]:W;return H.map(function(z){return z.description}).join(",")}},{title:"\u64CD\u4F5C",dataIndex:"id",align:"left",copyable:!1,valueType:"text",hideInSearch:!0,render:function(P,A){return t.createElement(y.Z,{buttons:[{name:"\u7F16\u8F91",key:"edit",onClick:function(){return S(A)}},{name:"\u6388\u6743",key:"authorize",onClick:function(){return Q(A)}}]})}}];return t.createElement(t.Fragment,null,t.createElement(o.ZP,{style:{padding:"18px 22px"},actionRef:i,request:d,onRequestError:function(P){console.error(P.message),f.default.error("\u6570\u636E\u52A0\u8F7D\u5931\u8D25,".concat(P.message))},columns:a,bordered:!0,rowKey:"id",pagination:{size:"default"},dateFormatter:"string",headerTitle:"\u83DC\u5355\u6743\u9650\u5217\u8868",tableAlertRender:!1,toolBarRender:function(){return[t.createElement(O.Z,{onClick:j,key:"add",type:"primary"},t.createElement(b.Z,null),"\u65B0\u5EFA")]}}),t.createElement(ye,{visible:c.visible,formData:c.formData,loading:c.loading,toggleVisible:function(){return E("edit")},reload:L}),t.createElement(Pe,{visible:R.visible,formData:R.formData,toggleVisible:function(){return E("auth")},reload:L}))}}}]);
